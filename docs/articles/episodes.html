<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Epidemiological case definitions in R • diyar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Epidemiological case definitions in R">
<meta property="og:description" content="diyar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diyar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/episodes.html">Epidemiological case definitions in R</a>
    </li>
    <li>
      <a href="../articles/links.html">Record linkage with diyar</a>
    </li>
    <li>
      <a href="../articles/number_line.html">`number_line` and overlaps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OlisaNsonwu/diyar/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="episodes_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Epidemiological case definitions in R</h1>
            
            <h4 class="date">29 April 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OlisaNsonwu/diyar/blob/master/vignettes/episodes.Rmd"><code>vignettes/episodes.Rmd</code></a></small>
      <div class="hidden name"><code>episodes.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In epidemiological analyses an exact distinction between temporal events is not always possible. Therefore, static but reasonable cut-offs are used to distinguish one case of an event from another. This is an important aspect of most case definitions. For example, distinguishing repeat or recurrent infections in a patient from the first occurrence of that infection.</p>
<p>Scripting such case definitions in <code>R</code> can be challenging. <code><a href="../reference/episodes.html">episodes()</a></code> and <code><a href="../reference/partitions.html">partitions()</a></code> provide a convenient but flexible solution to this. It links events into a temporal sequence, creating a unique group identifier with useful information about each group. These identifiers can then be used for record deduplication or further analyses.</p>
</div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>The group identifiers created by <code><a href="../reference/episodes.html">episodes()</a></code> and <code><a href="../reference/partitions.html">partitions()</a></code> are called episodes (<code>epid</code> class) and panes (<code>pane</code> class) respectively. <code><a href="../reference/episodes.html">episodes()</a></code> creates three type of episodes - <code>"fixed"</code>, <code>"rolling"</code> and <code>"recursive"</code>. In <code>diyar</code>, a fixed episode is created by linking an index event to other events occurring within a specified period from of it. This results in a <code>"Case"</code> (index event) and related duplicate events (<code>"Duplicate_C"</code>). In a rolling episode, the process is repeated using another event from the existing episode as the reference event. This results in a <code>"Recurrent"</code> event and additional duplicate (<code>"Duplicate_R"</code>) events. Here, this repetition is referred to as a recurrence. Unless specified, recurrences will continue indefinitely until there are no more events within the period of recurrence. When this happens, the chain of recurrence ends and so does the episode. A recursive episode is similar to a rolling episode except that every event in the existing episode is used as a reference event. On the other hand, a pane is created by separating events into set periods in time. The events in a pane have no relationship with each other, other than occurring in the same period or numeric interval. See the figure and example below.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Events</span>
<span class="no">event_dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2021-01-01"</span>), <span class="kw">to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2021-01-11"</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">s_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">event_dt</span>)
<span class="co"># Attribute 1 - Source of infection</span>
<span class="no">attr_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"BSI"</span>, <span class="st">"UTI"</span>, <span class="st">"RTI"</span>, <span class="st">"RTI"</span>, <span class="st">"BSI"</span>, <span class="st">"BSI"</span>, <span class="st">"BSI"</span>, <span class="st">"RTI"</span>, <span class="st">"RTI"</span>, <span class="st">"BSI"</span>, <span class="st">"RTI"</span>)
<span class="co"># Attribute 2 - Location </span>
<span class="no">attr_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Ward 1"</span>, <span class="st">"Ward 1"</span>, <span class="st">"Ward 3"</span>, <span class="st">"Ward 3"</span>, <span class="st">"Ward 2"</span>, <span class="st">"Ward 2"</span>,
            <span class="st">"Ward 1"</span>, <span class="st">"Ward 1"</span>, <span class="st">"Ward 3"</span>,<span class="st">"Ward 3"</span>, <span class="st">"Ward 2"</span>)
<span class="no">s_data</span>$<span class="no">attr</span> <span class="kw">&lt;-</span> <span class="no">attr_1</span>
<span class="co"># Fixed episodes</span>
<span class="no">s_data</span>$<span class="no">ep1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>)
<span class="co"># Rolling episodes</span>
<span class="no">s_data</span>$<span class="no">ep2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                       <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">attr_1</span>)
<span class="co"># Recursive episodes</span>
<span class="no">s_data</span>$<span class="no">ep3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"recursive"</span>)
<span class="co"># Panes</span>
<span class="no">s_data</span>$<span class="no">pn1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">partitions</a></span>(<span class="no">event_dt</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Identifiers</span>
<span class="no">s_data</span>
<span class="co">#&gt;          date attr     ep1                              ep2     ep3      pn1</span>
<span class="co">#&gt; 1  2021-01-01  BSI E.1 (C) E.1 2021-01-01 -&gt; 2021-01-11 (C) E.1 (C) PN.1 (I)</span>
<span class="co">#&gt; 2  2021-01-02  UTI E.1 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.1 (D)</span>
<span class="co">#&gt; 3  2021-01-03  RTI E.1 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.1 (D)</span>
<span class="co">#&gt; 4  2021-01-04  RTI E.1 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.1 (D)</span>
<span class="co">#&gt; 5  2021-01-05  BSI E.1 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.1 (D)</span>
<span class="co">#&gt; 6  2021-01-06  BSI E.1 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.6 (I)</span>
<span class="co">#&gt; 7  2021-01-07  BSI E.7 (C) E.1 2021-01-01 -&gt; 2021-01-11 (R) E.1 (R) PN.6 (D)</span>
<span class="co">#&gt; 8  2021-01-08  RTI E.7 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.6 (D)</span>
<span class="co">#&gt; 9  2021-01-09  RTI E.7 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.6 (D)</span>
<span class="co">#&gt; 10 2021-01-10  BSI E.7 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.6 (D)</span>
<span class="co">#&gt; 11 2021-01-11  RTI E.7 (D) E.1 2021-01-01 -&gt; 2021-01-11 (D) E.1 (D) PN.6 (D)</span></pre></body></html></div>
<p>Each type of identifier has <code>as.data.frame</code> and <code>as.list</code> methods for easy access to their components.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Components of an episode identifier</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">s_data</span>$<span class="no">ep2</span>)
<span class="co">#&gt;    epid sn    wind_nm     case_nm dist_wind_index dist_epid_index epid_total</span>
<span class="co">#&gt; 1     1  1       Case        Case          0 days          0 days         11</span>
<span class="co">#&gt; 2     1  2       Case Duplicate_C          1 days          1 days         11</span>
<span class="co">#&gt; 3     1  3       Case Duplicate_C          2 days          2 days         11</span>
<span class="co">#&gt; 4     1  4       Case Duplicate_C          3 days          3 days         11</span>
<span class="co">#&gt; 5     1  5       Case Duplicate_C          4 days          4 days         11</span>
<span class="co">#&gt; 6     1  6       Case Duplicate_C          5 days          5 days         11</span>
<span class="co">#&gt; 7     1  7 Recurrence   Recurrent          1 days          6 days         11</span>
<span class="co">#&gt; 8     1  8 Recurrence Duplicate_R          2 days          7 days         11</span>
<span class="co">#&gt; 9     1  9 Recurrence Duplicate_R          3 days          8 days         11</span>
<span class="co">#&gt; 10    1 10 Recurrence Duplicate_R          4 days          9 days         11</span>
<span class="co">#&gt; 11    1 11 Recurrence Duplicate_R          5 days         10 days         11</span>
<span class="co">#&gt;    iteration wind_id1 epid_start   epid_end epid_length epid_dataset</span>
<span class="co">#&gt; 1          1        1 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 2          1        1 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 3          1        1 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 4          1        1 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 5          1        1 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 6          1        1 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 7          2        6 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 8          2        6 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 9          2        6 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 10         2        6 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span>
<span class="co">#&gt; 11         2        6 2021-01-01 2021-01-11     10 days  BSI,RTI,UTI</span></pre></body></html></div>
<p>Figure 1 gives a visual representation of the difference between these identifiers.</p>
<p><strong>Figure 1: Episodes and panes</strong></p>
<p><img src="fig_e1.png" width="1000" height="580"></p>
</div>
<div id="implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h1>
<p>The main considerations in a case definition are accounted for in these functions using a flexible and modular approach. Therefore, most considerations can be addressed independently or in a compounding manner. These considerations are summarised below.</p>
<div id="matching-criteria-based-on-an-events-attribute" class="section level2">
<h2 class="hasAnchor">
<a href="#matching-criteria-based-on-an-events-attribute" class="anchor"></a>Matching criteria based on an event’s attribute</h2>
<p>Additional matching criteria (separate from temporal links) can be implemented by the <code>strata</code>, <code>case_sub_criteria</code> and <code>recurrence_sub_criteria</code> arguments. <code>strata</code> introduces a blocking attribute which forces separate episodes and panes for different subsets of the dataset.</p>
<p>The figure and example below show how the <code>strata</code> argument is used.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Matching clinical criteria</span>
<span class="no">ep1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">strata</span> <span class="kw">=</span> <span class="no">attr_1</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="co"># Matching geographical criteria</span>
<span class="no">ep2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">strata</span> <span class="kw">=</span> <span class="no">attr_2</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>)</pre></body></html></div>
<p><strong>Figure 2: Using a <code>strata</code> to specify additional criteria for linked events</strong> <img src="fig_e2.png" width="1000" height="290"></p>
<p>In contrast, the <code>case_sub_criteria</code> and <code>recurrence_sub_criteria</code> arguments apply a set of matching criteria for attributes associated with the events being compared. These arguments take a <code>sub_criteria</code> object. <code>sub_criteria</code> objects and how they are used are described in greater detail in <code><a href="../articles/links.html">vignette("links")</a></code>. In summary, they contain a set of atomic vectors as attributes, a set of corresponding logical tests for each attribute and another set of logical tests for the equivalence of values in each attribute. The evaluation of a <code>sub_criteria</code> is recursive and so allows for nested conditions.</p>
<p>The figure and example below show how the <code>case_sub_criteria</code> and <code>recurrence_sub_criteria</code> arguments are used.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Attribute 3 - Patient sex</span>
<span class="no">attr_3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Female"</span>, <span class="fl">9</span>), <span class="st">"Male"</span>, <span class="st">"Female"</span>)

<span class="co"># Sub-criteria 1 - Matching source of infection OR patient location</span>
<span class="no">sub_cri_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sub_criteria.html">sub_criteria</a></span>(<span class="no">attr_1</span>, <span class="no">attr_2</span>, <span class="kw">operator</span> <span class="kw">=</span> <span class="st">"or"</span>)
<span class="co"># Sub-criteria 2 - Matching source of infection AND patient location</span>
<span class="no">sub_cri_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sub_criteria.html">sub_criteria</a></span>(<span class="no">attr_1</span>, <span class="no">attr_2</span>, <span class="kw">operator</span> <span class="kw">=</span> <span class="st">"and"</span>)
<span class="co"># Sub-criteria 3 - (Matching source of infection AND patient location) OR (Matching patient sex)</span>
<span class="no">sub_cri_3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sub_criteria.html">sub_criteria</a></span>(<span class="no">sub_cri_2</span>, <span class="no">attr_3</span>, <span class="kw">operator</span> <span class="kw">=</span> <span class="st">"or"</span>)
<span class="co"># Sub-criteria 4 - (Matching source of infection AND patient location) AND (Matching patient sex)</span>
<span class="no">sub_cri_4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sub_criteria.html">sub_criteria</a></span>(<span class="no">sub_cri_2</span>, <span class="no">attr_3</span>, <span class="kw">operator</span> <span class="kw">=</span> <span class="st">"and"</span>)

<span class="no">ep3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">case_sub_criteria</span> <span class="kw">=</span> <span class="no">sub_cri_1</span>)
<span class="no">ep4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">case_sub_criteria</span> <span class="kw">=</span> <span class="no">sub_cri_2</span>)
<span class="no">ep5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">case_sub_criteria</span> <span class="kw">=</span> <span class="no">sub_cri_3</span>)
<span class="no">ep6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">case_sub_criteria</span> <span class="kw">=</span> <span class="no">sub_cri_4</span>)</pre></body></html></div>
<p><strong>Figure 3: Using a <code>sub_criteria</code> to specify additional criteria for linked events</strong> <img src="fig_e3.png" width="1000" height="580"></p>
<p>Using a <code>sub_criteria</code> incurs additional processing time therefore, it should be reserved for situations when a blocking attribute would not suffice or more complex matching criteria are required. The figure and example below show some examples of this.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># record id</span>
<span class="no">rd_id</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">attr_1</span>)

<span class="co"># Condition 1 - Each episode must include BSI events</span>
<span class="no">cri_funx_1</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>){
  <span class="no">splts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="no">x</span>$<span class="no">attr</span>, <span class="no">y</span>$<span class="no">rd_id</span>)
  <span class="no">splts_lgk</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">splts</span>, <span class="kw">function</span>(<span class="no">x</span>){
    <span class="st">"RTI"</span> <span class="kw">%in%</span> <span class="no">x</span>
  })
  <span class="no">splts_lgk</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">splts_lgk</span>)
  <span class="no">splts_lgk</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">y</span>$<span class="no">rd_id</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">splts</span>))]
}

<span class="co"># Condition 2 - Each episode must include &gt;=3 different sources of infection</span>
<span class="no">cri_funx_2</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>){
  <span class="no">splts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="no">x</span>$<span class="no">attr</span>, <span class="no">y</span>$<span class="no">rd_id</span>)
  <span class="no">splts_lgk</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">splts</span>, <span class="kw">function</span>(<span class="no">x</span>){
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>[!<span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(<span class="no">x</span>)]) <span class="kw">&gt;=</span> <span class="fl">3</span>
  })
  <span class="no">splts_lgk</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">splts_lgk</span>)
  <span class="no">splts_lgk</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">y</span>$<span class="no">rd_id</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">splts</span>))]
}

<span class="co"># Equivalence - Logical test for matching attributes</span>
<span class="no">eqv_funx</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>){
  <span class="no">x</span>$<span class="no">rd_id</span> <span class="kw">==</span> <span class="no">y</span>$<span class="no">rd_id</span>
}

<span class="co"># Sub-criteria </span>
<span class="no">sub_cri_5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sub_criteria.html">sub_criteria</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">attr</span> <span class="kw">=</span> <span class="no">attr_1</span>, <span class="kw">rd_id</span><span class="kw">=</span> <span class="no">rd_id</span>), <span class="kw">match_funcs</span> <span class="kw">=</span> <span class="no">cri_funx_1</span>,
                          <span class="kw">equal_funcs</span> <span class="kw">=</span> <span class="no">eqv_funx</span>)

<span class="no">sub_cri_6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sub_criteria.html">sub_criteria</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">attr</span> <span class="kw">=</span> <span class="no">attr_1</span>, <span class="kw">rd_id</span><span class="kw">=</span> <span class="no">rd_id</span>), <span class="kw">match_funcs</span> <span class="kw">=</span> <span class="no">cri_funx_2</span>,
                          <span class="kw">equal_funcs</span> <span class="kw">=</span> <span class="no">eqv_funx</span>)

<span class="no">ep7</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>,
<span class="kw">case_sub_criteria</span> <span class="kw">=</span> <span class="no">sub_cri_5</span>)

<span class="no">ep8</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>,
                <span class="kw">case_sub_criteria</span> <span class="kw">=</span> <span class="no">sub_cri_6</span>)</pre></body></html></div>
<p><strong>Figure 4: Using <code>case_sub_criteria</code> to specify complex criteria for linked events</strong> <img src="fig_e4.png" width="1000" height="290"></p>
</div>
<div id="separating-events-into-sections-of-time" class="section level2">
<h2 class="hasAnchor">
<a href="#separating-events-into-sections-of-time" class="anchor"></a>Separating events into sections of time</h2>
<p>This is best handled by <code><a href="../reference/partitions.html">partitions()</a></code>. See the examples below.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Group events into 2 equal parts over the strata's duration</span>
<span class="no">pn2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">partitions</a></span>(<span class="no">event_dt</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Group events into 3-day sequences over the strata's duration</span>
<span class="no">pn3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">partitions</a></span>(<span class="no">event_dt</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Group events that occured in a specified period of time </span>
<span class="no">pn4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">partitions</a></span>(<span class="no">event_dt</span>, <span class="kw">window</span> <span class="kw">=</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="no">event_dt</span>[<span class="fl">4</span>], <span class="no">event_dt</span>[<span class="fl">7</span>]))

<span class="co"># Group events from separate periods into one pane</span>
<span class="no">pn5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">partitions</a></span>(<span class="no">event_dt</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><strong>Figure 5: Using partitions</strong> <img src="fig_e5.png" width="1000" height="580"></p>
</div>
<div id="selecting-index-events-and-the-direction-of-episode-tracking" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-index-events-and-the-direction-of-episode-tracking" class="anchor"></a>Selecting index events and the direction of episode tracking</h2>
<p>The <code>from_last</code> argument specifies the direction of episode tracking, while <code>custom_sort</code> specifies a custom preference for selecting index events. The combination of both allows users to choose which event or type of events should be used as the index event. See the examples below.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Preference for selecting index events</span>
<span class="no">c_sort</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">2</span>, <span class="fl">5</span>), <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">2</span>, <span class="fl">5</span>))
<span class="co"># Episodes are 6 days (5-day difference) after the earliest event </span>
<span class="no">ep9</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episodes_max</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co"># Episodes are 6 days (5-day difference) before the most recent event </span>
<span class="no">ep10</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episodes_max</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">from_last</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co"># Episodes are 6 days (5-day difference) after the 6th event </span>
<span class="no">ep11</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">c_sort</span>, <span class="kw">episodes_max</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co"># Episodes are 6 days (5-day difference) before or after the 6th event </span>
<span class="no">ep12</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(-<span class="fl">5</span>, <span class="fl">5</span>), <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">c_sort</span>, <span class="kw">episodes_max</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><strong>Figure 6: Selecting index events when tracking episodes</strong> <img src="fig_e6.png" width="1000" height="580"></p>
</div>
<div id="recurrence" class="section level2">
<h2 class="hasAnchor">
<a href="#recurrence" class="anchor"></a>Recurrence</h2>
<p>The <code>episode_type</code> argument can be used to request for rolling or recursive episodes which permit recurrence. <code>reference_event</code> is used to specify which of the events in the existing episode is considered the reference event for the next recurrence. <code>case_for_recurrence</code> determines if the initial occurrence of the event and subsequent recurrences are to be treated in the same way i.e. does recurrent events trigger an initial occurrence of their own?</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Episodes are 4 days (3-day difference) after the earliest event with</span>
<span class="co"># repeat occurrence within 4 days of the last event considered recurrences not duplicates</span>
<span class="no">ep13</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>)
<span class="co"># Episodes are 4 days (3-day difference) after the earliest event with</span>
<span class="co"># repeat occurrence within 7 days of the last event considered recurrences not duplicates</span>
<span class="no">ep14</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">3</span>,  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>)
<span class="co"># Episodes are 3 days (2-day difference) after the earliest event with</span>
<span class="co"># repeat occurrence within 6 days of the first event considered recurrences not duplicates</span>
<span class="no">ep15</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">2</span>,  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>, <span class="kw">reference_event</span> <span class="kw">=</span> <span class="st">"first_record"</span>)
<span class="co"># Episodes are 2 days (1-day difference) after the earliest event with</span>
<span class="co"># repeat occurrence within 4 days of the last event considered recurrences not duplicates and</span>
<span class="co"># the possibility of each repeat occurrence spawning a new occurrence as if it was the initial case</span>
<span class="no">ep16</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">1</span>,  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">3</span>,
                <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>, <span class="kw">case_for_recurrence</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co"># Episodes are 2 days (1-day difference) after the earliest event with</span>
<span class="co"># repeat occurrence within 4 days of the last event considered recurrences not duplicates and</span>
<span class="co"># can't recur more than twice</span>
<span class="no">ep17</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">1</span>,  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">3</span>,
                <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>, <span class="kw">rolls_max</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co"># Episodes are 2 days (1-day difference) after the earliest event with</span>
<span class="co"># repeat occurrence within 4 days of the last event considered recurrences not duplicates and</span>
<span class="co"># can't recur more than once times and the selection of index events is recursive</span>
<span class="no">ep18</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">1</span>,  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">3</span>,
                <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"recursive"</span>, <span class="kw">rolls_max</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><strong>Figure 7: Recurrence of the index event</strong> <img src="fig_e7.png" width="1000" height="580"></p>
<div id="multiple-temporal-links-and-lags-between-the-reference-and-repeat-events" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-temporal-links-and-lags-between-the-reference-and-repeat-events" class="anchor"></a>Multiple temporal links and lags between the reference and repeat events</h3>
<p>Multiple <code>case_length</code> or <code>recurrence_length</code> can be used by providing a <code>list</code> of ranges (<code><a href="../reference/number_line.html">number_line()</a></code>), while the <code>case_length_total</code> and <code>recurrence_length_total</code> arguments specifies how many such temporal links are required for an episode.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Each episodes requires at least 5 temporal links</span>
<span class="no">ep19</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>,
                <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">2</span>, <span class="fl">2</span>),
                                   <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">5</span>, <span class="fl">7</span>),
                                   <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">9</span>, <span class="fl">20</span>)),
                <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>, <span class="kw">case_length_total</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">skip_if_b4_lengths</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Each episodes requires at least 2 temporal links</span>
<span class="no">ep20</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>,
                <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">2</span>, <span class="fl">2</span>),
                                   <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">5</span>, <span class="fl">7</span>),
                                   <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">9</span>, <span class="fl">20</span>)),
                <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>, <span class="kw">case_length_total</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">skip_if_b4_lengths</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><strong>Figure 8: Lags between index and repeat events</strong> <img src="fig_e8.png" width="1000" height="290"></p>
</div>
</div>
<div id="interval-grouping" class="section level2">
<h2 class="hasAnchor">
<a href="#interval-grouping" class="anchor"></a>Interval grouping</h2>
<p>It’s possible to track episodes among events with known start and end points, instead of those occurring at a single point in time. It is worth noting that the reference point for such events is their end point. Therefore, using a <code>case_length</code> of <code>1</code> when working with such events is interpreted as 2 days (1-day difference) after the end point of the interval. By default, other events that occur on or after the start point but before the end point of the index event will not be captured. If this is required, use <code><a href="../reference/windows.html">index_window()</a></code> to get the range required to capture such events, and supply it to the <code>case_length</code> or <code>recurrence_length</code> arguments. See the figure and examples below.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Dummy data of hospital stays</span>
<span class="no">dfr</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">hospital_admissions</a></span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"admin_dt"</span>, <span class="st">"discharge_dt"</span>)]
<span class="no">dfr</span>$<span class="no">admin_period</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="no">dfr</span>$<span class="no">admin_dt</span>, <span class="no">dfr</span>$<span class="no">discharge_dt</span>)

<span class="co"># Group overlapping hospital stays</span>
<span class="no">dfr</span>$<span class="no">ep_len1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">dfr</span>$<span class="no">admin_period</span>)
<span class="no">dfr</span>$<span class="no">ep21</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dfr</span>$<span class="no">admin_period</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dfr</span>$<span class="no">ep_len1</span>)

<span class="co"># Group overlapping hospital stays and those within 21 days of the end point of an index hospital stay </span>
<span class="no">dfr</span>$<span class="no">ep_len2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">expand_number_line</a></span>(<span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">dfr</span>$<span class="no">admin_period</span>), <span class="fl">20</span>, <span class="st">"right"</span>)
<span class="no">dfr</span>$<span class="no">ep22</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dfr</span>$<span class="no">admin_period</span>, <span class="kw">case_length</span> <span class="kw">=</span>  <span class="no">dfr</span>$<span class="no">ep_len2</span>)

<span class="no">dfr</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"admin_period"</span>, <span class="st">"ep_len1"</span>, <span class="st">"ep_len2"</span>, <span class="st">"ep21"</span>, <span class="st">"ep22"</span>)]
<span class="co">#&gt;                admin_period  ep_len1   ep_len2    ep21    ep22</span>
<span class="co">#&gt; 1  2019-01-01 == 2019-01-01   0 == 0   0 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 2  2019-01-01 -&gt; 2019-01-10  -9 -&gt; 0  -9 -&gt; 20 E.2 (C) E.2 (C)</span>
<span class="co">#&gt; 3  2019-01-10 -&gt; 2019-01-13  -3 -&gt; 0  -3 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 4  2019-01-05 -&gt; 2019-01-06  -1 -&gt; 0  -1 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 5  2019-01-05 -&gt; 2019-01-15 -10 -&gt; 0 -10 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 6  2019-01-07 -&gt; 2019-01-15  -8 -&gt; 0  -8 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 7  2019-01-04 -&gt; 2019-01-13  -9 -&gt; 0  -9 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 8  2019-01-20 -&gt; 2019-01-30 -10 -&gt; 0 -10 -&gt; 20 E.8 (C) E.2 (D)</span>
<span class="co">#&gt; 9  2019-01-26 -&gt; 2019-01-31  -5 -&gt; 0  -5 -&gt; 20 E.8 (D) E.2 (D)</span>
<span class="co">#&gt; 10 2019-01-01 -&gt; 2019-01-10  -9 -&gt; 0  -9 -&gt; 20 E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 11 2019-01-20 -&gt; 2019-01-30 -10 -&gt; 0 -10 -&gt; 20 E.8 (D) E.2 (D)</span></pre></body></html></div>
<p><strong>Figure 9: Tracking episodes of overlapping intervals</strong> <img src="fig_e9.png" width="1000" height="290"></p>
<p>Currently, the <code>diyar</code> packages recognises 7 mutually exclusive and 2 mutually inclusive ways a pair of intervals can overlap. Please see <code><a href="../articles/number_line.html">vignette("number_line")</a></code> for more details about this. Using <code>case_overlap_methods</code> and <code>recurrence_overlap_methods</code>, the episode tracking process can be made to only capture intervals that overlap by specific methods. See the example below.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Wrapper function for a fixed episode</span>
<span class="no">episodes_wf</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>){
  <span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dfr</span>$<span class="no">admin_period</span>,
                    <span class="kw">sn</span> <span class="kw">=</span> <span class="no">dfr</span>$<span class="no">rd_id</span>,
                    <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">dfr</span>$<span class="no">admin_period</span>),
                    <span class="kw">case_overlap_methods</span> <span class="kw">=</span> <span class="no">x</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">epids</span>)
}

<span class="co"># Methods </span>
<span class="no">methods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="co"># Identical intervals</span>
  <span class="kw">exact</span> <span class="kw">=</span> <span class="st">"exact"</span>,
  <span class="co"># Intervals with their start or end points within another</span>
  <span class="kw">across</span> <span class="kw">=</span> <span class="st">"across"</span>,
  <span class="co"># Intervals with aligned start points</span>
  <span class="kw">aligns_start</span> <span class="kw">=</span> <span class="st">"aligns_start"</span>,
  <span class="co"># Intervals with aligned end points</span>
  <span class="kw">aligns_end</span> <span class="kw">=</span> <span class="st">"aligns_end"</span>,
  <span class="co"># Intervals with start points that align with the end point of another, and vice versa</span>
  <span class="kw">chain</span> <span class="kw">=</span> <span class="st">"chain"</span>,
  <span class="co"># Intervals occurring completely within others</span>
  <span class="kw">inbetween</span> <span class="kw">=</span> <span class="st">"inbetween"</span>,
  <span class="co"># A combination of `chain` and `inbetween` methods</span>
  <span class="kw">cb1</span> <span class="kw">=</span> <span class="st">"chain|inbetween"</span>,
  <span class="co"># A combination of `exact`, `chain` and `inbetween` methods</span>
  <span class="kw">cb2</span> <span class="kw">=</span> <span class="st">"exact|chain|inbetween"</span>,
  <span class="co"># A combination of `across`, `chain` and `aligns_end` methods</span>
  <span class="kw">cb3</span> <span class="kw">=</span> <span class="st">"across|chain|aligns_end"</span>
)

<span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">methods</span>, <span class="no">episodes_wf</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">epids</span>) <span class="kw">&lt;-</span> <span class="no">methods</span>

<span class="no">epids</span>$<span class="no">exact</span>
<span class="co">#&gt;  [1] "E.1 (C)" "E.2 (C)" "E.3 (C)" "E.4 (C)" "E.5 (C)" "E.6 (C)" "E.7 (C)"</span>
<span class="co">#&gt;  [8] "E.8 (C)" "E.9 (C)" "E.2 (D)" "E.8 (D)"</span></pre></body></html></div>
<p><strong>Figure 10: Overlap methods</strong> <img src="fig_e10.png" width="1000" height="580"></p>
<p>See <code>overlap_methods$options</code> for a list of supported options.</p>
</div>
</div>
<div id="strengths-and-limitations" class="section level1">
<h1 class="hasAnchor">
<a href="#strengths-and-limitations" class="anchor"></a>Strengths and limitations</h1>
<p><code><a href="../reference/episodes.html">episodes()</a></code> is implemented as a loop. Although, the function continues to be optimised, each iteration of the loop costs additional processing time. This can be further compounded by the number of records being assessed. The exact time taken to complete an iteration will depend on a machine’s specifications but the number of iterations required to complete the tracking process is constant. This additional processing is often negligible when analysing small datasets but becomes more noticeable with much larger datasets and more complex <code>case_sub_criteria</code> or <code>recurrence_sub_criteria</code>.</p>
<p>In general, this issue can be mitigated by taking measures to either reduce the number of iterations required to complete the episode tracking process or reducing the number of records being assessed. Examples are described below.</p>
<div id="efficient-use-of-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#efficient-use-of-arguments" class="anchor"></a>Efficient use of arguments</h2>
<p>Different combinations of arguments can lead to the same outcome however, each will often require different number of iterations to complete the same process. In general, shorter and multiple <code>case_length</code> and <code>recurrence_length</code>, fewer <code>strata</code>, and the use of <code>custom_sort</code>, a <code>sub_criteria</code> and multiple index events will increase the number of iterations required to complete the process. A good understanding of each argument will be beneficial in knowing the most efficient combination of arguments to use for a case definition. For example, <code>ep4</code> was created with a <code>sub_criteria</code> and took 9 iterations to complete.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ep4</span>)
<span class="co">#&gt; Iterations:                     9</span>
<span class="co">#&gt; Total records:                  11</span>
<span class="co">#&gt;  by record type:</span>
<span class="co">#&gt;      Case:                9</span>
<span class="co">#&gt;      Duplicate_C:         2</span>
<span class="co">#&gt; Total episodes:                 9</span>
<span class="co">#&gt;  by episode type:</span>
<span class="co">#&gt;      Fixed:               9</span>
<span class="co">#&gt;  by episode dataset:</span>
<span class="co">#&gt;      N/A</span>
<span class="co">#&gt;  by episodes duration:</span>
<span class="co">#&gt;      N/A</span>
<span class="co">#&gt;  by records per episode:</span>
<span class="co">#&gt;      1 record:            7</span>
<span class="co">#&gt;      2 records:           2</span>
<span class="co">#&gt;  by recurrence:</span>
<span class="co">#&gt;      N/A</span></pre></body></html></div>
<p>However, if the <code>strata</code> argument is used instead of a <code>sub_criteria</code>, it only takes 2 iterations and yet achieves the same outcome.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ep4b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">strata</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">attr_1</span>, <span class="st">" "</span>, <span class="no">attr_2</span>))

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ep4b</span>)
<span class="co">#&gt; Iterations:                     2</span>
<span class="co">#&gt; Total records:                  11</span>
<span class="co">#&gt;  by record type:</span>
<span class="co">#&gt;      Case:                9</span>
<span class="co">#&gt;      Duplicate_C:         2</span>
<span class="co">#&gt; Total episodes:                 9</span>
<span class="co">#&gt;  by episode type:</span>
<span class="co">#&gt;      Fixed:               9</span>
<span class="co">#&gt;  by episode dataset:</span>
<span class="co">#&gt;      N/A</span>
<span class="co">#&gt;  by episodes duration:</span>
<span class="co">#&gt;      N/A</span>
<span class="co">#&gt;  by records per episode:</span>
<span class="co">#&gt;      1 record:            7</span>
<span class="co">#&gt;      2 records:           2</span>
<span class="co">#&gt;  by recurrence:</span>
<span class="co">#&gt;      N/A</span>

<span class="co"># Identical identifiers </span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">ep4</span> <span class="kw">==</span> <span class="no">ep4b</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>Similarly, using multiple index events usually costs additional processing time, even if it takes the same number of iterations to complete the same process. See the examples below.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">dup_events</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">event_dt</span>, <span class="fl">5</span>)
<span class="co"># Fast</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="no">ep23a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">dup_events</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"recursive"</span>)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.19    0.00    0.19</span>
<span class="co"># Faster</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="no">ep23b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">dup_events</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">reference_event</span> <span class="kw">=</span> <span class="st">"last_event"</span>)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.09    0.00    0.09</span>
<span class="co"># Fastest</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="no">ep23c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">dup_events</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">reference_event</span> <span class="kw">=</span> <span class="st">"last_record"</span>)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.03    0.00    0.03</span></pre></body></html></div>
<p><strong>Figure 11: Effect of using multiple index events</strong> <img src="fig_e11.png" width="1000" height="290"></p>
<p>The three methods above have resulted in the same outcome therefore the “fastest” approach is recommended. Unless required, multiple index events should be avoided. A scenario where this would be required would be if a <code>sub_criteria</code> is being assessed and multiple index events can have different attributes.</p>
<div id="reduce-the-number-of-records-being-assessed" class="section level3">
<h3 class="hasAnchor">
<a href="#reduce-the-number-of-records-being-assessed" class="anchor"></a>Reduce the number of records being assessed</h3>
<p>To further reduce processing time, exact duplicates such as same day events can be excluded prior to the tracking process. These duplicate events can be linked back to the group identifier if they were indexed before exclusion. In the example below, despite both approaches leading to the same outcome and number of iterations, it takes longer to complete the process when working with the duplicate events.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># 10,000 duplicate events from the same `strata` e.g. patient or location</span>
<span class="no">dup_events2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">event_dt</span>, <span class="fl">10000</span>)
<span class="co"># Fast</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="no">ep24a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">dup_events2</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.88    0.13    1.00</span>
<span class="co"># Faster</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  {
    <span class="co"># Duplicate events not included in analysis </span>
    <span class="no">ep24b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">event_dt</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"fixed"</span>)
    <span class="co"># Results recycled for the duplicate events</span>
    <span class="no">ep24b</span> <span class="kw">&lt;-</span> <span class="no">ep24b</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">dup_events2</span>, <span class="no">event_dt</span>)]
    }
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.03    0.00    0.03</span>

<span class="co"># Same outcomes - identical identifiers</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">ep24a</span> <span class="kw">==</span> <span class="no">ep24b</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># and same number of iterations</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">ep24a</span>@<span class="kw">iteration</span>); <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">ep24b</span>@<span class="kw">iteration</span>)
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 2</span></pre></body></html></div>
</div>
<div id="stop-early" class="section level3">
<h3 class="hasAnchor">
<a href="#stop-early" class="anchor"></a>Stop early</h3>
<p><code>episode_max</code>, <code>rolls_max</code> and <code>skip_order</code> are arguments used to stop the episode tracking process once certain conditions are met. By doing this, the total number of iterations and processing time is therefore reduced. <code>episodes_max</code> specifies the maximum number of episodes required from a <code>strata</code>. <code>rolls_max</code> specifies the number of recurrences an index case is allowed. <code>skip_order</code> stops the episode tracking process when all records with the <code>nth</code> level of a <code>custom_sort</code> have been linked to an episode. <code>skip_order</code> is particularly useful when tracking rare events among other common events. Once all rare events have been tracked, the process is stopped. The example below has a mix of two <code>"Rare"</code> events and 20 <code>"Common"</code> events, and takes 11 iterations to complete.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># Attribute 4 - Occurrence</span>
<span class="no">attr_4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Common"</span>, <span class="fl">5</span>), <span class="st">"Rare"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Common"</span>, <span class="fl">12</span>), <span class="st">"Rare"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Common"</span>, <span class="fl">3</span>))
<span class="no">attr_4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">attr_4</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Rare"</span>, <span class="st">"Common"</span>))

<span class="no">dup_events_3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">event_dt</span>, <span class="fl">2</span>)
<span class="no">ep25a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">dup_events_3</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">attr_4</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">attr_4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ep25a</span>)
<span class="co">#&gt; Iterations:                     11</span>
<span class="co">#&gt; Total records:                  22</span>
<span class="co">#&gt;  by record type:</span>
<span class="co">#&gt;      Case:                11</span>
<span class="co">#&gt;      Duplicate_C:         11</span>
<span class="co">#&gt; Total episodes:                 11</span>
<span class="co">#&gt;  by episode type:</span>
<span class="co">#&gt;      Fixed:               11</span>
<span class="co">#&gt;  by episode dataset:</span>
<span class="co">#&gt;      Common:              9</span>
<span class="co">#&gt;      Rare,Common:         2</span>
<span class="co">#&gt;  by episodes duration:</span>
<span class="co">#&gt;      N/A</span>
<span class="co">#&gt;  by records per episode:</span>
<span class="co">#&gt;      2 records:           11</span>
<span class="co">#&gt;  by recurrence:</span>
<span class="co">#&gt;      N/A</span></pre></body></html></div>
<p>However, if a user is only interested in episodes with <code>"Rare"</code> events, <code>skip_order</code> can be used to stop the process when all <code>"Rare"</code> events (1<sup>st</sup> level of <code>custom_sort</code>) have been assigned to an episode. This takes 3 iterations to complete the process, skipping 8 iterations that would have produced episodes without <code>"Rare"</code> events.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">ep25b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="no">dup_events_3</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">attr_4</span>, <span class="kw">skip_order</span> <span class="kw">=</span> <span class="fl">1</span>,
                  <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">attr_4</span>)

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ep25b</span>)
<span class="co">#&gt; Iterations:                     3</span>
<span class="co">#&gt; Total records:                  22</span>
<span class="co">#&gt;  by record type:</span>
<span class="co">#&gt;      Case:                2</span>
<span class="co">#&gt;      Duplicate_C:         2</span>
<span class="co">#&gt;      Skipped:             18</span>
<span class="co">#&gt; Total episodes:                 2</span>
<span class="co">#&gt;  by episode type:</span>
<span class="co">#&gt;      Fixed:               2</span>
<span class="co">#&gt;  by episode dataset:</span>
<span class="co">#&gt;      Rare,Common:         2</span>
<span class="co">#&gt;  by episodes duration:</span>
<span class="co">#&gt;      N/A</span>
<span class="co">#&gt;  by records per episode:</span>
<span class="co">#&gt;      2 records:           2</span>
<span class="co">#&gt;  by recurrence:</span>
<span class="co">#&gt;      N/A</span></pre></body></html></div>
<p><strong>Figure 12: Using <code>skip_order</code> to stop the episode tracking process</strong> <img src="fig_e12.png" width="1000" height="290"></p>
</div>
</div>
</div>
<div id="miscellaneous-tips" class="section level1">
<h1 class="hasAnchor">
<a href="#miscellaneous-tips" class="anchor"></a>Miscellaneous tips</h1>
<div id="track-episodes-in-other-units-of-time" class="section level2">
<h2 class="hasAnchor">
<a href="#track-episodes-in-other-units-of-time" class="anchor"></a>Track episodes in other units of time</h2>
<p>Episodes can be tracked in other units of time using the <code>episode_unit</code> argument. Acceptable options are <code>"seconds"</code>, <code>"minutes"</code>, <code>"hours"</code>, <code>"days"</code>, <code>"weeks"</code>, <code>"months"</code> or <code>"years"</code>. Below is an example of episode tracking by the hour compared to tracking them by day (default).</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">hourly_data</a></span>

<span class="co"># Each unit is relative to a predefined number of seconds. </span>
<span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">episode_unit</a></span>
<span class="co">#&gt; $seconds</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $minutes</span>
<span class="co">#&gt; [1] 60</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $hours</span>
<span class="co">#&gt; [1] 3600</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $days</span>
<span class="co">#&gt; [1] 86400</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $weeks</span>
<span class="co">#&gt; [1] 604800</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $months</span>
<span class="co">#&gt; [1] 2628000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $years</span>
<span class="co">#&gt; [1] 31536000</span>

<span class="co"># 1-day fixed episodes</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>,  <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"days"</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt;  [1] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (C)"</span>
<span class="co">#&gt;  [2] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [3] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [4] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [5] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [6] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [7] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [8] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [9] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [10] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [11] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [12] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [13] "E.13 2019-04-02 00:05:11 == 2019-04-02 00:05:11 (C)"</span>

<span class="co"># 5-hr fixed episodes</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"hours"</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt;  [1] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (C)"</span>
<span class="co">#&gt;  [2] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (D)"</span>
<span class="co">#&gt;  [3] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (D)"</span>
<span class="co">#&gt;  [4] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (C)"</span>
<span class="co">#&gt;  [5] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (D)"</span>
<span class="co">#&gt;  [6] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (D)"</span>
<span class="co">#&gt;  [7] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (C)"</span>
<span class="co">#&gt;  [8] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (D)"</span>
<span class="co">#&gt;  [9] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (D)"</span>
<span class="co">#&gt; [10] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (C)"</span>
<span class="co">#&gt; [11] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [12] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [13] "E.13 2019-04-02 00:05:11 == 2019-04-02 00:05:11 (C)"</span></pre></body></html></div>
<div id="familiar-identifiers-and-pid-objects-for-strata" class="section level3">
<h3 class="hasAnchor">
<a href="#familiar-identifiers-and-pid-objects-for-strata" class="anchor"></a>Familiar identifiers and <code>pid</code> objects for <code>strata</code>
</h3>
<p>See the example below.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">infections</a></span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>, <span class="st">"infection"</span>)]; <span class="no">dbs</span>
<span class="co">#&gt;          date infection</span>
<span class="co">#&gt; 1  2018-04-01       BSI</span>
<span class="co">#&gt; 2  2018-04-07       UTI</span>
<span class="co">#&gt; 3  2018-04-13       UTI</span>
<span class="co">#&gt; 4  2018-04-19       UTI</span>
<span class="co">#&gt; 5  2018-04-25       BSI</span>
<span class="co">#&gt; 6  2018-05-01       UTI</span>
<span class="co">#&gt; 7  2018-05-07       BSI</span>
<span class="co">#&gt; 8  2018-05-13       BSI</span>
<span class="co">#&gt; 9  2018-05-19       RTI</span>
<span class="co">#&gt; 10 2018-05-25       RTI</span>
<span class="co">#&gt; 11 2018-05-31       BSI</span>

<span class="co"># Familiar unique record ids use for the identifiers - optional</span>
<span class="no">dbs</span>$<span class="no">rd_id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">640</span>, <span class="fl">17</span>, <span class="fl">58</span>, <span class="fl">21</span>, <span class="fl">130</span>, <span class="fl">79</span>, <span class="fl">45</span>, <span class="fl">300</span>, <span class="fl">40</span>, <span class="fl">13</span>, <span class="fl">31</span>)

<span class="co"># `strata` based on matching sources of infection</span>
<span class="no">dbs</span>$<span class="no">pids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/links.html">links</a></span>(<span class="kw">sn</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">rd_id</span>, <span class="kw">criteria</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">infection</span>)

<span class="no">dbs</span>$<span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">sn</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">rd_id</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>, <span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pids</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="no">dbs</span>
<span class="co">#&gt;          date infection rd_id           pids     epids</span>
<span class="co">#&gt; 1  2018-04-01       BSI   640 P.31 (CRI 001) E.640 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI    17 P.17 (CRI 001) E.017 (C)</span>
<span class="co">#&gt; 3  2018-04-13       UTI    58 P.17 (CRI 001) E.017 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI    21 P.17 (CRI 001) E.021 (C)</span>
<span class="co">#&gt; 5  2018-04-25       BSI   130 P.31 (CRI 001) E.130 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI    79 P.17 (CRI 001) E.079 (C)</span>
<span class="co">#&gt; 7  2018-05-07       BSI    45 P.31 (CRI 001) E.045 (C)</span>
<span class="co">#&gt; 8  2018-05-13       BSI   300 P.31 (CRI 001) E.045 (D)</span>
<span class="co">#&gt; 9  2018-05-19       RTI    40 P.13 (CRI 001) E.040 (C)</span>
<span class="co">#&gt; 10 2018-05-25       RTI    13 P.13 (CRI 001) E.040 (D)</span>
<span class="co">#&gt; 11 2018-05-31       BSI    31 P.31 (CRI 001) E.031 (C)</span></pre></body></html></div>
</div>
</div>
<div id="use-numeric-values-for-the-date-argument" class="section level2">
<h2 class="hasAnchor">
<a href="#use-numeric-values-for-the-date-argument" class="anchor"></a>Use numeric values for the date argument</h2>
<p><code>numeric</code> values can be supplied to the <code>date</code> argument. In such cases, the <code>episode_unit</code> argument is ignored.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">8.1</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">8.5</span>, <span class="fl">12</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">15</span>, <span class="fl">5</span>, <span class="fl">7</span>)
<span class="no">vals</span>
<span class="co">#&gt;  [1]  8.1  6.0 12.0  8.5 12.0  3.0  8.0 15.0  5.0  7.0</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">.5</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt;  [1] "E.07 8 -&gt; 8.5 (D)" "E.02 6 == 6 (C)"   "E.03 12 == 12 (C)"</span>
<span class="co">#&gt;  [4] "E.07 8 -&gt; 8.5 (D)" "E.03 12 == 12 (D)" "E.06 3 == 3 (C)"  </span>
<span class="co">#&gt;  [7] "E.07 8 -&gt; 8.5 (C)" "E.08 15 == 15 (C)" "E.09 5 == 5 (C)"  </span>
<span class="co">#&gt; [10] "E.10 7 == 7 (C)"</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt;  [1] "E.1 8.1 -&gt; 12 (C)" "E.6 3 -&gt; 8 (D)"    "E.1 8.1 -&gt; 12 (D)"</span>
<span class="co">#&gt;  [4] "E.1 8.1 -&gt; 12 (D)" "E.1 8.1 -&gt; 12 (D)" "E.6 3 -&gt; 8 (C)"   </span>
<span class="co">#&gt;  [7] "E.6 3 -&gt; 8 (D)"    "E.8 15 == 15 (C)"  "E.6 3 -&gt; 8 (D)"   </span>
<span class="co">#&gt; [10] "E.6 3 -&gt; 8 (D)"</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt;  [1] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span>
<span class="co">#&gt;  [5] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (C)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span>
<span class="co">#&gt;  [9] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span></pre></body></html></div>
<div id="infinite-and-missing-case_length-or-recurrence_length" class="section level3">
<h3 class="hasAnchor">
<a href="#infinite-and-missing-case_length-or-recurrence_length" class="anchor"></a>Infinite and missing <code>case_length</code> or <code>recurrence_length</code>
</h3>
<p>You can incorporate missing and infinite cut-offs into your analyses. Events with missing cut-offs will not be used as an index event however, they can be tagged as a duplicate of another index event. Index events with an infinite cut-off will be linked to every other event in its <code>strata</code>.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">vals</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fl">10</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">Inf</span>)
<span class="co">#&gt;  [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (D)" "E.1 (D)" "E.1 (D)" "E.1 (D)"</span>
<span class="co">#&gt;  [8] "E.1 (D)" "E.1 (D)" "E.1 (D)"</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">NA_real_</span>)
<span class="co">#&gt;  [1] "E.01 (C)" "E.02 (C)" "E.03 (C)" "E.04 (C)" "E.05 (C)" "E.06 (C)"</span>
<span class="co">#&gt;  [7] "E.07 (C)" "E.08 (C)" "E.09 (C)" "E.10 (C)"</span></pre></body></html></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Olisaeloka Nsonwu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
