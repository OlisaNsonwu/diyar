<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Implementing case definitions for epidemiological analysis in R • diyar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Implementing case definitions for epidemiological analysis in R">
<meta property="og:description" content="diyar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diyar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/episodes.html">Implementing case definitions for epidemiological analysis in R</a>
    </li>
    <li>
      <a href="../articles/links.html">Multistage deterministic linkage in R</a>
    </li>
    <li>
      <a href="../articles/number_line.html">Number lines and overlaps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OlisaNsonwu/diyar/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="episodes_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Implementing case definitions for epidemiological analysis in R</h1>
            
            <h4 class="date">28 August 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OlisaNsonwu/diyar/blob/master/vignettes/episodes.Rmd"><code>vignettes/episodes.Rmd</code></a></small>
      <div class="hidden name"><code>episodes.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In epidemiological analyses, an exact distinction between temporal events is not always possible. Thus, static but reasonable cut-offs are used to distinguish between events. This is an important aspect of most case definitions. For example, you may want to distinguish between repeat positive infection results. Another example is to distinguish between single-pathogen infections and co-infections.</p>
<p><code><a href="../reference/episodes.html">episodes()</a></code> provide a convenient but flexible way of doing this. It links events into a temporal sequence, which can you can duplicate or use for in a sub-analysis.</p>
<p><em><code><a href="../reference/episodes.html">episode_group()</a></code>, <code><a href="../reference/episodes.html">fixed_episodes()</a></code> and <code><a href="../reference/episodes.html">rolling_episodes()</a></code> are wrapper functions of <code><a href="../reference/episodes.html">episodes()</a></code>. They exist to support code from earlier versions of <code>diyar (&lt; v0.2.0)</code>. Please consider using <code><a href="../reference/episodes.html">episodes()</a></code> moving forward.</em></p>
</div>
<div id="uses" class="section level1">
<h1 class="hasAnchor">
<a href="#uses" class="anchor"></a>Uses</h1>
<p>These functions can process a variety of case definitions. See examples below.</p>
<ul>
<li>episodes where events occur at single time points. For example, medical diagnoses or traffic incidents.</li>
<li>episodes where events occur over a period of time e.g. hospital admission or incubation periods. See <a href="#interval_grouping">interval grouping</a>.</li>
<li>episodes where the events recur.</li>
<li>episodes with known index (reference) events. See <a href="#custom_sort">“user defined index events”</a>.</li>
<li>episodes with different durations depending on the type of event. See <a href="#stratified_grouping">stratified episode tracking</a>.</li>
</ul>
</div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>An episode as produced by <code><a href="../reference/episodes.html">episodes()</a></code> is a set of events (dated records) within a specified period. Each episode begins with an index event and may contain duplicate or recurrent events. There are two types - <code>"fixed"</code> episodes that do not include periods of recurrence, and <code>"rolling"</code> episodes that do.</p>
</div>
<div id="implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h1>
<p><a id="episode_grouping"></a></p>
<div id="episodes-windows-case-lengths-and-recurrence-periods" class="section level2">
<h2 class="hasAnchor">
<a href="#episodes-windows-case-lengths-and-recurrence-periods" class="anchor"></a>Episodes, windows, case lengths and recurrence periods</h2>
<p>Before we begin, let’s go over some terms which will pop up now and again.</p>
<ul>
<li>
<code>event</code> - a dated record i.e. single time point.</li>
<li>
<code>event period</code> - <code>events</code> with a known duration i.e. start and endpoints in time.</li>
<li>
<code>reference event/period</code> - index <code>event</code>.</li>
<li>
<code>"lengths"</code> - temporal cut-offs for distinguishing between <code>events</code>.
<ul>
<li>
<code>case_length</code> - cut-off period to distinguish one <code>event</code> from another.</li>
<li>
<code>recurrence_length</code> - cut-off period to distinguish an <code>event</code> from its recurrence.</li>
</ul>
</li>
<li>
<code>window</code> - all <code>events</code> within the same <code>case_length</code> <strong>or</strong> <code>recurrence_length</code>
<ul>
<li>
<code>case window</code> - all <code>events</code> within a <code>case_length</code>.</li>
<li>
<code>recurrence window</code> - all <code>events</code> within a <code>recurrence_length</code>.</li>
</ul>
</li>
<li>
<code>episode</code> - all <code>event</code> within the same cut-off period i.e. every overlapping <code>window</code>.</li>
<li>
<code>case event</code> - index <code>event</code> for the entire <code>episode</code>
</li>
<li>
<code>recurrent event</code> - first <code>event</code> within a <code>recurrence_length</code> or period of recurrence.</li>
<li>
<code>duplicate event</code> - repeat <code>event</code> of the <code>case</code> or <code>recurrent event</code>.</li>
<li>
<code>episode tracking</code> - the process of tracking <code>events</code> to <code>episodes</code>.</li>
</ul>
<p>In <code>"fixed" episodes</code>, each <code>window</code> forms a separate <code>episode</code>. Conversely, in <code>"rolling" episodes</code> overlapping <code>windows</code> merge into a larger one. This signifies that the <code>episode</code> is still on-going or has recurred. As a result, every <code>event</code> in both <code>windows</code> are considered part of the same <code>"rolling" episode</code>.</p>
</div>
<div id="how-to-apply-a-case-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-apply-a-case-definition" class="anchor"></a>How to apply a case definition</h2>
<div id="epid-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#epid-objects" class="anchor"></a>epid objects</h3>
<p>Firstly, let’s go through what <code>episodes</code> look like in <code>diyar</code>. They are stored as <code>epid</code> objects (<code>S4</code> object class). An <code>epid</code> object is an <code>episode</code> identifier with <code>slots</code> for additional information about each <code>episode</code>.</p>
<pre><code>#&gt;       events data_source                             epid
#&gt; 1 2019-04-01         DS1 E.1 2019-04-01 -&gt; 2019-04-11 (C)
#&gt; 2 2019-04-06         DS1 E.1 2019-04-01 -&gt; 2019-04-11 (D)
#&gt; 3 2019-04-10         DS3 E.1 2019-04-01 -&gt; 2019-04-11 (R)
#&gt; 4 2019-04-11         DS1 E.1 2019-04-01 -&gt; 2019-04-11 (D)</code></pre>
<p>For an <code>epid</code> the following information will be displayed (<code>format.epid</code>);</p>
<ul>
<li>
<code>E.1</code> - <code>episode</code> identifier.</li>
<li>
<code>2019-04-01 -&gt; 2019-04-11</code> - <code>episode</code> duration. <em>Only shown if <code>group_stats</code> is <code>TRUE</code>.</em>
</li>
<li>
<code>(C)/(D)/(R)</code> - type of event i.e. <code>case</code>, <code>duplicate</code> and <code>recurrent events</code> respectively</li>
</ul>
<p><em>See <code><a href="../reference/episodes.html">?episodes</a></code> for further details.</em></p>
<p><em>to_df() transforms <code>epid</code> objects to <code>data.frames</code>.</em></p>
<pre><code>#&gt; to_df(`epid`)
#&gt;   epid sn wind_id    wind_nm     case_nm dist_from_wind dist_from_epid
#&gt; 1    1  1       1       Case        Case         0 days         0 days
#&gt; 2    1  2       1       Case Duplicate_C         5 days         5 days
#&gt; 3    1  3       2 Recurrence   Recurrent         4 days         9 days
#&gt; 4    1  4       2 Recurrence Duplicate_R         5 days        10 days
#&gt;   epid_start   epid_end epid_length epid_total epid_dataset iteration
#&gt; 1 2019-04-01 2019-04-11     10 days          4      DS1,DS3         1
#&gt; 2 2019-04-01 2019-04-11     10 days          4      DS1,DS3         1
#&gt; 3 2019-04-01 2019-04-11     10 days          4      DS1,DS3         2
#&gt; 4 2019-04-01 2019-04-11     10 days          4      DS1,DS3         2</code></pre>
</div>
<div id="cut-offs---case-and-recurrence-lengths" class="section level3">
<h3 class="hasAnchor">
<a href="#cut-offs---case-and-recurrence-lengths" class="anchor"></a>cut-offs - case and recurrence lengths</h3>
<p>Your first consideration should be a cut-off point to distinguish between <code>episodes</code>. Here, this is the <code>case_length</code>. A <code>case_length</code> of <code>5</code> means that; repeat <code>events</code> within <code>6 days (Time difference of 5 days)</code> of the <code>reference event</code> are considered <code>duplicates</code> of the <code>reference event</code>. See below.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">diyar</span>)

<span class="co"># Events</span>
<span class="no">ds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"03/04/2019"</span>, <span class="st">"13/04/2019"</span>,<span class="st">"16/04/2019"</span>, <span class="st">"18/04/2019"</span>)
<span class="no">ds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">ds</span>, <span class="st">"%d/%m/%Y"</span>))
<span class="no">ds</span>$<span class="no">date</span>
<span class="co">#&gt; [1] "2019-04-01" "2019-04-03" "2019-04-13" "2019-04-16" "2019-04-18"</span></pre></body></html></div>
<p><strong>Figure 1a: fixed episodes</strong></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># 6-day (5-day difference) episodes - fixed episodes</span>
<span class="no">ds</span>$<span class="no">f1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">ds</span>$<span class="no">f1</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.3 (D)" "E.3 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-7-1.png" width="816"></p>
<p>Alternatively, you can specify a cut-off range. For example, a <code>case_length</code> of <code>12 -&gt; 16</code> means that; repeat <code>events</code> within <code>13</code> and <code>17</code> days after the <code>reference event</code> are considered <code>duplicates</code> of the <code>reference event</code>. Such ranges must be created with <code><a href="../reference/number_line.html">number_line()</a></code>. See the <a href="number_line.html">number line vignette</a>.</p>
<p><strong>Figure 1b: fixed episodes with a cut-off range</strong></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">rng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">12</span>, <span class="fl">16</span>); <span class="no">rng</span>
<span class="co">#&gt; [1] "12 -&gt; 16"</span>
<span class="no">ds</span>$<span class="no">f2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rng</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">ds</span>$<span class="no">f2</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.2 (C)" "E.1 (D)" "E.1 (D)" "E.2 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-9-1.png" width="816"></p>
<p><code>events</code> before the <code>13th</code> can be skipped by changing <code>skip_if_b4_lengths</code> to <code>TRUE</code>.</p>
<p><strong>Figure 1c: fixed episodes where events before the the cut-off range are not skipped</strong></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ds</span>$<span class="no">f3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rng</span>,
                  <span class="kw">skip_if_b4_lengths</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.6 secs!</span>
<span class="no">ds</span>$<span class="no">f3</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.2 (S)" "E.1 (D)" "E.1 (D)" "E.5 (C)"</span></pre></body></html></div>
<p><a id="case_assignment"></a></p>
<p><img src="episodes_files/figure-html/unnamed-chunk-11-1.png" width="816"></p>
<p>Finally, you can use multiple <code>case_lengths</code> by supplying these as a <code>list</code>. For example, a <code>case_length</code> of <code><a href="https://rdrr.io/r/base/list.html">list(5, number_line(15, 17))</a></code> means that; repeat events within <code>6 days</code>, and within <code>16</code> and <code>18 days</code> after the index event are considered duplicates.</p>
<p><strong>Figure 1d: fixed episodes with multiple <code>case_lengths</code></strong></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">rngs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">5</span>, <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">15</span>, <span class="fl">17</span>))
<span class="no">ds</span>$<span class="no">f4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rngs</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">ds</span>$<span class="no">f4</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.1 (D)" "E.1 (D)"</span></pre></body></html></div>
<p><em>Note: <code>case_lengths</code> and <code>recurrence_lengths</code> are always calculated from the endpoint of an event. This has no practical implication when working with time points because the start and end points are the same. However, this is not the case for <code>event period</code>. See <a href="#interval_grouping">interval grouping</a> for more information about this.</em></p>
</div>
<div id="reference-events" class="section level3">
<h3 class="hasAnchor">
<a href="#reference-events" class="anchor"></a>Reference events</h3>
<p>Your next consideration should be the index (<code>reference</code>) <code>event</code>. It’s common practice for this to be the earliest <code>event</code>. However, there are times when the most recent <code>event</code> will be more appropriate. For example, the most recent positive infection result before a patient dies. This can then be the index <code>event</code>. You achieve this by changing <code>from_last</code> to <code>TRUE</code>. This starts <code>episode tracking</code> at the most recent <code>event</code> and proceed backwards in time.</p>
<p><strong>Figure 2: fixed episodes where episode tracking was backwards in time</strong></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">ds</span>$<span class="no">f4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">from_last</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">ds</span>$<span class="no">f4</span>
<span class="co">#&gt; [1] "E.2 (D)" "E.2 (C)" "E.5 (D)" "E.5 (D)" "E.5 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-14-1.png" width="816"></p>
<p><a id="custom_sort"></a></p>
<div id="user-defined-index-events" class="section level4">
<h4 class="hasAnchor">
<a href="#user-defined-index-events" class="anchor"></a>User-defined index events</h4>
<p>Sometimes the type of <code>event</code> is more relevant to determining if it’s an index <code>event</code>. For example, determining the index infection among co-infections. Below is an example with a co-infection involving human immunodeficiency virus (HIV), hepatitis B virus (HBV) and <em>Mycobacterium tuberculosis</em> (MyCt).</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ds2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span><span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"13/03/2020"</span>, <span class="st">"01/04/2020"</span>,<span class="st">"15/08/2020"</span>,
                                   <span class="st">"11/12/2020"</span>, <span class="st">"31/12/2020"</span>), <span class="st">"%d/%m/%Y"</span>),
                  <span class="kw">diag</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"HBV"</span>,<span class="st">"HIV"</span>,<span class="st">"MyCt"</span>,<span class="st">"HBV"</span>, <span class="st">"MyCt"</span>),
                  <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="no">F</span>)


<span class="co"># First, make the HIV diagnosis the index event </span>
<span class="no">ds2</span>$<span class="no">user_ord</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">ds2</span>$<span class="no">diag</span><span class="kw">==</span><span class="st">"HIV"</span>, <span class="fl">1</span>,<span class="fl">2</span>)

<span class="co"># Then track concurrent infections up to 6 months AFTER the HIV diagnosis</span>
<span class="no">ds2</span>$<span class="no">ep1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">diag</span>,
                          <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="co"># Using `data_source` populates the `epid_dataset` slot of the `epid` object. </span>
<span class="co"># This is useful when you're working with different datasets</span>
<span class="no">ds2</span>$<span class="no">ep1_ds</span> <span class="kw">&lt;-</span> <span class="no">ds2</span>$<span class="no">ep1</span>@<span class="kw">epid_dataset</span>

<span class="co"># Track preceding infections up to 6 months BEFORE the HIV diagnosis</span>
<span class="no">ds2</span>$<span class="no">ep2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">diag</span>,
                          <span class="kw">case_length</span> <span class="kw">=</span> -<span class="fl">6</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">ds2</span>$<span class="no">ep2_ds</span> <span class="kw">&lt;-</span> <span class="no">ds2</span>$<span class="no">ep2</span>@<span class="kw">epid_dataset</span>

<span class="no">ds2</span>
<span class="co">#&gt;         date diag user_ord     ep1   ep1_ds     ep2  ep2_ds</span>
<span class="co">#&gt; 1 2020-03-13  HBV        2 E.1 (C)      HBV E.2 (D) HBV,HIV</span>
<span class="co">#&gt; 2 2020-04-01  HIV        1 E.2 (C) HIV,MyCt E.2 (C) HBV,HIV</span>
<span class="co">#&gt; 3 2020-08-15 MyCt        2 E.2 (D) HIV,MyCt E.3 (C)    MyCt</span>
<span class="co">#&gt; 4 2020-12-11  HBV        2 E.4 (C) HBV,MyCt E.4 (C)     HBV</span>
<span class="co">#&gt; 5 2020-12-31 MyCt        2 E.4 (D) HBV,MyCt E.5 (C)    MyCt</span></pre></body></html></div>
<p>Notice that in <code>ep1</code>, the HIV diagnosis and the HBV diagnosis before it are not linked. This also happens with the HIV and MyCt diagnoses in <code>ep2</code>. This is because <code>episode tracking</code> occurs in one direction of time (<code>from_last</code>). If required, you can track <code>events</code> in both directions for time i.e. before and after an index <code>event</code>. You can do this by supplying an applicable cut-off range e.g. <code><a href="../reference/number_line.html">number_line(-6, 6)</a></code> or <code><a href="https://rdrr.io/r/base/list.html">list(number_line(-6, 0), number_line(0, 6))</a></code>. To some extent, you can also do this with the old <code>bi_direction</code> argument.</p>
<p>See examples of each approach below.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Track preceding and concurrent infections up to 6 months BEFORE OR AFTER the HIV diagnosis</span>

<span class="co"># Method 1a</span>
<span class="co"># Track diagnoses 6 months AFTER the HIV diagnosis.</span>
  <span class="co"># `bi_direction` then makes the function to also check 6 months BEFORE the HIV diagnosis</span>
<span class="no">ds2</span>$<span class="no">ep3a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">fixed_episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">6</span>,
                           <span class="kw">bi_direction</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.69 secs!</span>

<span class="co"># Method 1b</span>
<span class="co"># Track diagnoses 6 months BEFORE the HIV diagnosis</span>
  <span class="co"># bi_direction` then makes the function to also check 6 months AFTER the HIV diagnosis</span>
<span class="no">ds2</span>$<span class="no">ep3b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">fixed_episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">case_length</span> <span class="kw">=</span> -<span class="fl">6</span>,
                           <span class="kw">bi_direction</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>,
                           <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">diag</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.75 secs!</span>

<span class="co"># Method 2a</span>
<span class="co"># Track diagnoses 6 months BEFORE or AFTER the HIV diag. </span>
  <span class="co"># There's no need for `bi_direction`.</span>
<span class="no">rng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(-<span class="fl">6</span>, <span class="fl">6</span>)
<span class="no">ds2</span>$<span class="no">ep4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rng</span>,
                    <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">diag</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="co"># Method 2b</span>
<span class="co"># Track diagnoses within 1-6 months AFTER the HIV diagnosis. </span>
  <span class="co">#` bi_direction` then makes the function to also check within 1-6 months BEFORE the HIV diagnosis</span>
<span class="co"># Diagnoses before 2 months on either side are skipped as mentioned in the "cut-offs" section</span>
<span class="no">rng2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">1</span>, <span class="fl">6</span>)
<span class="no">ds2</span>$<span class="no">ep5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">fixed_episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rng2</span>,
                          <span class="kw">bi_direction</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 1.05 secs!</span>

<span class="co"># Method 3a</span>
<span class="co"># Track diagnoses within 1-4 months AFTER the HIV diagnosis, AND </span>
  <span class="co"># between 4-6 months</span>
  <span class="co"># bi_direction` then makes the function to also check 2-4, and 4-6 month BEFORE the HIV diagnosis</span>
<span class="no">rngs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">1</span>, <span class="fl">4</span>), <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">4</span>, <span class="fl">6</span>))
<span class="no">ds2</span>$<span class="no">ep6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">fixed_episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rngs</span>,
                          <span class="kw">bi_direction</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 1.67 secs!</span>

<span class="co"># Method 3b</span>
<span class="co"># Track diagnoses within 2-4 and 4-6 months BEFORE OR AFTER the HIV diagnosis</span>
  <span class="co"># There's no need for `bi_direction`.</span>
<span class="no">rngs2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">rngs</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">rngs</span>, <span class="no">invert_number_line</span>))
<span class="no">rngs2</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "1 -&gt; 4"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "4 -&gt; 6"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "-1 &lt;- -4"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] "-4 &lt;- -6"</span>
<span class="no">ds2</span>$<span class="no">ep7</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">date</span>, <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">ds2</span>$<span class="no">user_ord</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">rngs2</span>,
                    <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"months"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.95 secs!</span>

<span class="no">ds2</span>
<span class="co">#&gt;         date diag user_ord     ep1   ep1_ds     ep2  ep2_ds    ep3a    ep3b</span>
<span class="co">#&gt; 1 2020-03-13  HBV        2 E.1 (C)      HBV E.2 (D) HBV,HIV E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 2 2020-04-01  HIV        1 E.2 (C) HIV,MyCt E.2 (C) HBV,HIV E.2 (C) E.2 (C)</span>
<span class="co">#&gt; 3 2020-08-15 MyCt        2 E.2 (D) HIV,MyCt E.3 (C)    MyCt E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 4 2020-12-11  HBV        2 E.4 (C) HBV,MyCt E.4 (C)     HBV E.4 (C) E.4 (C)</span>
<span class="co">#&gt; 5 2020-12-31 MyCt        2 E.4 (D) HBV,MyCt E.5 (C)    MyCt E.4 (D) E.4 (D)</span>
<span class="co">#&gt;       ep4     ep5     ep6     ep7</span>
<span class="co">#&gt; 1 E.2 (D) E.1 (C) E.1 (C) E.1 (C)</span>
<span class="co">#&gt; 2 E.2 (C) E.2 (C) E.2 (C) E.2 (C)</span>
<span class="co">#&gt; 3 E.2 (D) E.2 (D) E.2 (D) E.2 (D)</span>
<span class="co">#&gt; 4 E.4 (C) E.4 (C) E.4 (C) E.4 (C)</span>
<span class="co">#&gt; 5 E.4 (D) E.5 (C) E.5 (C) E.5 (C)</span></pre></body></html></div>
<p>Ties in preference for index <code>events</code> (<code>custom_sort</code> values) will be broken with the chronological order of those events. This will either be the earliest or most recent <code>event</code> depending on <code>from_last</code>. Alternatively, you can break such ties with extra levels of <code>custom_sort</code>. <em>See <code>?custom_sort()</code></em>.</p>
<p>See the example below for tracking <code>episodes</code> using 2 and 3 levels of <code>custom_sort</code>.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">dbf</span> <span class="kw">&lt;-</span> <span class="no">infections</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>, <span class="st">"infection"</span>)]

<span class="co"># 3 levels: "UTI" &gt; "BSI" &gt; "RTI"</span>
<span class="no">dbf</span>$<span class="no">c_sort1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"UTI"</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"BSI"</span>, <span class="fl">2</span>, <span class="fl">3</span>))
<span class="co"># 2 levels: "UTI" &gt; ("BSI" OR "RTI")</span>
<span class="no">dbf</span>$<span class="no">c_sort2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"UTI"</span>, <span class="fl">1</span>, <span class="fl">2</span>)
<span class="co"># 2 levels: "BSI" &gt; ("UTI" OR "RTI")</span>
<span class="no">dbf</span>$<span class="no">c_sort3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"BSI"</span>, <span class="fl">1</span>, <span class="fl">2</span>)

<span class="no">dbf</span>$<span class="no">ep_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">infection</span>,
                     <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">c_sort1</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">dbf</span>$<span class="no">ep_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">infection</span>,
                     <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">c_sort2</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">dbf</span>$<span class="no">ep_3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">infection</span>,
                     <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">c_sort3</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">dbf</span>
<span class="co">#&gt;          date infection c_sort1 c_sort2 c_sort3     ep_1    ep_2     ep_3</span>
<span class="co">#&gt; 1  2018-04-01       BSI       2       2       1 E.01 (C) E.1 (C) E.01 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI       1       1       2 E.02 (C) E.2 (C) E.01 (D)</span>
<span class="co">#&gt; 3  2018-04-13       UTI       1       1       2 E.02 (D) E.2 (D) E.01 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI       1       1       2 E.02 (D) E.2 (D) E.04 (C)</span>
<span class="co">#&gt; 5  2018-04-25       BSI       2       2       1 E.05 (C) E.5 (C) E.05 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI       1       1       2 E.06 (C) E.6 (C) E.05 (D)</span>
<span class="co">#&gt; 7  2018-05-07       BSI       2       2       1 E.06 (D) E.6 (D) E.05 (D)</span>
<span class="co">#&gt; 8  2018-05-13       BSI       2       2       1 E.06 (D) E.6 (D) E.08 (C)</span>
<span class="co">#&gt; 9  2018-05-19       RTI       3       2       2 E.09 (C) E.9 (C) E.08 (D)</span>
<span class="co">#&gt; 10 2018-05-25       RTI       3       2       2 E.09 (D) E.9 (D) E.08 (D)</span>
<span class="co">#&gt; 11 2018-05-31       BSI       2       2       1 E.11 (C) E.9 (D) E.11 (C)</span></pre></body></html></div>
<p><code><a href="../reference/custom_sort.html">custom_sort()</a></code> is convenience function for nested sorting. This will help you merge <code>custom_sort</code> orders into one atomic vector. See the examples below.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">dbf</span>$<span class="no">uti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"UTI"</span>, <span class="fl">1</span>, <span class="fl">2</span>)
<span class="no">dbf</span>$<span class="no">bsi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"BSI"</span>, <span class="fl">1</span>, <span class="fl">2</span>)
<span class="no">dbf</span>$<span class="no">rti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"RTI"</span>, <span class="fl">1</span>, <span class="fl">2</span>)

<span class="co"># 3 levels: "UTI" &gt; "BSI" &gt; "RTI"</span>
<span class="no">dbf</span>$<span class="no">c_sort1b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/custom_sort.html">custom_sort</a></span>(<span class="no">dbf</span>$<span class="no">uti</span>, <span class="no">dbf</span>$<span class="no">bsi</span>, <span class="no">dbf</span>$<span class="no">rti</span>)

<span class="no">dbf</span>$<span class="no">ep_1b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">15</span>,
                      <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">infection</span>,
                      <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">c_sort1b</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="co"># Same results</span>
<span class="no">dbf</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ep_1"</span>, <span class="st">"ep_1b"</span>)]
<span class="co">#&gt;        ep_1    ep_1b</span>
<span class="co">#&gt; 1  E.01 (C) E.01 (C)</span>
<span class="co">#&gt; 2  E.02 (C) E.02 (C)</span>
<span class="co">#&gt; 3  E.02 (D) E.02 (D)</span>
<span class="co">#&gt; 4  E.02 (D) E.02 (D)</span>
<span class="co">#&gt; 5  E.05 (C) E.05 (C)</span>
<span class="co">#&gt; 6  E.06 (C) E.06 (C)</span>
<span class="co">#&gt; 7  E.06 (D) E.06 (D)</span>
<span class="co">#&gt; 8  E.06 (D) E.06 (D)</span>
<span class="co">#&gt; 9  E.09 (C) E.09 (C)</span>
<span class="co">#&gt; 10 E.09 (D) E.09 (D)</span>
<span class="co">#&gt; 11 E.11 (C) E.11 (C)</span></pre></body></html></div>
<p><a id="recurrence"></a><a></a></p>
</div>
</div>
<div id="recurrent-events-and-periods-of-recurrence" class="section level3">
<h3 class="hasAnchor">
<a href="#recurrent-events-and-periods-of-recurrence" class="anchor"></a>Recurrent events and periods of recurrence</h3>
<p>Some case definition may specify that <code>events</code> recur (<code>"rolling" episodes</code>). For example, relapses of the same infection after successful treatment. It may be important to treat this as the same <code>episode</code> of the initial infection. This differs from a <code>"fixed" episode</code>, where the relapse is handled as a separate <code>episode</code>.</p>
<p>The <code>recurrence_length</code> argument provides the cut-off period for <code>recurrent events</code>. For example, a <code>recurrence_length</code> of <code>10</code> means that; repeat <code>events</code> within <code>11</code> days of the last <code>duplicate event</code> (of the initial index <code>event</code>) are considered a recurrence of the index <code>event</code>.</p>
<p><em>If <code>recurrence_length</code> is not supplied, it’s assumed to be the same as the <code>case_length</code>.</em></p>
<p><strong>Figure 3a: rolling episodes</strong></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># 6-day (5-day difference) episodes with 11-days recurrence periods - rolling episodes</span>
<span class="no">ds</span>$<span class="no">r1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>,
                  <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">10</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">ds</span>$<span class="no">r1</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-20-1.png" width="816"></p>
<p>Similarly, for <code>recurrence_length</code>, you can use a cut-off range. For example, a <code>recurrence_length</code> of <code>13 -&gt; 15</code> means that; repeat <code>events</code> between <code>14</code> and <code>16</code> days after the last <code>duplicate event</code> are considered a recurrence of the index <code>event</code>.</p>
<p><strong>Figure 3b: rolling episodes with a cut-off range</strong></p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">rng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">13</span>, <span class="fl">15</span>); <span class="no">rng</span>
<span class="co">#&gt; [1] "13 -&gt; 15"</span>
<span class="no">ds</span>$<span class="no">r2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">rng</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.7 secs!</span>

<span class="no">ds</span>$<span class="no">r2</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.1 (R)" "E.1 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-22-1.png" width="816"></p>
<p>You can skip <code>events</code> before the <code>14th</code> by changing <code>skip_if_b4_lengths</code> to <code>TRUE</code>.</p>
<p><strong>Figure 3c: rolling episodes where events before the the cut-off range are not skipped</strong></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">rng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">13</span>, <span class="fl">15</span>); <span class="no">rng</span>
<span class="co">#&gt; [1] "13 -&gt; 15"</span>
<span class="no">ds</span>$<span class="no">r3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">rng</span>,
                  <span class="kw">skip_if_b4_lengths</span> <span class="kw">=</span> <span class="no">F</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.78 secs!</span>

<span class="no">ds</span>$<span class="no">r3</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.1 (R)" "E.1 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-24-1.png" width="816"></p>
<p>As with <code>case_length</code>, you can supply multiple <code>recurrence_lengths</code> as a list.</p>
<p><strong>Figure 3d: rolling episodes with multiple <code>recurrence_lengths</code></strong></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">rngs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">13</span>, <span class="fl">14</span>), <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">15</span>,<span class="fl">18</span>)); <span class="no">rngs</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "13 -&gt; 14"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "15 -&gt; 18"</span>
<span class="no">ds</span>$<span class="no">r4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">ds</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">rngs</span>,
                  <span class="kw">skip_if_b4_lengths</span> <span class="kw">=</span> <span class="no">F</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.92 secs!</span>

<span class="no">ds</span>$<span class="no">r4</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.1 (R)" "E.1 (D)"</span></pre></body></html></div>
<div id="index-events-for-periods-of-recurrence" class="section level4">
<h4 class="hasAnchor">
<a href="#index-events-for-periods-of-recurrence" class="anchor"></a>Index events for periods of recurrence</h4>
<p>Each <code>"rolling" episode</code> has at least two index-<code>events</code>. one for the whole <code>episode</code> and one for each period of recurrence. By default, the last <code>event</code> of the previous <code>window</code> is the index <code>event</code> for the next period of recurrence. Changing <code>recurrence_from_last</code> to <code>FALSE</code>, specifies that the first <code>event</code> in the previous window is used. See a demonstration of this below.</p>
<p><em>If the <code>case_length</code> is the same the <code>recurrence_length</code> and you’ll create a <code>"fixed" episode</code></em>.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"11/04/2019"</span>, <span class="st">"16/04/2019"</span>,<span class="st">"21/04/2019"</span>, <span class="st">"07/05/2019"</span>)
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">df</span>, <span class="st">"%d/%m/%Y"</span>))

<span class="co"># 15-day fixed episodes are the same as 15-day rolling episodes where `recurrence_from_last` is FALSE</span>
<span class="no">df</span>$<span class="no">f1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">date</span>,
                  <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">14</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">df</span>$<span class="no">r1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">14</span>,
                  <span class="kw">recurrence_from_last</span> <span class="kw">=</span> <span class="no">F</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.71 secs!</span>

<span class="no">df</span>
<span class="co">#&gt;         date      f1      r1</span>
<span class="co">#&gt; 1 2019-04-01 E.1 (C) E.1 (C)</span>
<span class="co">#&gt; 2 2019-04-11 E.1 (D) E.1 (D)</span>
<span class="co">#&gt; 3 2019-04-16 E.3 (C) E.3 (C)</span>
<span class="co">#&gt; 4 2019-04-21 E.3 (D) E.3 (D)</span>
<span class="co">#&gt; 5 2019-05-07 E.5 (C) E.5 (C)</span></pre></body></html></div>
<p><strong>Figure 4a: Last event in a window taken as the reference event for the next recurrence window (default)</strong></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">df</span>$<span class="no">r2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">14</span>,
                  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">16</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">df</span>$<span class="no">r2</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (R)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-28-1.png" width="816"></p>
<p><strong>Figure 4b: First event in a window taken as the reference event for the next recurrence window</strong></p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">df</span>$<span class="no">r3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">14</span>,
                  <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">16</span>,
                  <span class="kw">recurrence_from_last</span> <span class="kw">=</span> <span class="no">F</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.63 secs!</span>

<span class="no">df</span>$<span class="no">r3</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-30-1.png" width="816"></p>
</div>
<div id="case-windows-for-both-case-and-recurrent-events" class="section level4">
<h4 class="hasAnchor">
<a href="#case-windows-for-both-case-and-recurrent-events" class="anchor"></a>Case windows for both case and recurrent events</h4>
<p>You can use the <code>case_for_recurrence</code> argument to specify that both <code>case</code> and <code>recurrence events</code> should have a <code>case window</code>. The default behaviour is that only <code>case events</code> have a <code>case window</code>. See a demonstration of this below.</p>
<p><em>The <code>wind_id</code> slot shows the <code>window</code> of every <code>event</code>, while <code>wind_nm</code> shows what type of <code>window</code> it is.</em></p>
<p><em>Example 1</em></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"11/04/2019"</span>, <span class="st">"16/04/2019"</span>,<span class="st">"21/04/2019"</span>,<span class="st">"25/04/2019"</span>, <span class="st">"07/05/2019"</span>)
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">df</span>, <span class="st">"%d/%m/%Y"</span>))</pre></body></html></div>
<p><strong>Figure 5a: Case windows for case events only (default)</strong></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">df</span>$<span class="no">r4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">date</span>,
                  <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">10</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.69 secs!</span>

<span class="no">df</span>$<span class="no">r4</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (R)" "E.6 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-33-1.png" width="816"></p>
<p><strong>Figure 5b: Case windows for case and recurrence events</strong></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">df</span>$<span class="no">r5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">10</span>,
                  <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                  <span class="kw">case_for_recurrence</span> <span class="kw">=</span> <span class="no">T</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.67 secs!</span>

<span class="no">df</span>$<span class="no">r5</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (D)" "E.6 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-35-1.png" width="816"></p>
<p><em>Example 2</em></p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">date</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"%d/%m/%Y"</span>),
                  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"21/04/2019"</span>,<span class="st">"%d/%m/%Y"</span>),
                  <span class="kw">by</span><span class="kw">=</span><span class="st">"3 day"</span>)
<span class="co"># Example 2</span>
<span class="no">df2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">sn</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">date</span>))
<span class="co"># dates</span>
<span class="no">df2</span>$<span class="no">date</span>
<span class="co">#&gt; [1] "2019-04-01" "2019-04-04" "2019-04-07" "2019-04-10" "2019-04-13"</span>
<span class="co">#&gt; [6] "2019-04-16" "2019-04-19"</span></pre></body></html></div>
<p><strong>Figure 5c: Case windows for case events only (default)</strong></p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">df2</span>$<span class="no">r1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df2</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">6</span>,
                   <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">sn</span><span class="kw">=</span><span class="no">df2</span>$<span class="no">sn</span>,
                   <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                   <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.68 secs!</span>

<span class="no">df2</span>$<span class="no">r1</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-38-1.png" width="816"></p>
<p><strong>Figure 5d: Case windows for case and recurrence events</strong></p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">df2</span>$<span class="no">r2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">df2</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">6</span>,
                   <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">case_for_recurrence</span> <span class="kw">=</span> <span class="no">T</span>,
                   <span class="kw">sn</span><span class="kw">=</span><span class="no">df2</span>$<span class="no">sn</span>, <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                   <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.62 secs!</span>

<span class="no">df2</span>$<span class="no">r1</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-40-1.png" width="816"></p>
<p>Notice that in the 4 examples, all <code>events</code> have been assigned to the same <code>episode</code> but the number of <code>recurrent events</code> differs.</p>
</div>
</div>
<div id="number-of-recurrence-periods-and-episodes" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-recurrence-periods-and-episodes" class="anchor"></a>Number of recurrence periods and episodes</h3>
<p>Some case definitions may only need you to track the first <code>n</code>-number of <code>episodes</code> or specify that they only recur <code>n</code>-number of times. You can incorporate these requirements into your analyses using <code>episodes_max</code> and <code>rolls_max</code> respectively. When each <code>strata</code> (see <a href="#stratified_grouping">stratified episode tracking</a>) of the dataset has the maximum number of <code>episodes</code> as specified by <code>episodes_max</code>, subsequent <code>events</code> are skipped. The default option for <code>episodes_max</code> is <code>Inf</code> i.e. continue <code>episode tracking</code> until every <code>event</code> is linked to an <code>episode</code>. See the examples below.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"infections_3"</span>);
<span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="no">infections_3</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pid"</span>,<span class="st">"date"</span>)];
<span class="co"># dates</span>
<span class="no">dbs</span>$<span class="no">date</span>
<span class="co">#&gt;  [1] "2019-04-01" "2019-04-02" "2019-04-03" "2019-04-04" "2019-04-05"</span>
<span class="co">#&gt;  [6] "2019-04-06" "2019-04-07" "2019-04-08" "2019-04-09" "2019-04-10"</span>
<span class="co">#&gt; [11] "2019-04-11"</span></pre></body></html></div>
<p><strong>Figure 6a: Maximum of one fixed episode per strata</strong></p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">dbs</span>$<span class="no">eps_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pid</span>,
                      <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">3</span>,
                      <span class="kw">episodes_max</span> <span class="kw">=</span> <span class="fl">1</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">dbs</span>$<span class="no">eps_1</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.01 (D)" "E.01 (D)" "E.01 (D)" "E.05 (S)" "E.06 (S)"</span>
<span class="co">#&gt;  [7] "E.07 (S)" "E.08 (S)" "E.09 (S)" "E.10 (S)" "E.11 (S)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-43-1.png" width="816"></p>
<p><strong>Figure 6b: Maximum of two fixed episodes per strata</strong></p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">dbs</span>$<span class="no">eps_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pid</span>,
                      <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">3</span>,
                      <span class="kw">episodes_max</span> <span class="kw">=</span> <span class="fl">2</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">dbs</span>$<span class="no">eps_2</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.01 (D)" "E.01 (D)" "E.01 (D)" "E.05 (C)" "E.05 (D)"</span>
<span class="co">#&gt;  [7] "E.05 (D)" "E.05 (D)" "E.09 (S)" "E.10 (S)" "E.11 (S)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-45-1.png" width="816"></p>
<p><code>rolls_max</code> is the maximum number of times an <code>event</code> can recur. This is when a <code>"rolling" episode</code> ends. A new one will only begin if the number of <code>episodes</code> in that <code>strata</code> is less than <code>episode_max</code>. The default option for <code>rolls_max</code> is <code>Inf</code> i.e. continue tracking <code>recurrent events</code> until there are no more <code>events</code> within the <code>recurrence period</code> of the <code>reference event</code>. See the examples below.</p>
<p><strong>Figure 6c: Infinite recurrence periods per episode per strata (default)</strong></p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">dbs</span>$<span class="no">eps_4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pid</span>,
                      <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">2</span>,
                      <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.82 secs!</span>

<span class="no">dbs</span>$<span class="no">eps_4</span>
<span class="co">#&gt;  [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (R)" "E.1 (D)"</span>
<span class="co">#&gt;  [8] "E.1 (R)" "E.1 (D)" "E.1 (R)" "E.1 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-47-1.png" width="816"></p>
<p><strong>Figure 6d: Maximum of one recurrence period per episode per strata</strong></p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">dbs</span>$<span class="no">eps_6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pid</span>,
                      <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">2</span>,
                      <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                      <span class="kw">rolls_max</span> <span class="kw">=</span> <span class="fl">1</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.81 secs!</span>

<span class="no">dbs</span>$<span class="no">eps_6</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.01 (D)" "E.01 (D)" "E.01 (R)" "E.01 (D)" "E.06 (C)"</span>
<span class="co">#&gt;  [7] "E.06 (D)" "E.06 (D)" "E.06 (R)" "E.06 (D)" "E.11 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-49-1.png" width="816"></p>
<p>Note that after tracking the last <code>recurrent event</code>, the function will also check for <code>duplicates</code> within the <code>case window</code> of the last <code>recurrent event</code>. See below.</p>
<p><strong>Figure 6e: Maximum of one recurrence period per episode per strata when case_for_recurrence is TRUE</strong></p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">dbs</span>$<span class="no">eps_7</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pid</span>,
                      <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">2</span>,
                      <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                      <span class="kw">rolls_max</span> <span class="kw">=</span> <span class="fl">1</span>,
                      <span class="kw">case_for_recurrence</span> <span class="kw">=</span> <span class="no">T</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.75 secs!</span>

<span class="no">dbs</span>$<span class="no">eps_7</span>
<span class="co">#&gt;  [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (D)" "E.1 (D)"</span>
<span class="co">#&gt;  [8] "E.8 (C)" "E.8 (D)" "E.8 (D)" "E.8 (R)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-51-1.png" width="816"></p>
<p><a id="interval_grouping"></a></p>
</div>
<div id="interval-grouping" class="section level3">
<h3 class="hasAnchor">
<a href="#interval-grouping" class="anchor"></a>Interval grouping</h3>
<p>Some case definitions can involve <code>events</code> that occur over a defined period e.g. hospital admissions. <code><a href="../reference/episodes.html">episodes()</a></code> can track such <code>event periods</code> into <code>episodes</code>. This type of <code>episode tracking</code> is recommended when the endpoint of an <code>event</code> is known. For instance, it’s near impossible to know the exact point in time an individual diagnosed with the common cold recovers however, it’s a reasonable assumption that another diagnosis 3 months after the initial one is not the same infection. For situations like this, the recommended approach is to use the methods we’ve covered so far. In contrast, hospital admissions typically have recorded admission and discharge times or dates, and so interval grouping is recommended for tracking such <code>events</code>. This being said, in several situations both approaches can be used interchangeably. See below.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co"># Dates</span>
<span class="no">dates</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"%d/%M/%Y"</span>), <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"20/04/2019"</span>, <span class="st">"%d/%M/%Y"</span>), <span class="st">"4 days"</span>)

<span class="co"># Periods </span>
<span class="no">periods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="no">dates</span>, <span class="no">dates</span> + <span class="fl">4</span>)

<span class="no">dates</span>
<span class="co">#&gt; [1] "2019-08-01" "2019-08-05" "2019-08-09" "2019-08-13" "2019-08-17"</span>
<span class="no">periods</span>
<span class="co">#&gt; [1] "2019-08-01 -&gt; 2019-08-05" "2019-08-05 -&gt; 2019-08-09"</span>
<span class="co">#&gt; [3] "2019-08-09 -&gt; 2019-08-13" "2019-08-13 -&gt; 2019-08-17"</span>
<span class="co">#&gt; [5] "2019-08-17 -&gt; 2019-08-21"</span>

<span class="co"># Track fixed episodes from events with a 5 day cut-off </span>
<span class="no">mth1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dates</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="co"># Track fixed episodes from periods that are 5 days long </span>
<span class="no">mth2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">periods</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="co"># Same results</span>
<span class="no">mth1</span>; <span class="no">mth2</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.3 (D)" "E.5 (C)"</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.3 (D)" "E.5 (C)"</span>

<span class="co"># Track rolling episodes from events using a 5 day cut-off </span>
<span class="no">mth3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dates</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">4</span>,
                 <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.62 secs!</span>

<span class="co"># Track rolling episode from periods that are 5 days long </span>
<span class="no">mth4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">periods</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">0</span>,
                 <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.56 secs!</span>

<span class="co"># Same results</span>
<span class="no">mth3</span>; <span class="no">mth4</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></pre></body></html></div>
<p>As mentioned earlier, <code>case_length</code> and <code>recurrence_lengths</code> are calculated from the endpoints of <code>events period</code>. Therefore, a <code>case_length</code> of 5 is actually the period within 6 days (day difference of 5) of the endpoint. See examples of this below.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">event_period</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"%d/%m/%Y"</span>),
                            <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"10/04/2019"</span>, <span class="st">"%d/%m/%Y"</span>))
<span class="no">event_period</span>
<span class="co">#&gt; [1] "2019-04-01 -&gt; 2019-04-10"</span>

<span class="co"># Case_length of 5 translates to;</span>
<span class="fu"><a href="../reference/windows.html">epid_windows</a></span>(<span class="no">event_period</span>, <span class="fl">5</span>)
<span class="co">#&gt; [1] "2019-04-10 -&gt; 2019-04-15"</span>

<span class="co"># Case_length of 0 translates to;</span>
<span class="fu"><a href="../reference/windows.html">epid_windows</a></span>(<span class="no">event_period</span>, <span class="fl">0</span>)
<span class="co">#&gt; [1] "2019-04-10 == 2019-04-10"</span>

<span class="co"># Case_length of -1 translates to;</span>
<span class="fu"><a href="../reference/windows.html">epid_windows</a></span>(<span class="no">event_period</span>, -<span class="fl">1</span>)
<span class="co">#&gt; [1] "2019-04-10 &lt;- 2019-04-09"</span>

<span class="co"># Case_length of -5 translates to;</span>
<span class="fu"><a href="../reference/windows.html">epid_windows</a></span>(<span class="no">event_period</span>, -<span class="fl">5</span>)
<span class="co">#&gt; [1] "2019-04-10 &lt;- 2019-04-05"</span>

<span class="co"># Case_length of `index_window(x)` translates to;</span>
<span class="fu"><a href="../reference/windows.html">epid_windows</a></span>(<span class="no">event_period</span>, <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">event_period</span>))
<span class="co">#&gt; [1] "2019-04-01 -&gt; 2019-04-10"</span></pre></body></html></div>
<p>In interval grouping, <code>event_period</code> that overlap with the index <code>event period</code> are linked together as an <code>episode</code>.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">hos_admin</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">hospital_admissions</a></span>
<span class="no">hos_admin</span>$<span class="no">admin_period</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="no">hos_admin</span>$<span class="no">admin_dt</span>, <span class="no">hos_admin</span>$<span class="no">discharge_dt</span>)

<span class="co"># Hospital stay</span>
<span class="no">hos_admin</span>$<span class="no">admin_period</span>
<span class="co">#&gt;  [1] "2019-01-01 == 2019-01-01" "2019-01-01 -&gt; 2019-01-10"</span>
<span class="co">#&gt;  [3] "2019-01-10 -&gt; 2019-01-13" "2019-01-05 -&gt; 2019-01-06"</span>
<span class="co">#&gt;  [5] "2019-01-05 -&gt; 2019-01-15" "2019-01-07 -&gt; 2019-01-15"</span>
<span class="co">#&gt;  [7] "2019-01-04 -&gt; 2019-01-13" "2019-01-20 -&gt; 2019-01-30"</span>
<span class="co">#&gt;  [9] "2019-01-26 -&gt; 2019-01-31" "2019-01-01 -&gt; 2019-01-10"</span>
<span class="co">#&gt; [11] "2019-01-20 -&gt; 2019-01-30"</span></pre></body></html></div>
<p><strong>Figure 7a: Tracking periods of hospital stay (admission -&gt; discharge)</strong></p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">hs_epids_a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">hos_admin</span>$<span class="no">admin_period</span>,
                       <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">0</span>, <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">hos_admin</span>$<span class="no">admin_period</span>)),
                       <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-56-1.png" width="816"></p>
<p><strong>Figure 7b: Tracking periods of hospital stay up to 20 days after the first discharge</strong></p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">hs_epids_b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span><span class="kw">=</span><span class="no">hos_admin</span>$<span class="no">admin_period</span>,
                       <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">20</span>, <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">hos_admin</span>$<span class="no">admin_period</span>)),
                       <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-58-1.png" width="816"></p>
<p><strong>Figure 7c: Tracking periods of continuous hospital stay i.e. re-admission within 15 days</strong></p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">hs_epids_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span><span class="kw">=</span><span class="no">hos_admin</span>$<span class="no">admin_period</span>,
                       <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">0</span>, <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">hos_admin</span>$<span class="no">admin_period</span>)),
                       <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">15</span>, <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">hos_admin</span>$<span class="no">admin_period</span>)),
                       <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                       <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.56 secs!</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-60-1.png" width="816"></p>
<p>There are 7 ways <code>event periods</code> can overlap (<code>overlap_methods_c</code>/<code>overlap_methods_r</code>). These are <code>"exact"</code>, <code>"reverse"</code>, <code>"across"</code>, <code>"inbetween"</code>, <code>"chain"</code>, <code>"aligns_start"</code> and <code>"aligns_end"</code>. These are covered in more detail in an accompanying <a href="number_line.html#overlaps">vignette</a>. You can specify that only <code>event periods</code> which overlap in a certain way should be linked as <code>episodes</code>. See below for a demonstration of this.</p>
<p><em>The 7 <code>overlap_methods</code> are mutually exclusive.</em></p>
<p><em>There are 2 convenience methods - <code>"none"</code> and <code>"overlap"</code>. These are mutually inclusive with the others, and so are prioritised.</em></p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">epi_grp_func</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>){
  <span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span><span class="kw">=</span><span class="no">hos_admin</span>$<span class="no">admin_period</span>,
                    <span class="kw">sn</span><span class="kw">=</span><span class="no">hos_admin</span>$<span class="no">rd_id</span>,
                    <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">hos_admin</span>$<span class="no">admin_period</span>),
                    <span class="kw">overlap_methods_c</span> <span class="kw">=</span> <span class="no">x</span>,
                    <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>,
                    <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)

  <span class="co"># for this demonstration, limit to overlapped periods    </span>
  <span class="no">epids</span>[<span class="no">epids</span>@<span class="kw">epid_total</span><span class="kw">&gt;</span><span class="fl">1</span>]
}

<span class="co"># Methods </span>
<span class="no">methods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="co"># Identical intervals</span>
  <span class="kw">exact</span> <span class="kw">=</span> <span class="st">"exact"</span>,
  <span class="co"># Overlapping intervals</span>
  <span class="kw">across</span><span class="kw">=</span> <span class="st">"across"</span>,
  <span class="co"># Intervals with aligned start points</span>
  <span class="kw">aligns_start</span> <span class="kw">=</span> <span class="st">"aligns_start"</span>,
  <span class="co"># Intervals with aligned endpoints</span>
  <span class="kw">aligns_end</span> <span class="kw">=</span> <span class="st">"aligns_end"</span>,
  <span class="co"># Chained intervals</span>
  <span class="kw">chain</span> <span class="kw">=</span> <span class="st">"chain"</span>,
  <span class="co"># Intervals occurring completely within others</span>
  <span class="kw">inbetween</span> <span class="kw">=</span> <span class="st">"inbetween"</span>,
  <span class="co"># Chained intervals and those occurring completely within others</span>
  <span class="kw">cb1</span> <span class="kw">=</span> <span class="st">"chain|inbetween"</span>,
  <span class="co"># Chained intervals, identical intervals and those occurring completely within others</span>
  <span class="kw">cb2</span> <span class="kw">=</span> <span class="st">"exact|chain|inbetween"</span>,
  <span class="co"># Chained intervals, overlapping intervals and those with aligned endpoint</span>
  <span class="kw">cb3</span> <span class="kw">=</span> <span class="st">"across|chain|aligns_end"</span>
)

<span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">methods</span>, <span class="no">epi_grp_func</span>)
<span class="co">#&gt; Episode tracking completed in 0.73 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.85 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.62 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.63 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.7 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.98 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.65 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.55 secs!</span>
<span class="co">#&gt; Episode tracking completed in 0.85 secs!</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">epids</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">methods</span>)

<span class="co"># Results</span>
<span class="no">epids</span>[<span class="st">"chain"</span>]
<span class="co">#&gt; $chain</span>
<span class="co">#&gt; [1] "E.2 2019-01-01 -&gt; 2019-01-13 (C)" "E.2 2019-01-01 -&gt; 2019-01-13 (D)"</span>

<span class="no">epids</span>[<span class="st">"cb2"</span>]
<span class="co">#&gt; $cb2</span>
<span class="co">#&gt; [1] "E.2 2019-01-01 -&gt; 2019-01-13 (C)" "E.2 2019-01-01 -&gt; 2019-01-13 (D)"</span>
<span class="co">#&gt; [3] "E.2 2019-01-01 -&gt; 2019-01-13 (D)" "E.8 2019-01-20 -&gt; 2019-01-30 (C)"</span>
<span class="co">#&gt; [5] "E.2 2019-01-01 -&gt; 2019-01-13 (D)" "E.8 2019-01-20 -&gt; 2019-01-30 (D)"</span></pre></body></html></div>
<p><em>Only showing <code>events</code> that have been linked as <code>episodes</code></em></p>
<p><strong>Figure 8a: Episodes when considering only “exact” overlap method</strong> <img src="episodes_files/figure-html/unnamed-chunk-62-1.png" width="816"></p>
<p><strong>Figure 8b: Episodes when considering only “chain” overlap method</strong> <img src="episodes_files/figure-html/unnamed-chunk-63-1.png" width="816"></p>
<p><strong>Figure 8c: Episodes when considering “chain” or “inbetween” overlap method</strong> <img src="episodes_files/figure-html/unnamed-chunk-64-1.png" width="816"></p>
<p>By default, <code>overlap_methods</code> is a <code>record-level</code> argument. This means that the option that’ll be used is that of each <code>event</code> (record). See below.</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">1</span>, <span class="fl">5</span>), <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">1</span>, <span class="fl">5</span>), <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="fl">2</span>, <span class="fl">3</span>), <span class="fl">1</span>)
<span class="no">m</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"aligns_start"</span>, <span class="st">"exact"</span>, <span class="st">"inbetween"</span>, <span class="st">"aligns_start"</span>)
<span class="no">dfe</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">m</span> <span class="kw">=</span> <span class="no">m</span>)
<span class="no">dfe</span>$<span class="no">eps_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dfe</span>$<span class="no">x</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">dfe</span>$<span class="no">x</span>), <span class="kw">overlap_methods_c</span> <span class="kw">=</span> <span class="no">dfe</span>$<span class="no">m</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">dfe</span>
<span class="co">#&gt;        x            m   eps_1</span>
<span class="co">#&gt; 1 1 -&gt; 5 aligns_start E.1 (C)</span>
<span class="co">#&gt; 2 1 -&gt; 5        exact E.1 (D)</span>
<span class="co">#&gt; 3 2 -&gt; 3    inbetween E.1 (D)</span>
<span class="co">#&gt; 4 1 == 1 aligns_start E.1 (D)</span></pre></body></html></div>
<p>However, you can use it as an <code>episode-level</code> argument. This means that the option that’ll be used is that of the index <code>event</code>. Finally, you can use it as both a <code>record-level</code> and <code>episode-level</code> argument. You do these by supplying <code>overlap_methods</code> as a named <code>list</code> - <code>r</code> for <code>record-level</code>, <code>e</code> for <code>record-level</code> or <code>b</code> for <code>both</code>. See below.</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">dfe</span>$<span class="no">eps_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dfe</span>$<span class="no">x</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">dfe</span>$<span class="no">x</span>), <span class="kw">overlap_methods_c</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">e</span> <span class="kw">=</span> <span class="no">dfe</span>$<span class="no">m</span>))
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">dfe</span>$<span class="no">eps_3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dfe</span>$<span class="no">x</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">dfe</span>$<span class="no">x</span>), <span class="kw">overlap_methods_c</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">b</span> <span class="kw">=</span> <span class="no">dfe</span>$<span class="no">m</span>))
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">dfe</span>
<span class="co">#&gt;        x            m   eps_1   eps_2   eps_3</span>
<span class="co">#&gt; 1 1 -&gt; 5 aligns_start E.1 (C) E.1 (C) E.1 (C)</span>
<span class="co">#&gt; 2 1 -&gt; 5        exact E.1 (D) E.2 (C) E.1 (D)</span>
<span class="co">#&gt; 3 2 -&gt; 3    inbetween E.1 (D) E.3 (C) E.1 (D)</span>
<span class="co">#&gt; 4 1 == 1 aligns_start E.1 (D) E.1 (D) E.1 (D)</span></pre></body></html></div>
<div id="case-and-recurrence-lengths-in-interval-grouping" class="section level4">
<h4 class="hasAnchor">
<a href="#case-and-recurrence-lengths-in-interval-grouping" class="anchor"></a>Case and recurrence lengths in interval grouping</h4>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">pa</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"28/03/2019"</span>, <span class="st">"01/04/2019"</span>, <span class="st">"03/04/2019"</span>, <span class="st">"07/04/2019"</span>,<span class="st">"12/04/2019"</span>)
<span class="no">pz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"31/03/2019"</span>, <span class="st">"10/04/2019"</span>, <span class="st">"05/04/2019"</span>, <span class="st">"09/04/2019"</span>,<span class="st">"13/04/2019"</span>)

<span class="no">pa</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">pa</span>, <span class="st">"%d/%m/%Y"</span>)
<span class="no">pz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">pz</span>, <span class="st">"%d/%m/%Y"</span>)

<span class="no">periods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/number_line.html">number_line</a></span>(<span class="no">pa</span>, <span class="no">pz</span>)
<span class="no">periods</span>
<span class="co">#&gt; [1] "2019-03-28 -&gt; 2019-03-31" "2019-04-01 -&gt; 2019-04-10"</span>
<span class="co">#&gt; [3] "2019-04-03 -&gt; 2019-04-05" "2019-04-07 -&gt; 2019-04-09"</span>
<span class="co">#&gt; [5] "2019-04-12 -&gt; 2019-04-13"</span></pre></body></html></div>
<p>As seen earlier, a positive “length” means that; <code>event periods</code> within <code>n</code>-days AFTER the <code><a href="../reference/number_line.html">end_point()</a></code> of the index <code>event period</code> will be linked to the same <code>episode</code>. See another example below.</p>
<p><strong>Figure 9a: Fixed episodes with a case_length of 6</strong></p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">eps_a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">periods</span>,
                  <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">6</span>,
                  <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">eps_a</span>
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-04-10 (C)" "E.1 2019-03-28 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [3] "E.1 2019-03-28 -&gt; 2019-04-10 (D)" "E.4 2019-04-07 -&gt; 2019-04-13 (C)"</span>
<span class="co">#&gt; [5] "E.4 2019-04-07 -&gt; 2019-04-13 (D)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-69-1.png" width="816"></p>
<p>In contrast, a negative “length” means that; only <code>event periods</code> within <code>n</code>-days BEFORE the <code><a href="../reference/number_line.html">end_point()</a></code> of the index <code>event period</code> will be linked to the same <code>episode</code>.</p>
<p><strong>Figure 9b: Fixed episodes with a case_length of -2</strong></p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">eps_b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">periods</span>,
                  <span class="kw">case_length</span> <span class="kw">=</span> -<span class="fl">2</span>,
                  <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">eps_b</span>
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-03-31 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (C)"</span>
<span class="co">#&gt; [3] "E.3 2019-04-03 -&gt; 2019-04-05 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [5] "E.5 2019-04-12 -&gt; 2019-04-13 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-71-1.png" width="816"></p>
<p>To include those that overlap with the index event itself, supply the corresponding <code>case_length</code> or <code>recurrence_lenght</code>. <code><a href="../reference/windows.html">index_window()</a></code> is handy for doing this. You can also achieve this with the old <code>include_index_period</code> argument. See below.</p>
<p><strong>Figure 9c: Fixed episodes with a case_length of -2</strong></p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">eps_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">periods</span>,
                   <span class="kw">case_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(-<span class="fl">2</span>, <span class="fu"><a href="../reference/windows.html">index_window</a></span>(<span class="no">periods</span>)),
                   <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">eps_c</span>
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-03-31 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (C)"</span>
<span class="co">#&gt; [3] "E.2 2019-04-01 -&gt; 2019-04-10 (D)" "E.2 2019-04-01 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [5] "E.5 2019-04-12 -&gt; 2019-04-13 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-73-1.png" width="816"></p>
<p><strong>Figure 9d: Fixed episodes with a case_length of -6</strong></p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">eps_d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">periods</span>, <span class="kw">case_length</span> <span class="kw">=</span>-<span class="fl">6</span>,
                  <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">eps_d</span>
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-03-31 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (C)"</span>
<span class="co">#&gt; [3] "E.2 2019-04-01 -&gt; 2019-04-10 (D)" "E.2 2019-04-01 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [5] "E.5 2019-04-12 -&gt; 2019-04-13 (C)"</span></pre></body></html></div>
<p><img src="episodes_files/figure-html/unnamed-chunk-75-1.png" width="816"></p>
<p><a id="stratified_grouping"></a></p>
</div>
</div>
<div id="stratified-episode-tracking" class="section level3">
<h3 class="hasAnchor">
<a href="#stratified-episode-tracking" class="anchor"></a>Stratified episode tracking</h3>
<p>You’ll usually want to track <code>episodes</code> separately within different groups (<code>strata</code>). For example patients, pathogens, sources of infection or any combination of these. This results in <code>episodes</code> from one <code>strata</code> being different from others.</p>
<p><em><code>episodes</code> from different <code>strata</code> can have different <code>case_lengths</code> and/or <code>recurrence_lengths</code>.</em></p>
<p><em><code><a href="../reference/links.html">links()</a></code> is useful for creating group identifiers which can then be used as a <code>strata</code>. See the <a href="links.html">links vignette</a> for further details.</em></p>
<p>As an example, using the <code>infections</code> dataset, a case definition may specify the following;</p>
<ul>
<li>UTI and BSI diagnoses are considered different <code>episodes</code> regardless of when they occur</li>
<li>UTI <code>episodes</code> have a cut-off of 8 days and a recurrence period of 31 days</li>
<li>BSI <code>episodes</code> have a cut-off of 15 days and no recurrence period</li>
</ul>
<p>By adding the <code>infection</code> column to the <code>strata</code> argument, <code>"UTI"</code> and <code>"BSI"</code> diagnoses will not be linked to the same <code>episode</code>. Furthermore, the <code>case_length</code> and <code>recurrence_length</code> for each will be different as specified in the <code>epi</code> and <code>recur</code> columns respectively.</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">infections</a></span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>,<span class="st">"infection"</span>)]
<span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="no">dbs</span>[<span class="no">dbs</span>$<span class="no">infection</span><span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"UTI"</span>,<span class="st">"BSI"</span>),]
<span class="no">dbs</span>$<span class="no">epi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbs</span>$<span class="no">infection</span><span class="kw">==</span><span class="st">"UTI"</span>, <span class="fl">7</span>, <span class="fl">14</span>)
<span class="no">dbs</span>$<span class="no">recur</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbs</span>$<span class="no">infection</span><span class="kw">==</span><span class="st">"UTI"</span>, <span class="fl">30</span>, <span class="fl">0</span>)

<span class="no">dbs</span>$<span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">epi</span>,
                      <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                      <span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">infection</span>,
                      <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">recur</span>,
                      <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 1.07 secs!</span>

<span class="no">dbs</span>
<span class="co">#&gt;          date infection epi recur                            epids</span>
<span class="co">#&gt; 1  2018-04-01       BSI  14     0 E.1 2018-04-01 == 2018-04-01 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (C)</span>
<span class="co">#&gt; 3  2018-04-13       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (R)</span>
<span class="co">#&gt; 5  2018-04-25       BSI  14     0 E.5 2018-04-25 -&gt; 2018-05-07 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (D)</span>
<span class="co">#&gt; 7  2018-05-07       BSI  14     0 E.5 2018-04-25 -&gt; 2018-05-07 (D)</span>
<span class="co">#&gt; 8  2018-05-13       BSI  14     0 E.8 2018-05-13 == 2018-05-13 (C)</span>
<span class="co">#&gt; 11 2018-05-31       BSI  14     0 E.9 2018-05-31 == 2018-05-31 (C)</span></pre></body></html></div>
<p><a id="sub_strata"></a></p>
<div id="sub-strata" class="section level4">
<h4 class="hasAnchor">
<a href="#sub-strata" class="anchor"></a>Sub-strata</h4>
<p><code>Sub-strata</code> is when <code>events</code> within the same <code>strata</code> have different cut-offs. The case definition below demonstrates how this can be beneficial.</p>
<ul>
<li>UTI and BSI diagnoses are considered different <code>episodes</code> regardless of when they occur</li>
<li>UTI diagnoses have a cut-off of 8 days and a recurrence period of 31 days</li>
<li>BSI diagnoses have a cut-off of 15 days if not treated but 5 days if <code>treated</code>. In both situations, there is no recurrence period.</li>
<li>RTI diagnoses have a cut-off of 29 days and a recurrence period of 6 days</li>
</ul>
<p>In this example, whether the infection is <code>treated</code> should be viewed as the <code>sub-strata</code> i.e. in a patient (<code>strata</code>), an <code>episode</code> is expected to last longer if it’s not <code>treated</code>.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">infections_4</a></span>

<span class="no">dbs</span>$<span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">dbs</span>$<span class="no">pid</span>, <span class="no">dbs</span>$<span class="no">organism</span>, <span class="no">dbs</span>$<span class="no">source</span>),
                      <span class="kw">date</span><span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">epi</span>,
                      <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                      <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">recur</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.9 secs!</span>

<span class="no">dbs</span>
<span class="co">#&gt;    rid       date pid organism source treated epi recur    epids</span>
<span class="co">#&gt; 1    1 2019-04-01   1  E. coli    UTI       -   7    30 E.01 (C)</span>
<span class="co">#&gt; 2    2 2019-04-06   1  E. coli    UTI       -   7    30 E.01 (D)</span>
<span class="co">#&gt; 3    3 2019-04-11   1  E. coli    BSI       Y   4     0 E.03 (C)</span>
<span class="co">#&gt; 4    4 2019-04-16   1  E. coli    BSI       N  14     0 E.04 (C)</span>
<span class="co">#&gt; 5    5 2019-04-21   1  E. coli    BSI       Y   4     0 E.04 (D)</span>
<span class="co">#&gt; 6    6 2019-04-26   1  E. coli    RTI       Y  28     5 E.06 (C)</span>
<span class="co">#&gt; 7    7 2019-05-01   1  E. coli    RTI       N  28     5 E.06 (D)</span>
<span class="co">#&gt; 8    8 2019-05-06   1  E. coli    BSI       Y   4     0 E.08 (C)</span>
<span class="co">#&gt; 9    9 2019-05-11   1  E. coli    BSI       N  14     0 E.09 (C)</span>
<span class="co">#&gt; 10  10 2019-05-16   1  E. coli    UTI       N   7    30 E.10 (C)</span>
<span class="co">#&gt; 11  11 2019-05-21   1  E. coli    UTI       N   7    30 E.10 (D)</span></pre></body></html></div>
<p>There are a few things to note with stratified episode tracking;</p>
<ul>
<li>Unless required, <code>case_length</code> and <code>recurrence_length</code> should be consistent within each <code>strata</code> otherwise, you’ll inadvertently create a sub-strata</li>
<li>
<code>Episode tracking</code> with and without a sub-strata are different and could lead to different results</li>
<li>Using a <code>sub-strata</code> is not the same as adding that <code>sub-strata</code> to the <code>strata</code> argument. Adding <code>treated</code> to the <code>strata</code> argument will track <code>treated</code> infections separately from untreated infections. While this could be the desired outcome in certain situations, the case definition above only requires that <code>treated</code> infections last longer.</li>
</ul>
</div>
</div>
</div>
<div id="cut-down-your-processing-time" class="section level2">
<h2 class="hasAnchor">
<a href="#cut-down-your-processing-time" class="anchor"></a>Cut down your processing time</h2>
<p>Some case definitions are so specific that they only cover certain kinds of <code>episodes</code>. In such situations, you can save time by skipping <code>events</code> from <code>episodes</code> that you won’t need. There are 3 ways to skip such <code>events</code>.</p>
<p><em>Skipped <code>events</code> are assigned unique episode IDs and are flagged as <code>"Skipped"</code>.</em></p>
<div id="skip-subsets-of-the-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#skip-subsets-of-the-dataset" class="anchor"></a>Skip subsets of the dataset</h3>
<p>You can skip an entire <code>strata</code> of the dataset by changing it to <code>NA</code>. Assuming you are not interested in tracking <code>"GP1"</code> and <code>"GP2"</code> records, you can skip these to save time.</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">hourly_data</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"datetime"</span>,<span class="st">"category"</span>)], <span class="fl">10</span>)
<span class="no">dbs</span>$<span class="no">subset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbs</span>$<span class="no">category</span><span class="kw">!=</span><span class="st">"GP3"</span>, <span class="fl">NA</span>, <span class="st">"group"</span>)

<span class="co"># To skip OR</span>
<span class="no">dbs</span>$<span class="no">epids_a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span><span class="kw">=</span> <span class="no">dbs</span>$<span class="no">subset</span>,
                        <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>,
                        <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                        <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"hours"</span>,
                        <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">9</span>,
                        <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                        <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="co">#   OR</span>

<span class="co"># Not to skip</span>
<span class="no">dbs</span>$<span class="no">epids_b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">strata</span><span class="kw">=</span> <span class="no">dbs</span>$<span class="no">category</span>,
                        <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>,
                        <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
                        <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"hours"</span>,
                        <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="fl">9</span>,
                        <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
                        <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">dbs</span>
<span class="co">#&gt;               datetime category subset epids_a epids_b</span>
<span class="co">#&gt; 1  2019-04-01 00:03:20      GP1   &lt;NA&gt; E.1 (S) E.1 (C)</span>
<span class="co">#&gt; 2  2019-04-01 02:08:20      GP2   &lt;NA&gt; E.2 (S) E.2 (C)</span>
<span class="co">#&gt; 3  2019-04-01 04:01:40      GP1   &lt;NA&gt; E.3 (S) E.1 (D)</span>
<span class="co">#&gt; 4  2019-04-01 06:05:45      GP2   &lt;NA&gt; E.4 (S) E.2 (D)</span>
<span class="co">#&gt; 5  2019-04-01 08:03:52      GP1   &lt;NA&gt; E.5 (S) E.1 (R)</span>
<span class="co">#&gt; 6  2019-04-01 10:08:52      GP2   &lt;NA&gt; E.6 (S) E.2 (R)</span>
<span class="co">#&gt; 7  2019-04-01 12:06:50      GP1   &lt;NA&gt; E.7 (S) E.1 (D)</span>
<span class="co">#&gt; 8  2019-04-01 14:03:35      GP2   &lt;NA&gt; E.8 (S) E.2 (D)</span>
<span class="co">#&gt; 9  2019-04-01 16:03:42      GP3  group E.9 (C) E.9 (C)</span>
<span class="co">#&gt; 10 2019-04-01 18:01:52      GP3  group E.9 (D) E.9 (D)</span></pre></body></html></div>
</div>
<div id="skip-the-nth-order-skip-order-of-custom-sort" class="section level3">
<h3 class="hasAnchor">
<a href="#skip-the-nth-order-skip-order-of-custom-sort" class="anchor"></a>Skip the nth order (skip order) of custom sort</h3>
<p>You can skip <code>episodes</code> when there are different levels of <code>custom_sort</code>. A <code>skip_order</code> of <code>1</code> means that; after every <code>event</code> with the first level of your <code>custom_sort</code> has been linked to <code>episodes</code>, the tracking process will end.</p>
<p>This is handy when you’re tracking <code>episodes</code> from rare and common <code>events</code>, the rare <code>events</code> are the index <code>events</code> and it’s a hassle to subset the dataset.</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">dbf</span> <span class="kw">&lt;-</span> <span class="no">dbf</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>, <span class="st">"infection"</span>)]
<span class="no">dbf</span>$<span class="no">c_sort</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"UTI"</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">dbf</span>$<span class="no">infection</span> <span class="kw">==</span> <span class="st">"BSI"</span>, <span class="fl">2</span>, <span class="fl">3</span>))

<span class="co"># Skip episodes that would begin with BSI/UTI records</span>
<span class="no">dbf</span>$<span class="no">ep_a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">15</span>,
                     <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">infection</span>,
                     <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">c_sort</span>,
                     <span class="kw">skip_order</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">dbf</span>$<span class="no">ep_a_d</span> <span class="kw">&lt;-</span> <span class="no">dbf</span>$<span class="no">ep_a</span>@<span class="kw">epid_dataset</span>

<span class="co"># Don't skip any episodes</span>
<span class="no">dbf</span>$<span class="no">ep_b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">15</span>,
                    <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">infection</span>,
                    <span class="kw">custom_sort</span> <span class="kw">=</span> <span class="no">dbf</span>$<span class="no">c_sort</span>,
                    <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="no">dbf</span>$<span class="no">ep_b_d</span> <span class="kw">&lt;-</span> <span class="no">dbf</span>$<span class="no">ep_b</span>@<span class="kw">epid_dataset</span>

<span class="no">dbf</span>
<span class="co">#&gt;          date infection c_sort     ep_a ep_a_d     ep_b  ep_b_d</span>
<span class="co">#&gt; 1  2018-04-01       BSI      2 E.01 (S)    BSI E.01 (C)     BSI</span>
<span class="co">#&gt; 2  2018-04-07       UTI      1 E.02 (S)    UTI E.02 (C)     UTI</span>
<span class="co">#&gt; 3  2018-04-13       UTI      1 E.03 (S)    UTI E.02 (D)     UTI</span>
<span class="co">#&gt; 4  2018-04-19       UTI      1 E.04 (S)    UTI E.02 (D)     UTI</span>
<span class="co">#&gt; 5  2018-04-25       BSI      2 E.05 (S)    BSI E.05 (C)     BSI</span>
<span class="co">#&gt; 6  2018-05-01       UTI      1 E.06 (S)    UTI E.06 (C) BSI,UTI</span>
<span class="co">#&gt; 7  2018-05-07       BSI      2 E.07 (S)    BSI E.06 (D) BSI,UTI</span>
<span class="co">#&gt; 8  2018-05-13       BSI      2 E.08 (S)    BSI E.06 (D) BSI,UTI</span>
<span class="co">#&gt; 9  2018-05-19       RTI      3 E.09 (S)    RTI E.09 (C)     RTI</span>
<span class="co">#&gt; 10 2018-05-25       RTI      3 E.10 (S)    RTI E.09 (D)     RTI</span>
<span class="co">#&gt; 11 2018-05-31       BSI      2 E.11 (S)    BSI E.11 (C)     BSI</span></pre></body></html></div>
<p>Notice that in the skipped example (<code>ep_a</code>), no <code>episode</code> begins with either a <code>"BSI"</code> or <code>"RTI"</code> record.</p>
</div>
<div id="skip-episodes-without-records-from-certain-data-sources" class="section level3">
<h3 class="hasAnchor">
<a href="#skip-episodes-without-records-from-certain-data-sources" class="anchor"></a>Skip episodes without records from certain data sources</h3>
<p>The third mechanism is partly a misnomer. <code>episodes</code> that do not contain records from certain <code>data_sources</code> are unlinked not skipped. A <code>strata</code> without the required combination of <code>data_sources</code> will be skipped.</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">dttm</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(<span class="no">x</span>, <span class="st">"UTC"</span>, <span class="kw">nformat</span><span class="kw">=</span><span class="st">"%d/%m/%Y %H:%M:%S"</span>)
<span class="no">dbg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.POSIXt.html">seq.POSIXt</a></span>(<span class="fu">dttm</span>(<span class="st">"01/04/2018 00:00:00"</span>), <span class="fu">dttm</span>(<span class="st">"31/05/2018 00:00:00"</span>),
                                    <span class="kw">by</span> <span class="kw">=</span> <span class="st">"3 days"</span>))
<span class="no">dbg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dbg</span>, <span class="fl">11</span>)
<span class="no">dbg</span>$<span class="no">recurrence</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">dbg</span>$<span class="no">case_len</span> <span class="kw">&lt;-</span> <span class="fl">6</span>
<span class="no">dbg</span>$<span class="no">dataset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"DS"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">2</span>),<span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">3</span>,<span class="fl">4</span>)), <span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)

<span class="co"># Don't skip any</span>
<span class="no">dbg</span>$<span class="no">ep_a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">date</span>,
                     <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">case_len</span>,
                     <span class="kw">episode_type</span> <span class="kw">=</span><span class="st">"rolling"</span>,
                     <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">recurrence</span>,
                     <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">dataset</span>,
                     <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.95 secs!</span>

<span class="co"># Breakup episodes without events from the `DS3` `data_source` </span>
  <span class="co"># The `DS3` event MUST BE linked to events from other `data_sources`  </span>
<span class="no">dbg</span>$<span class="no">ep_b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">date</span>,
                     <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">case_len</span>,
                     <span class="kw">episode_type</span> <span class="kw">=</span><span class="st">"rolling"</span>,
                     <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">recurrence</span>,
                     <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">dataset</span>,
                     <span class="kw">data_links</span> <span class="kw">=</span> <span class="st">"DS3"</span>,
                     <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.92 secs!</span>

<span class="co"># Breakup episodes without events from the `DS3` `data_source` </span>
  <span class="co"># The `DS3` event DOESN'T HAVE to be linked to events from other `data_sources`   </span>
<span class="no">dbg</span>$<span class="no">ep_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">date</span>,
                     <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">case_len</span>,
                     <span class="kw">episode_type</span> <span class="kw">=</span><span class="st">"rolling"</span>,
                     <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">recurrence</span>,
                     <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">dataset</span>,
                     <span class="kw">data_links</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">g</span><span class="kw">=</span><span class="st">"DS3"</span>),
                     <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.92 secs!</span>

<span class="co"># Breakup episodes without events from the `DS3` `data_source` </span>
  <span class="co"># The `DS3` event MUST BE linked to events from the `DS1` `data_source`</span>
<span class="no">dbg</span>$<span class="no">ep_d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">date</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">case_len</span>,
                     <span class="kw">episode_type</span> <span class="kw">=</span><span class="st">"rolling"</span>, <span class="kw">recurrence_length</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">recurrence</span>,
                     <span class="kw">data_source</span> <span class="kw">=</span> <span class="no">dbg</span>$<span class="no">dataset</span>, <span class="kw">data_links</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">l</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"DS3"</span>,<span class="st">"DS1"</span>)),
                     <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.93 secs!</span>

<span class="no">dbg</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>, <span class="st">"dataset"</span>, <span class="st">"ep_a"</span>, <span class="st">"ep_b"</span>, <span class="st">"ep_c"</span>, <span class="st">"ep_d"</span>)]
<span class="co">#&gt;          date dataset     ep_a     ep_b     ep_c     ep_d</span>
<span class="co">#&gt; 1  0001-04-20     DS1 E.01 (C) E.01 (C) E.01 (C) E.01 (C)</span>
<span class="co">#&gt; 2  0001-04-23     DS2 E.01 (D) E.01 (D) E.01 (D) E.01 (D)</span>
<span class="co">#&gt; 3  0001-04-26     DS3 E.01 (D) E.01 (D) E.01 (D) E.01 (D)</span>
<span class="co">#&gt; 4  0001-04-29     DS1 E.04 (C) E.04 (S) E.04 (S) E.04 (S)</span>
<span class="co">#&gt; 5  0001-05-02     DS2 E.04 (D) E.05 (S) E.05 (S) E.05 (S)</span>
<span class="co">#&gt; 6  0001-05-05     DS1 E.04 (D) E.06 (S) E.06 (S) E.06 (S)</span>
<span class="co">#&gt; 7  0001-05-08     DS2 E.07 (C) E.07 (C) E.07 (C) E.07 (S)</span>
<span class="co">#&gt; 8  0001-05-11     DS3 E.07 (D) E.07 (D) E.07 (D) E.08 (S)</span>
<span class="co">#&gt; 9  0001-05-14     DS3 E.07 (D) E.07 (D) E.07 (D) E.09 (S)</span>
<span class="co">#&gt; 10 0001-05-17     DS3 E.10 (C) E.10 (S) E.10 (C) E.10 (S)</span>
<span class="co">#&gt; 11 0001-05-20     DS3 E.10 (D) E.11 (S) E.10 (D) E.11 (S)</span></pre></body></html></div>
<p><a id="tips"></a></p>
</div>
</div>
<div id="tips" class="section level2">
<h2 class="hasAnchor">
<a href="#tips" class="anchor"></a>Tips</h2>
<div id="tracking-episodes-in-other-units-of-time" class="section level3">
<h3 class="hasAnchor">
<a href="#tracking-episodes-in-other-units-of-time" class="anchor"></a>Tracking <code>episodes</code> in other units of time</h3>
<p><code>episodes</code> can be tracked in other units of time (<code>episode_unit</code>). Acceptable options are <code>"seconds"</code>, <code>"minutes"</code>, <code>"hours"</code>, <code>"days"</code>, <code>"weeks"</code>, <code>"months"</code> or <code>"years"</code>. Below is an example of tracking <code>episodes</code> by the hour.</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">hourly_data</a></span>

<span class="co"># Each unit is relative to a predefined number of seconds. </span>
<span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">episode_unit</a></span>
<span class="co">#&gt; $seconds</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $minutes</span>
<span class="co">#&gt; [1] 60</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $hours</span>
<span class="co">#&gt; [1] 3600</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $days</span>
<span class="co">#&gt; [1] 86400</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $weeks</span>
<span class="co">#&gt; [1] 604800</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $months</span>
<span class="co">#&gt; [1] 2628000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $years</span>
<span class="co">#&gt; [1] 31536000</span>

<span class="co"># 1-day fixed episodes</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>,
         <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">1</span>,
         <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"days"</span>,
         <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="co">#&gt;  [1] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (C)"</span>
<span class="co">#&gt;  [2] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [3] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [4] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [5] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [6] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [7] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [8] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [9] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [10] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [11] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [12] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [13] "E.13 2019-04-02 00:05:11 == 2019-04-02 00:05:11 (C)"</span>

<span class="co"># 5-hr fixed episodes</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>,
         <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
         <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"hours"</span>,
         <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="co">#&gt;  [1] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (C)"</span>
<span class="co">#&gt;  [2] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (D)"</span>
<span class="co">#&gt;  [3] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (D)"</span>
<span class="co">#&gt;  [4] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (C)"</span>
<span class="co">#&gt;  [5] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (D)"</span>
<span class="co">#&gt;  [6] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (D)"</span>
<span class="co">#&gt;  [7] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (C)"</span>
<span class="co">#&gt;  [8] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (D)"</span>
<span class="co">#&gt;  [9] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (D)"</span>
<span class="co">#&gt; [10] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (C)"</span>
<span class="co">#&gt; [11] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [12] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [13] "E.13 2019-04-02 00:05:11 == 2019-04-02 00:05:11 (C)"</span>

<span class="co"># 5-hr rolling episodes</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">datetime</span>,
         <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>,
         <span class="kw">episode_unit</span> <span class="kw">=</span> <span class="st">"hours"</span>,
         <span class="kw">group_stats</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">episode_type</span> <span class="kw">=</span> <span class="st">"rolling"</span>,
         <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.83 secs!</span>
<span class="co">#&gt;  [1] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (C)"</span>
<span class="co">#&gt;  [2] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [3] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [4] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt;  [5] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [6] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt;  [7] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [8] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt;  [9] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt; [10] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt; [11] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt; [12] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt; [13] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span></pre></body></html></div>
</div>
<div id="use-a-strata-from-links" class="section level3">
<h3 class="hasAnchor">
<a href="#use-a-strata-from-links" class="anchor"></a>Use a <code>strata</code> from <code>links()</code>
</h3>
<p>You can used <code>pid</code> objects from <code><a href="../reference/links.html">links()</a></code> as a <code>strata</code>.</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="no">dbs</span> <span class="kw">&lt;-</span> <span class="kw pkg">diyar</span><span class="kw ns">::</span><span class="no"><a href="../reference/patient_list.html">infections</a></span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>, <span class="st">"infection"</span>)]; <span class="no">dbs</span>
<span class="co">#&gt;          date infection</span>
<span class="co">#&gt; 1  2018-04-01       BSI</span>
<span class="co">#&gt; 2  2018-04-07       UTI</span>
<span class="co">#&gt; 3  2018-04-13       UTI</span>
<span class="co">#&gt; 4  2018-04-19       UTI</span>
<span class="co">#&gt; 5  2018-04-25       BSI</span>
<span class="co">#&gt; 6  2018-05-01       UTI</span>
<span class="co">#&gt; 7  2018-05-07       BSI</span>
<span class="co">#&gt; 8  2018-05-13       BSI</span>
<span class="co">#&gt; 9  2018-05-19       RTI</span>
<span class="co">#&gt; 10 2018-05-25       RTI</span>
<span class="co">#&gt; 11 2018-05-31       BSI</span>

<span class="co"># familiar unique record ids for easy reference - optional</span>
<span class="no">dbs</span>$<span class="no">rd_id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">640</span>,<span class="fl">17</span>,<span class="fl">58</span>,<span class="fl">21</span>,<span class="fl">130</span>,<span class="fl">79</span>,<span class="fl">45</span>,<span class="fl">300</span>,<span class="fl">40</span>,<span class="fl">13</span>,<span class="fl">31</span>)

<span class="co"># `strata` based on matching sources of infection</span>
<span class="no">dbs</span>$<span class="no">pids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/links.html">links</a></span>(<span class="kw">sn</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">rd_id</span>,
                  <span class="kw">criteria</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">infection</span>,
                  <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Data linkage completed in &lt; 0.01 secs!</span>

<span class="co"># stratified episode tracking </span>
<span class="no">dbs</span>$<span class="no">epids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">sn</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">rd_id</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">date</span>,
                      <span class="kw">strata</span> <span class="kw">=</span> <span class="no">dbs</span>$<span class="no">pids</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">10</span>,
                      <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>

<span class="no">dbs</span>
<span class="co">#&gt;          date infection rd_id           pids     epids</span>
<span class="co">#&gt; 1  2018-04-01       BSI   640 P.31 (CRI 001) E.640 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI    17 P.17 (CRI 001) E.017 (C)</span>
<span class="co">#&gt; 3  2018-04-13       UTI    58 P.17 (CRI 001) E.017 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI    21 P.17 (CRI 001) E.021 (C)</span>
<span class="co">#&gt; 5  2018-04-25       BSI   130 P.31 (CRI 001) E.130 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI    79 P.17 (CRI 001) E.079 (C)</span>
<span class="co">#&gt; 7  2018-05-07       BSI    45 P.31 (CRI 001) E.045 (C)</span>
<span class="co">#&gt; 8  2018-05-13       BSI   300 P.31 (CRI 001) E.045 (D)</span>
<span class="co">#&gt; 9  2018-05-19       RTI    40 P.13 (CRI 001) E.040 (C)</span>
<span class="co">#&gt; 10 2018-05-25       RTI    13 P.13 (CRI 001) E.040 (D)</span>
<span class="co">#&gt; 11 2018-05-31       BSI    31 P.31 (CRI 001) E.031 (C)</span></pre></body></html></div>
</div>
<div id="use-numeric-values-for-the-date-argument" class="section level3">
<h3 class="hasAnchor">
<a href="#use-numeric-values-for-the-date-argument" class="anchor"></a>Use numeric values for the date argument</h3>
<p>You use <code>numeric</code> values instead of <code>date</code> or <code>datetime</code> values for the <code>date</code> argument. For instance, if you use <code>0-2</code>, it does not matter what they represent i.e. the number of days from a particular date or number of seconds from a particular time. It only matters that <code>0</code> is before <code>1</code>, which in turn is before <code>2</code>. When using the function this way, <code>episode_unit</code> is ignored.</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">8.1</span>,<span class="fl">6</span>,<span class="fl">12</span>,<span class="fl">8.5</span>,<span class="fl">12</span>,<span class="fl">3</span>,<span class="fl">8</span>,<span class="fl">15</span>,<span class="fl">5</span>,<span class="fl">7</span>)

<span class="no">vals</span>
<span class="co">#&gt;  [1]  8.1  6.0 12.0  8.5 12.0  3.0  8.0 15.0  5.0  7.0</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">.5</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.59 secs!</span>
<span class="co">#&gt;  [1] "E.07 8 -&gt; 8.5 (D)" "E.02 6 == 6 (C)"   "E.03 12 == 12 (C)"</span>
<span class="co">#&gt;  [4] "E.07 8 -&gt; 8.5 (D)" "E.03 12 == 12 (D)" "E.06 3 == 3 (C)"  </span>
<span class="co">#&gt;  [7] "E.07 8 -&gt; 8.5 (C)" "E.08 15 == 15 (C)" "E.09 5 == 5 (C)"  </span>
<span class="co">#&gt; [10] "E.10 7 == 7 (C)"</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="co">#&gt;  [1] "E.1 8.1 -&gt; 12 (C)" "E.6 3 -&gt; 8 (D)"    "E.1 8.1 -&gt; 12 (D)"</span>
<span class="co">#&gt;  [4] "E.1 8.1 -&gt; 12 (D)" "E.1 8.1 -&gt; 12 (D)" "E.6 3 -&gt; 8 (C)"   </span>
<span class="co">#&gt;  [7] "E.6 3 -&gt; 8 (D)"    "E.8 15 == 15 (C)"  "E.6 3 -&gt; 8 (D)"   </span>
<span class="co">#&gt; [10] "E.6 3 -&gt; 8 (D)"</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">group_stats</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="co">#&gt;  [1] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span>
<span class="co">#&gt;  [5] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (C)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span>
<span class="co">#&gt;  [9] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span></pre></body></html></div>
</div>
<div id="infinite-and-missing-case_lengths-or-recurrence_lengths" class="section level3">
<h3 class="hasAnchor">
<a href="#infinite-and-missing-case_lengths-or-recurrence_lengths" class="anchor"></a>Infinite and missing <code>case_lengths</code> or <code>recurrence_lengths</code>
</h3>
<p>You can incorporate missing and infinite cut-offs into your analyses. Events with missing cut-off will not be used as an index event however, they can be tagged as a duplicate of another index event. Index events with an infinite cut-off will be linked to every other event in its <code>strata</code>.</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">vals</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fl">10</span>
<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">Inf</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in &lt; 0.01 secs!</span>
<span class="co">#&gt;  [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (D)" "E.1 (D)" "E.1 (D)" "E.1 (D)"</span>
<span class="co">#&gt;  [8] "E.1 (D)" "E.1 (D)" "E.1 (D)"</span>

<span class="fu"><a href="../reference/episodes.html">episodes</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="no">vals</span>, <span class="kw">case_length</span> <span class="kw">=</span> <span class="fl">NA_real_</span>, <span class="kw">display</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="co">#&gt; Episode tracking completed in 0.6 secs!</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.02 (C)" "E.03 (C)" "E.04 (C)" "E.05 (C)" "E.06 (C)"</span>
<span class="co">#&gt;  [7] "E.07 (C)" "E.08 (C)" "E.09 (C)" "E.10 (C)"</span></pre></body></html></div>
</div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>There are a variety of ways to use <code><a href="../reference/episodes.html">episodes()</a></code>. In general, the following steps can serve as a quick guide on what to do;</p>
<ol style="list-style-type: decimal">
<li>Work out the <code>strata</code> in your dataset.</li>
<li>Choose and specify whether you need <code>"fixed"</code> or <code>"rolling"</code> episodes.</li>
<li>Choose and specify whether you are tracking individual events or periods of events. See <a href="#interval_grouping">interval grouping</a>.</li>
<li>Choose and specify the required <code>case_length</code>, and/or <code>recurrence_length</code>. The values should be unique to each <code>strata</code> unless you require a <a href="#sub_strata">sub-strata</a>.</li>
<li>Change <code>from_last</code> to <code>TRUE</code> if you want the index <code>event</code> to be the earliest or most recent <code>event</code>.</li>
<li>If you need the index <code>event</code> to be the earliest or most recent event of a particular type of event, use <code>custom_sort</code> in combination with <code>from_last</code>. See <a href="#custom_sort">user-defined index events</a>
</li>
<li>Determine if you are tracking <code>episodes</code> by the minute, hour or day e.t.c., and set <code>episode_unit</code> accordingly. Be sure to supply a <code>datetime</code> to the <code>date</code> argument if <code>episode_unit</code> is less than <code>"days"</code>.</li>
</ol>
<p>These functions should prove useful for epidemiological analyses. However, it’s can also be useful for analyses in any field where the aim is to track events into temporal groups.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Olisaeloka Nsonwu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
