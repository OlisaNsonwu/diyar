<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Implementing case definitions for epidemiological analysis in R • diyar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Implementing case definitions for epidemiological analysis in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diyar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/episode_group.html">Implementing case definitions for epidemiological analysis in R</a>
    </li>
    <li>
      <a href="../articles/number_line.html">Number lines and overlaps</a>
    </li>
    <li>
      <a href="../articles/record_group.html">Multistage deterministic linkage in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Implementing case definitions for epidemiological analysis in R</h1>
            
            <h4 class="date">12 June 2020</h4>
      
      
      <div class="hidden name"><code>episode_group.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In epidemiological analyses, an exact distinction between temporal events is not always possible. Therefore, static but reasonable cut-off are used to distinguish between events. This is an important aspect of a case definition. For example, it’s often important to distinguish between repeat positive infection results during a pathogen’s incubation period. Another example, is distinguishing between infections from a single pathogen and those by multiple pathogens within a certain period in time.</p>
<p><code><a href="../reference/episode_group.html">fixed_episodes()</a></code>, <code><a href="../reference/episode_group.html">rolling_episodes()</a></code> and <code><a href="../reference/episode_group.html">episode_group()</a></code> provide simple but flexible ways of doing this. They group events into temporal episodes with an index event. This then allows for easy deduplication or a sub-analysis within each episode.</p>
</div>
<div id="uses" class="section level1">
<h1 class="hasAnchor">
<a href="#uses" class="anchor"></a>Uses</h1>
<p>These functions can implement a variety of case definitions. For example, they can group events into;</p>
<ul>
<li>episodes where each event occurred at points in time e.g. medical diagnoses or traffic incidents</li>
<li>episodes where each event occurred over periods in time e.g. hospital admission or incubation periods. See <a href="#interval_grouping">interval grouping</a>
</li>
<li>episodes where the events are known to recur</li>
<li>episodes where certain type of events are taken as index (reference) events. See <a href="#custom_sort">“user defined case assignment”</a>
</li>
<li>episodes with different durations depending on the type of event. See <a href="#stratified_grouping">stratified grouping</a>
</li>
</ul>
</div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>An episode as produced by <code><a href="../reference/episode_group.html">fixed_episodes()</a></code>, <code><a href="../reference/episode_group.html">rolling_episodes()</a></code> or <code><a href="../reference/episode_group.html">episode_group()</a></code> is a set of events (dated records) within a specified period. Each episode begins with an index event and may contain duplicate or recurrent events.</p>
<ul>
<li>
<code><a href="../reference/episode_group.html">fixed_episodes()</a></code> - for <code>"fixed"</code> episodes that do not include periods of recurrence</li>
<li>
<code><a href="../reference/episode_group.html">rolling_episodes()</a></code> - for <code>"rolling"</code> episodes which can include periods of recurrence</li>
<li>
<code><a href="../reference/episode_group.html">episode_group()</a></code> - the main function behind <code><a href="../reference/episode_group.html">fixed_episodes()</a></code> and <code><a href="../reference/episode_group.html">rolling_episodes()</a></code>
</li>
</ul>
</div>
<div id="implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h1>
<p><a id="episode_grouping"></a></p>
<div id="episodes-windows-case-lengths-and-recurrence-periods" class="section level2">
<h2 class="hasAnchor">
<a href="#episodes-windows-case-lengths-and-recurrence-periods" class="anchor"></a>Episodes, windows, case lengths and recurrence periods</h2>
<p>Before we begin, let’s go over some terms which will pop up now and again.</p>
<ul>
<li>
<code>event</code> - a dated record i.e. single point in time</li>
<li>
<code>event period</code> - <code>events</code> with a known duration i.e. start and end points in time</li>
<li>
<code>reference event/period</code> - index <code>event</code> or <code>event period</code>
</li>
<li>The “lengths” - cut-off for distinguishing <code>events</code>
<ul>
<li>
<code>case_length</code> - cut-off period distinguishing an <code>event</code> from another</li>
<li>
<code>recurrence_length</code> - cut-off period distinguishing an <code>event</code> from a recurrence of the same <code>event</code>
</li>
</ul>
</li>
<li>
<code>window</code> - all <code>events</code> within the same <code>case_length</code> or <code>recurrence_length</code>
<ul>
<li>
<code>case window</code> - all <code>events</code> within a <code>case_length</code>
</li>
<li>
<code>recurrence window</code> - all <code>events</code> within a <code>recurrence_length</code>
</li>
</ul>
</li>
<li>
<code>episode</code> - all <code>event</code> within the same cut-off - <code>case_length</code> and <code>recurrence_length</code>. Every overlapping <code>window</code> forms an <code>episode</code>
</li>
<li>
<code>case event</code> - index <code>event</code> for the entire episode</li>
<li>
<code>recurrent event</code> - first <code>event</code> within a <code>recurrence_length</code>
</li>
<li>
<code>duplicate event</code> - non-index <code>events</code> within an <code>episode</code>
</li>
<li>
<code>episode tracking/grouping</code> - the process of grouping episodes. Begins at the index <code>event</code> and proceeds forward or backward in time depending on <code>from_last</code>.</li>
</ul>
<p>In <code><a href="../reference/episode_group.html">fixed_episodes()</a></code>, a <code>window</code> always equates to an <code>episode</code>. <code>events</code> from a different <code>window</code> belongs to a separate <code>episode</code>. In <code><a href="../reference/episode_group.html">rolling_episodes()</a></code>, if two or more <code>windows</code> overlap, they are collapsed into a larger <code>window</code>, indicating that the <code>episode</code> is still on-going or has recurred. As a result, every <code>event</code> belonging to both <code>windows</code> are now considered part of the same <code>"rolling episode"</code>.</p>
</div>
<div id="how-to-apply-a-case-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-apply-a-case-definition" class="anchor"></a>How to apply a case definition</h2>
<div id="epid-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#epid-objects" class="anchor"></a>epid objects</h3>
<p>Firstly, let’s go through what <code>episodes</code> look like in <code>diyar</code>. By default, they are stored as <code>epid</code> objects (<code>S4</code> object class). An <code>epid</code> object is an <code>episode</code> identifier with <code>slots</code> for useful information on each <code>episode</code>.</p>
<pre><code>#&gt;       events data_source                             epid
#&gt; 1 2019-04-01         DS1 E.1 2019-04-01 -&gt; 2019-04-11 (C)
#&gt; 2 2019-04-06         DS1 E.1 2019-04-01 -&gt; 2019-04-11 (D)
#&gt; 3 2019-04-10         DS3 E.1 2019-04-01 -&gt; 2019-04-11 (R)
#&gt; 4 2019-04-11         DS1 E.1 2019-04-01 -&gt; 2019-04-11 (D)</code></pre>
<p>For an <code>epid</code> object created from a set of <code>events</code> sourced from different <code>data_sources</code>, the displayed (<code>format.epid</code>) components are;</p>
<ul>
<li>
<code>E.1</code> - episode identifier</li>
<li>
<code>2019-04-01 -&gt; 2019-04-11</code> - episode duration. <em>Only shown if <code>group_stats</code> is <code>TRUE</code></em>
</li>
<li>
<code>(C)/(D)/(R)</code> - <code>case</code>, <code>duplicate</code> and <code>recurrent events</code> respectively</li>
</ul>
<p><em>See <code><a href="../reference/episode_group.html">?fixed_episodes</a></code> for the details of every slot, including those not displayed.</em></p>
<p><em>to_df(<code>epids</code>) is a convenient accessor function for every slot in an <code>epid</code> object. See below.</em></p>
<pre><code>#&gt;   epid sn wind_id    wind_nm   case_nm dist_from_wind dist_from_epid
#&gt; 1    1  1       1       Case      Case         0 days         0 days
#&gt; 2    1  2       1       Case Duplicate         0 days         5 days
#&gt; 3    1  3       2 Recurrence Recurrent         4 days         9 days
#&gt; 4    1  4       2 Recurrence Duplicate         5 days        10 days
#&gt;              epid_interval epid_length epid_total epid_dataset
#&gt; 1 2019-04-01 -&gt; 2019-04-11     10 days          4      DS1,DS3
#&gt; 2 2019-04-01 -&gt; 2019-04-11     10 days          4      DS1,DS3
#&gt; 3 2019-04-01 -&gt; 2019-04-11     10 days          4      DS1,DS3
#&gt; 4 2019-04-01 -&gt; 2019-04-11     10 days          4      DS1,DS3</code></pre>
</div>
<div id="cut-off---case-and-recurrence-lengths" class="section level3">
<h3 class="hasAnchor">
<a href="#cut-off---case-and-recurrence-lengths" class="anchor"></a>cut-off - case and recurrence lengths</h3>
<p>Your first consideration should be a cut-off point to distinguish between <code>episodes</code>. This is referred to as the <code>case_length</code>. A <code>case_length</code> of <code>5</code> means that; repeat <code>events</code> within <code>6 days (Time difference of 5 days)</code> of the <code>reference event</code> are considered <code>duplicates</code> of the <code>reference event</code>. See below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(diyar)

<span class="co"># Events</span>
ds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"03/04/2019"</span>, <span class="st">"13/04/2019"</span>,<span class="st">"16/04/2019"</span>, <span class="st">"18/04/2019"</span>)
ds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">date=</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(ds, <span class="st">"%d/%m/%Y"</span>))
ds<span class="op">$</span>date
<span class="co">#&gt; [1] "2019-04-01" "2019-04-03" "2019-04-13" "2019-04-16" "2019-04-18"</span></code></pre></div>
<p><strong>Figure 1a: fixed episodes</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 6-day (5-day difference) episodes - fixed episodes</span>
ds<span class="op">$</span>f1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

ds<span class="op">$</span>f1
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.3 (D)" "E.3 (D)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-7-1.png" width="816"></p>
<p>Alternatively, your cut-off can be a specific range. For example, a <code>case_length</code> of <code>12 -&gt; 16</code> means that; repeat <code>events</code> within <code>13</code> and <code>17</code> days after the <code>reference event</code> are considered <code>duplicates</code> of the <code>reference event</code>.</p>
<p><em>Ranges are created by number_line(). See the <a href="number_line.html">number line vignette</a>.</em></p>
<p><strong>Figure 1b: fixed episodes with a cut-off range</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rng &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(<span class="dv">12</span>, <span class="dv">16</span>); rng
<span class="co">#&gt; [1] "12 -&gt; 16"</span>
ds<span class="op">$</span>f2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> rng, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 2 record(s) with a unique ID.</span>

ds<span class="op">$</span>f2
<span class="co">#&gt; [1] "E.1 (C)" "E.2 (S)" "E.1 (D)" "E.1 (D)" "E.5 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-9-1.png" width="816"></p>
<p>By default, <code>events</code> before the <code>13th</code> day are skipped. You can change <code>skip_if_b4_lengths</code> to <code>FALSE</code>, so that such <code>events</code> are not skipped.</p>
<p><strong>Figure 1c: fixed episodes where events before the the cut-off range are not skipped</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ds<span class="op">$</span>f3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> rng, <span class="dt">display =</span> F, <span class="dt">skip_if_b4_lengths =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

ds<span class="op">$</span>f3
<span class="co">#&gt; [1] "E.1 (C)" "E.2 (C)" "E.1 (D)" "E.1 (D)" "E.2 (D)"</span></code></pre></div>
<p><a id="case_assignment"></a></p>
<p><img src="episode_group_files/figure-html/unnamed-chunk-11-1.png" width="816"></p>
</div>
<div id="reference-events" class="section level3">
<h3 class="hasAnchor">
<a href="#reference-events" class="anchor"></a>Reference events</h3>
<p>Your next consideration should be which <code>events</code> will be the index <code>event</code> (<code>reference events</code>). It’s common practice for the earliest <code>event</code> to be taken as the <code>reference event</code>. However, there are times when the most recent <code>event</code> will be more relevant for this. For example, if a deceased patient died after a series of positive infection results, the most recent result could be considered more relevant as a <code>reference event</code>.</p>
<p>The first approach is the default behaviour for <code>fixed_epsiodes()</code> and <code><a href="../reference/episode_group.html">rolling_episodes()</a></code>. However, by changing <code>from_last</code> to <code>TRUE</code>, <code>episode tracking</code> will begin at the most recent <code>event</code> and proceed backwards in time, making that the <code>reference event</code>.</p>
<p><strong>Figure 2: fixed episodes where episode tracking was backwards in time</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ds<span class="op">$</span>f4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">from_last =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

ds<span class="op">$</span>f4
<span class="co">#&gt; [1] "E.2 (D)" "E.2 (C)" "E.5 (D)" "E.5 (D)" "E.5 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-13-1.png" width="816"></p>
<p><a id="custom_sort"></a></p>
<div id="user-defined-reference" class="section level4">
<h4 class="hasAnchor">
<a href="#user-defined-reference" class="anchor"></a>User defined reference</h4>
<p>There can be situations when the type of <code>event</code>, rather than its chronological order, is more relevant in determining an index <code>event</code>. For example, when tracking patients with positive infection results for; human immunodeficiency virus (HIV), hepatitis B virus (HBV) and <em>Mycobacterium tuberculosis</em> (MyCt), you may want to track concurrent infections beginning or ending with the HIV diagnosis. The examples below show how to handle situations like this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ds2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">date=</span>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"13/03/2020"</span>, <span class="st">"01/04/2020"</span>,<span class="st">"15/08/2020"</span>,
                                   <span class="st">"11/12/2020"</span>, <span class="st">"31/12/2020"</span>), <span class="st">"%d/%m/%Y"</span>),
                  <span class="dt">diag =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"HBV"</span>,<span class="st">"HIV"</span>,<span class="st">"MyCt"</span>,<span class="st">"HBV"</span>, <span class="st">"MyCt"</span>), <span class="dt">stringsAsFactors =</span> F)


<span class="co"># First make the HIV diagnosis the index event </span>
ds2<span class="op">$</span>user_ord &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(ds2<span class="op">$</span>diag<span class="op">==</span><span class="st">"HIV"</span>, <span class="dv">1</span>,<span class="dv">2</span>)

<span class="co"># Then track concurrent infections up to 6 months AFTER the HIV diagnosis</span>
ds2<span class="op">$</span>ep1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> ds2<span class="op">$</span>date, <span class="dt">custom_sort =</span> ds2<span class="op">$</span>user_ord, <span class="dt">data_source =</span> ds2<span class="op">$</span>diag,
                          <span class="dt">case_length =</span> <span class="dv">6</span>, <span class="dt">episode_unit =</span> <span class="st">"months"</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

<span class="co"># Using `data_source` populates the `epid_dataset` slot of the `epid` object. </span>
<span class="co"># This is useful when you're working with different datasets</span>
ds2<span class="op">$</span>ep1_ds &lt;-<span class="st"> </span>ds2<span class="op">$</span>ep1<span class="op">@</span>epid_dataset

<span class="co"># Track preceeding infections up to 6 months BEFORE the HIV diagnosis</span>
ds2<span class="op">$</span>ep2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> ds2<span class="op">$</span>date, <span class="dt">custom_sort =</span> ds2<span class="op">$</span>user_ord, <span class="dt">data_source =</span> ds2<span class="op">$</span>diag,
                          <span class="dt">case_length =</span> <span class="op">-</span><span class="dv">6</span>, <span class="dt">episode_unit =</span> <span class="st">"months"</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

ds2<span class="op">$</span>ep2_ds &lt;-<span class="st"> </span>ds2<span class="op">$</span>ep2<span class="op">@</span>epid_dataset

ds2
<span class="co">#&gt;         date diag user_ord     ep1   ep1_ds     ep2  ep2_ds</span>
<span class="co">#&gt; 1 2020-03-13  HBV        2 E.1 (C)      HBV E.2 (D) HBV,HIV</span>
<span class="co">#&gt; 2 2020-04-01  HIV        1 E.2 (C) HIV,MyCt E.2 (C) HBV,HIV</span>
<span class="co">#&gt; 3 2020-08-15 MyCt        2 E.2 (D) HIV,MyCt E.3 (C)    MyCt</span>
<span class="co">#&gt; 4 2020-12-11  HBV        2 E.4 (C) HBV,MyCt E.4 (C)     HBV</span>
<span class="co">#&gt; 5 2020-12-31 MyCt        2 E.4 (D) HBV,MyCt E.5 (C)    MyCt</span></code></pre></div>
<p>Notice that in <code>ep1</code>, the HIV diagnosis and the HBV diagnosis before it are not grouped into the same <code>episode</code> despite being within 6 months of each other. This also happens with the HIV and MyCt diagnoses in <code>ep2</code>. This happens because by default, <code>episode</code> tracking occurs in one direction of time (<code>from_last</code>). You can correct for this by simultaneously tracking <code>events</code> in both directions i.e. before and after an index <code>event</code>. This is either done by changing <code>bi_direction</code> to <code>TRUE</code> or by using an applicable cut-off range i.e. -6 -&gt; 6. See the examples below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Track preceeding and concurrent infections up to 6 months BEFORE OR AFTER the HIV diagnosis</span>

<span class="co"># Method 1a</span>
<span class="co"># Track diagnoses 6 months AFTER the HIV diagnosis.</span>
  <span class="co"># `bi_direction` then tells the function to also check 6 months BEFORE the HIV diagnosis</span>
ds2<span class="op">$</span>ep3a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> ds2<span class="op">$</span>date, <span class="dt">custom_sort =</span> ds2<span class="op">$</span>user_ord, <span class="dt">case_length =</span> <span class="dv">6</span>, 
                           <span class="dt">bi_direction =</span> T, <span class="dt">episode_unit =</span> <span class="st">"months"</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

<span class="co"># Method 1b</span>
<span class="co"># Track diagnoses 6 months BEFORE the HIV diagnosis</span>
  <span class="co"># bi_direction` then tells the function to also check 6 months AFTER the HIV diagnosis</span>
ds2<span class="op">$</span>ep3b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> ds2<span class="op">$</span>date, <span class="dt">custom_sort =</span> ds2<span class="op">$</span>user_ord, <span class="dt">case_length =</span> <span class="op">-</span><span class="dv">6</span>,
                           <span class="dt">bi_direction =</span> T, <span class="dt">episode_unit =</span> <span class="st">"months"</span>, <span class="dt">display =</span> F, 
                           <span class="dt">data_source =</span> ds2<span class="op">$</span>diag)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

ds2<span class="op">$</span>ep3_ds &lt;-<span class="st"> </span>ds2<span class="op">$</span>ep3b<span class="op">@</span>epid_dataset

<span class="co"># Method 2a</span>
<span class="co"># Track diagnoses 6 months BEFORE or AFTER the HIV diag with an applicable. </span>
  <span class="co"># There's no need for `bi_direction`.</span>
rng &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>)
ds2<span class="op">$</span>ep4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> ds2<span class="op">$</span>date, <span class="dt">custom_sort =</span> ds2<span class="op">$</span>user_ord, <span class="dt">case_length =</span> rng, <span class="dt">episode_unit =</span> <span class="st">"months"</span>,
                          <span class="dt">display =</span> F, <span class="dt">data_source =</span> ds2<span class="op">$</span>diag)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

ds2<span class="op">$</span>ep4_ds &lt;-<span class="st"> </span>ds2<span class="op">$</span>ep4<span class="op">@</span>epid_dataset

<span class="co"># Method 2b</span>
<span class="co"># Track diagnoses between 2 and 6 months AFTER the HIV diagnosis. </span>
  <span class="co">#` bi_direction` then tells the function to also check between 2 and 6 months BEFORE the HIV diagnosis</span>
<span class="co"># Diagnoses before 2 months on either side are skipped as mentioned in the "cut-offs" section</span>
rng2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(<span class="dv">2</span>, <span class="dv">6</span>)
ds2<span class="op">$</span>ep5 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> ds2<span class="op">$</span>date, <span class="dt">custom_sort =</span> ds2<span class="op">$</span>user_ord, <span class="dt">case_length =</span> rng2, 
                          <span class="dt">bi_direction =</span>T, <span class="dt">episode_unit =</span> <span class="st">"months"</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

ds2
<span class="co">#&gt;         date diag user_ord     ep1   ep1_ds     ep2  ep2_ds    ep3a</span>
<span class="co">#&gt; 1 2020-03-13  HBV        2 E.1 (C)      HBV E.2 (D) HBV,HIV E.2 (D)</span>
<span class="co">#&gt; 2 2020-04-01  HIV        1 E.2 (C) HIV,MyCt E.2 (C) HBV,HIV E.2 (C)</span>
<span class="co">#&gt; 3 2020-08-15 MyCt        2 E.2 (D) HIV,MyCt E.3 (C)    MyCt E.2 (D)</span>
<span class="co">#&gt; 4 2020-12-11  HBV        2 E.4 (C) HBV,MyCt E.4 (C)     HBV E.4 (C)</span>
<span class="co">#&gt; 5 2020-12-31 MyCt        2 E.4 (D) HBV,MyCt E.5 (C)    MyCt E.4 (D)</span>
<span class="co">#&gt;      ep3b       ep3_ds     ep4       ep4_ds     ep5</span>
<span class="co">#&gt; 1 E.2 (D) HBV,HIV,MyCt E.2 (D) HBV,HIV,MyCt E.1 (S)</span>
<span class="co">#&gt; 2 E.2 (C) HBV,HIV,MyCt E.2 (C) HBV,HIV,MyCt E.2 (C)</span>
<span class="co">#&gt; 3 E.2 (D) HBV,HIV,MyCt E.2 (D) HBV,HIV,MyCt E.2 (D)</span>
<span class="co">#&gt; 4 E.4 (C)     HBV,MyCt E.4 (C)     HBV,MyCt E.4 (C)</span>
<span class="co">#&gt; 5 E.4 (D)     HBV,MyCt E.4 (D)     HBV,MyCt E.5 (C)</span></code></pre></div>
<p>When different <code>events</code> have the same level of preference - <code>custom_sort</code> values, their chronological order are used to break ties. This will be the earliest or most recent <code>event</code> depending on <code>from_last</code>. Alternatively, you can break such ties with additional levels of <code>custom_sort</code>.</p>
<p>Using <code>infections</code> - a sample dataset for positive urinary tract infections (UTI), bloodstream infections (BSI) and respiratory tract infections (RTI), we can see examples of <code>episode tracking</code> using 2 and 3 levels of <code>custom_sort</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbf &lt;-<span class="st"> </span>infections[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>, <span class="st">"infection"</span>)]

<span class="co"># 3 levels: "UTI" &gt; "BSI" &gt; "RTI"</span>
dbf<span class="op">$</span>c_sort1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbf<span class="op">$</span>infection <span class="op">==</span><span class="st"> "UTI"</span>, <span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbf<span class="op">$</span>infection <span class="op">==</span><span class="st"> "BSI"</span>, <span class="dv">2</span>, <span class="dv">3</span>))
<span class="co"># 2 levels: "UTI" &gt; ("BSI" OR "RTI")</span>
dbf<span class="op">$</span>c_sort2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbf<span class="op">$</span>infection <span class="op">==</span><span class="st"> "UTI"</span>, <span class="dv">1</span>, <span class="dv">2</span>)
<span class="co"># 2 levels: "BSI" &gt; ("UTI" OR "RTI")</span>
dbf<span class="op">$</span>c_sort3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbf<span class="op">$</span>infection <span class="op">==</span><span class="st"> "BSI"</span>, <span class="dv">1</span>, <span class="dv">2</span>)

dbf<span class="op">$</span>ep_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(dbf<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">15</span>, <span class="dt">data_source =</span> dbf<span class="op">$</span>infection, 
                           <span class="dt">custom_sort =</span> dbf<span class="op">$</span>c_sort1, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

dbf<span class="op">$</span>ep_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(dbf<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">15</span>, <span class="dt">data_source =</span> dbf<span class="op">$</span>infection, 
                           <span class="dt">custom_sort =</span> dbf<span class="op">$</span>c_sort2, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 2 record(s) with a unique ID.</span>

dbf<span class="op">$</span>ep_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(dbf<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">15</span>, <span class="dt">data_source =</span> dbf<span class="op">$</span>infection, 
                           <span class="dt">custom_sort =</span> dbf<span class="op">$</span>c_sort3, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 2 record(s) with a unique ID.</span>

dbf
<span class="co">#&gt;          date infection c_sort1 c_sort2 c_sort3     ep_1    ep_2     ep_3</span>
<span class="co">#&gt; 1  2018-04-01       BSI       2       2       1 E.01 (C) E.1 (C) E.01 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI       1       1       2 E.02 (C) E.2 (C) E.01 (D)</span>
<span class="co">#&gt; 3  2018-04-13       UTI       1       1       2 E.02 (D) E.2 (D) E.01 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI       1       1       2 E.02 (D) E.2 (D) E.04 (C)</span>
<span class="co">#&gt; 5  2018-04-25       BSI       2       2       1 E.05 (C) E.5 (C) E.05 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI       1       1       2 E.06 (C) E.6 (C) E.05 (D)</span>
<span class="co">#&gt; 7  2018-05-07       BSI       2       2       1 E.06 (D) E.6 (D) E.05 (D)</span>
<span class="co">#&gt; 8  2018-05-13       BSI       2       2       1 E.06 (D) E.6 (D) E.08 (C)</span>
<span class="co">#&gt; 9  2018-05-19       RTI       3       2       2 E.09 (C) E.9 (C) E.08 (D)</span>
<span class="co">#&gt; 10 2018-05-25       RTI       3       2       2 E.09 (D) E.9 (D) E.08 (D)</span>
<span class="co">#&gt; 11 2018-05-31       BSI       2       2       1 E.11 (C) E.9 (D) E.11 (C)</span></code></pre></div>
<p><a id="recurrence"></a><a></a></p>
</div>
</div>
<div id="recurrent-events-and-periods-of-recurrence" class="section level3">
<h3 class="hasAnchor">
<a href="#recurrent-events-and-periods-of-recurrence" class="anchor"></a>Recurrent events and periods of recurrence</h3>
<p>Another important consideration for a case definition should be if the <code>events</code> recurs. For example, if a relapse of the same disease occurs after a successful treatment therapy, it may be more relevant to treat this as the same <code>episode</code> of the initial <code>event</code>.</p>
<p><em>fixed_episodes() will treat these as a separate <code>episodes</code> while <code><a href="../reference/episode_group.html">rolling_episodes()</a></code> can treat them as the same <code>episode</code>.</em></p>
<p>All arguments in <code><a href="../reference/episode_group.html">fixed_episodes()</a></code> (including <code>case_length</code>) function the same way as in <code><a href="../reference/episode_group.html">rolling_episodes()</a></code>. However, the <code>recurrence_length</code> argument, which is unique to <code>rolling_episodes(),</code> provides the cut-off period for <code>recurrent events</code>. For example, a <code>recurrence_length</code> of <code>10</code> means that; repeat <code>events</code> within <code>11</code> days of the last <code>duplicate event</code> (of the initial index <code>event</code>) are considered a recurrence of the index <code>event</code>.</p>
<p><em>If <code>recurrence_length</code> is not supplied, it’s assumed to be the same as the <code>case_length</code>.</em></p>
<p><strong>Figure 3a: rolling episodes</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 6-day (5-day difference) episodes with 11-days recurrence periods - rolling episodes</span>
ds<span class="op">$</span>r1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">recurrence_length =</span> <span class="dv">10</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

ds<span class="op">$</span>r1
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (D)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-18-1.png" width="816"></p>
<p>Similarly, for <code>recurrence_length</code>, your cut-off can be a range. For example, a <code>recurrence_length</code> of <code>13 -&gt; 15</code> means that; repeat <code>events</code> within <code>14</code> and <code>16</code> days after the last <code>duplicate event</code> are considered a recurrence of the <code>reference event</code>.</p>
<p><strong>Figure 3b: rolling episodes with a cut-off range</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rng &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(<span class="dv">13</span>, <span class="dv">15</span>); rng
<span class="co">#&gt; [1] "13 -&gt; 15"</span>
ds<span class="op">$</span>r2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">recurrence_length =</span> rng, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

ds<span class="op">$</span>r2
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (S)" "E.1 (R)" "E.1 (D)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-20-1.png" width="816"></p>
<p><code>Events</code> before the <code>14th</code> are skipped by default however, you can also change <code>skip_if_b4_lengths</code> to <code>FALSE</code>, so that such <code>events</code> are not skipped.</p>
<p><strong>Figure 3c: rolling episodes where events before the the cut-off range are not skipped</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rng &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(<span class="dv">13</span>, <span class="dv">15</span>); rng
<span class="co">#&gt; [1] "13 -&gt; 15"</span>
ds<span class="op">$</span>r3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(ds<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">recurrence_length =</span> rng, 
                          <span class="dt">skip_if_b4_lengths =</span> F, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

ds<span class="op">$</span>r3
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.1 (R)" "E.1 (D)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-22-1.png" width="816"></p>
<div id="index-events-for-periods-of-recurrence" class="section level4">
<h4 class="hasAnchor">
<a href="#index-events-for-periods-of-recurrence" class="anchor"></a>Index events for periods of recurrence</h4>
<p>Unlike <code>"fixed episodes"</code>, each <code>"rolling episode"</code> has at least two index <code>events</code> - one for the whole <code>episode</code> and one for each recurrence period. By default, the last <code>event</code> of the previous <code>window</code> is the index <code>event</code> for the next recurrence period. However, you can change <code>recurrence_from_last</code> to <code>FALSE</code>, so that the first <code>event</code> in the previous window is used instead. See a demonstration of this below.</p>
<p><em>If your <code>case_length</code> and <code>recurrence_length</code> are the same, which is the default behaviour, you’ll have essentially created a <code>"fixed episode"</code></em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"11/04/2019"</span>, <span class="st">"16/04/2019"</span>,<span class="st">"21/04/2019"</span>, <span class="st">"07/05/2019"</span>)
df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">date=</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(df, <span class="st">"%d/%m/%Y"</span>))

<span class="co"># 15-day fixed episodes</span>
df<span class="op">$</span>f1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(df<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">14</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

<span class="co"># 15-day rolling episodes with 15-day recurrence periods</span>
  <span class="co"># Since the first event is the reference event for the next recurrence window and,</span>
  <span class="co"># the recurrence_length is the same the case_length (14-day difference), </span>
  <span class="co"># the result will be the same as the 15-day fixed-episode (above) </span>
df<span class="op">$</span>r1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">14</span>, <span class="dt">recurrence_from_last =</span> F, 
                          <span class="dt">to_s4 =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

df
<span class="co">#&gt;         date      f1      r1</span>
<span class="co">#&gt; 1 2019-04-01 E.1 (C) E.1 (C)</span>
<span class="co">#&gt; 2 2019-04-11 E.1 (D) E.1 (D)</span>
<span class="co">#&gt; 3 2019-04-16 E.3 (C) E.3 (C)</span>
<span class="co">#&gt; 4 2019-04-21 E.3 (D) E.3 (D)</span>
<span class="co">#&gt; 5 2019-05-07 E.5 (C) E.5 (C)</span>

<span class="co"># Identical</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(df<span class="op">$</span>f1<span class="op">==</span>df<span class="op">$</span>r1)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p><strong>Figure 4a: Last event in a window taken as the reference event for the next recurrence window (default)</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>r2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">14</span>, <span class="dt">recurrence_length =</span> <span class="dv">16</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

df<span class="op">$</span>r2
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (R)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-25-1.png" width="816"></p>
<p><strong>Figure 4b: First event in a window taken as the reference event for the next recurrence window</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>r3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">14</span>, <span class="dt">recurrence_length =</span> <span class="dv">16</span>, 
                          <span class="dt">recurrence_from_last =</span> F, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

df<span class="op">$</span>r3
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-27-1.png" width="816"></p>
</div>
<div id="case-windows-for-both-case-and-recurrent-events" class="section level4">
<h4 class="hasAnchor">
<a href="#case-windows-for-both-case-and-recurrent-events" class="anchor"></a>Case windows for both case and recurrent events</h4>
<p>You can use the <code>case_for_recurrence</code> argument to specify that both <code>case</code> and <code>recurrence events</code> should have a <code>case window</code>. The default behaviour is that only <code>case events</code> have a <code>case window</code>. See a demonstration of this below.</p>
<p><em>The <code>wind_id</code> slot shows the <code>window</code> for every <code>event</code>, while <code>wind_nm</code> slot shows type of <code>window</code> it is.</em></p>
<p><em>Example 1</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"11/04/2019"</span>, <span class="st">"16/04/2019"</span>,<span class="st">"21/04/2019"</span>,<span class="st">"25/04/2019"</span>, <span class="st">"07/05/2019"</span>)
df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">date=</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(df, <span class="st">"%d/%m/%Y"</span>))</code></pre></div>
<p><strong>Figure 5a: Case windows for case events only (default)</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>r4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">10</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

df<span class="op">$</span>r4
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (R)" "E.6 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-30-1.png" width="816"></p>
<p><strong>Figure 5b: Case windows for case and recurrence events</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>r5 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">10</span>, <span class="dt">case_for_recurrence =</span> T, 
                          <span class="dt">to_s4 =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

df<span class="op">$</span>r5
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (D)" "E.6 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-32-1.png" width="816"></p>
<p><em>Example 2.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">date &lt;-<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.Date">seq.Date</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"%d/%m/%Y"</span>), 
                  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="st">"21/04/2019"</span>,<span class="st">"%d/%m/%Y"</span>), 
                  <span class="dt">by=</span><span class="st">"3 day"</span>)
<span class="co"># Example 2</span>
df2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">date =</span> date, <span class="dt">sn =</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(date))
<span class="co"># dates</span>
df2<span class="op">$</span>date
<span class="co">#&gt; [1] "2019-04-01" "2019-04-04" "2019-04-07" "2019-04-10" "2019-04-13"</span>
<span class="co">#&gt; [6] "2019-04-16" "2019-04-19"</span></code></pre></div>
<p><strong>Figure 5c: Case windows for case events only (default)</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2<span class="op">$</span>r1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df2<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">6</span>, <span class="dt">recurrence_length =</span> <span class="dv">4</span>, <span class="dt">display =</span> F, <span class="dt">sn=</span>df2<span class="op">$</span>sn)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

df2<span class="op">$</span>r1
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-35-1.png" width="816"></p>
<p><strong>Figure 5d: Case windows for case and recurrence events</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2<span class="op">$</span>r2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(df2<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">6</span>, <span class="dt">recurrence_length =</span> <span class="dv">4</span>, 
                           <span class="dt">case_for_recurrence =</span> T, <span class="dt">display =</span> F, <span class="dt">sn=</span>df2<span class="op">$</span>sn)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

df2<span class="op">$</span>r1
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-37-1.png" width="816"></p>
<p>Notice that in the 4 examples, all <code>events</code> have been assigned to the same <code>episode</code> but the number of <code>recurrent events</code> differ.</p>
</div>
</div>
<div id="number-of-recurrence-periods-and-episodes" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-recurrence-periods-and-episodes" class="anchor"></a>Number of recurrence periods and episodes</h3>
<p>Some case definitions may only require you to track the first <code>n</code>-number of <code>episodes</code>, or those that only recurred <code>n</code>-number of times. You can incorporate these requirements into your analysis using <code>episodes_max</code> and <code>rolls_max</code> (only applicable to <code><a href="../reference/episode_group.html">rolling_episodes()</a></code>). When each <code>strata</code> (see <a href="#stratified_grouping">stratified grouping</a>) of the dataset has the maximum number of <code>episodes</code> (<code>episodes_max</code>), subsequent <code>events</code> are skipped and assigned unique episode IDs. The default option for <code>episodes_max</code> is <code>Inf</code> i.e. continue until every <code>event</code> has been grouped into <code>episodes</code>. See the examples below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"infections_3"</span>);
dbs &lt;-<span class="st"> </span>infections_<span class="dv">3</span>[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"pid"</span>,<span class="st">"date"</span>)]; 
<span class="co"># dates</span>
dbs<span class="op">$</span>date
<span class="co">#&gt;  [1] "2019-04-01" "2019-04-02" "2019-04-03" "2019-04-04" "2019-04-05"</span>
<span class="co">#&gt;  [6] "2019-04-06" "2019-04-07" "2019-04-08" "2019-04-09" "2019-04-10"</span>
<span class="co">#&gt; [11] "2019-04-11"</span></code></pre></div>
<p><strong>Figure 6a: Maximum of one fixed episode per strata</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs<span class="op">$</span>eps_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">strata =</span> dbs<span class="op">$</span>pid, <span class="dt">date =</span> dbs<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">3</span>, <span class="dt">display =</span> F, 
                            <span class="dt">episodes_max =</span> <span class="dv">1</span>)
<span class="co">#&gt; 7 record(s); 7 skipped</span>
<span class="co">#&gt; Episode grouping complete: 7 record(s) with a unique ID.</span>

dbs<span class="op">$</span>eps_<span class="dv">1</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.01 (D)" "E.01 (D)" "E.01 (D)" "E.05 (S)" "E.06 (S)"</span>
<span class="co">#&gt;  [7] "E.07 (S)" "E.08 (S)" "E.09 (S)" "E.10 (S)" "E.11 (S)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-40-1.png" width="816"></p>
<p><strong>Figure 6b: Maximum of two fixed episodes per strata</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs<span class="op">$</span>eps_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">strata =</span> dbs<span class="op">$</span>pid, <span class="dt">date =</span> dbs<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">3</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>, <span class="dt">episodes_max =</span> <span class="dv">2</span>)
<span class="co">#&gt; 3 record(s); 3 skipped</span>
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

dbs<span class="op">$</span>eps_<span class="dv">2</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.01 (D)" "E.01 (D)" "E.01 (D)" "E.05 (C)" "E.05 (D)"</span>
<span class="co">#&gt;  [7] "E.05 (D)" "E.05 (D)" "E.09 (S)" "E.10 (S)" "E.11 (S)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-42-1.png" width="816"></p>
<p><code>rolls_max</code> is the maximum number of times an <code>event</code> can recur. When <code>rolls_max</code> is reached, the <code>episode</code> ends. A new one then begins if the number of <code>episodes</code> in that <code>strata</code> is less than <code>episode_max</code>. The default option for <code>rolls_max</code> is <code>Inf</code> i.e. check until there are no more <code>events</code> within the <code>recurrence period</code> of the <code>reference event</code>. See the examples below.</p>
<p><strong>Figure 6c: Infinite recurrence periods per episode per strata (default)</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs<span class="op">$</span>eps_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">strata =</span> dbs<span class="op">$</span>pid, <span class="dt">date =</span>dbs<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">2</span>,<span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

dbs<span class="op">$</span>eps_<span class="dv">4</span>
<span class="co">#&gt;  [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (R)" "E.1 (D)"</span>
<span class="co">#&gt;  [8] "E.1 (R)" "E.1 (D)" "E.1 (R)" "E.1 (D)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-44-1.png" width="816"></p>
<p><strong>Figure 6d: Maximum of one recurrence period per episode per strata</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs<span class="op">$</span>eps_<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">strata =</span> dbs<span class="op">$</span>pid, <span class="dt">date =</span>dbs<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">2</span>,<span class="dt">display =</span> F, 
                              <span class="dt">rolls_max =</span> <span class="dv">1</span>)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

dbs<span class="op">$</span>eps_<span class="dv">6</span>
<span class="co">#&gt;  [1] "E.01 (C)" "E.01 (D)" "E.01 (D)" "E.01 (R)" "E.01 (D)" "E.06 (C)"</span>
<span class="co">#&gt;  [7] "E.06 (D)" "E.06 (D)" "E.06 (R)" "E.06 (D)" "E.11 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-46-1.png" width="816"></p>
<p>Note that if <code>case_for_recurrence</code> is <code>TRUE</code>, after checking for <code>recurrence</code> in the last <code>recurrence period</code>, the function will also check for <code>duplicates</code> within the <code>case window</code> of the last <code>recurrent event</code>. See below.</p>
<p><strong>Figure 6e: Maximum of one recurrence period per episode per strata when case_for_recurrence is TRUE</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs<span class="op">$</span>eps_<span class="dv">7</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">strata =</span> dbs<span class="op">$</span>pid, <span class="dt">date =</span>dbs<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">2</span>,<span class="dt">display =</span> F, 
                              <span class="dt">rolls_max =</span> <span class="dv">1</span>, <span class="dt">case_for_recurrence =</span> T)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

dbs<span class="op">$</span>eps_<span class="dv">7</span>
<span class="co">#&gt;  [1] "E.1 (C)" "E.1 (D)" "E.1 (D)" "E.1 (R)" "E.1 (D)" "E.1 (D)" "E.1 (D)"</span>
<span class="co">#&gt;  [8] "E.8 (C)" "E.8 (D)" "E.8 (D)" "E.8 (R)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-48-1.png" width="816"></p>
<p><a id="interval_grouping"></a></p>
</div>
<div id="interval-grouping" class="section level3">
<h3 class="hasAnchor">
<a href="#interval-grouping" class="anchor"></a>Interval grouping</h3>
<p>Some case definitions can involve <code>events</code> that occur over a period of time and not a single point in time e.g hospital admissions. <code><a href="../reference/episode_group.html">fixed_episodes()</a></code> and <code><a href="../reference/episode_group.html">rolling_episodes()</a></code> can be used to track such <code>event periods</code> into <code>episodes</code>. This type of <code>episode</code> grouping is recommended when the end point of an <code>event</code> is known. For example, it’s near impossible to know the exact point in time an individual diagnosed with the common cold recovers however, it’s a reasonable assumption that a second diagnosis 3 months after is not the same one that was diagnosed initially. For situations like this, the recommend approach is to use the methods we’ve covered so far. In contrast, hospital admissions typically have recorded admission and discharge times or dates and so interval grouping is recommended. This being said, in several situations both approaches can be used interchangeably. See below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Dates</span>
dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="st">"01/04/2019"</span>, <span class="st">"%d/%M/%Y"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="st">"20/04/2019"</span>, <span class="st">"%d/%M/%Y"</span>), <span class="st">"4 days"</span>)
case_len &lt;-<span class="st"> </span><span class="dv">4</span>

<span class="co"># Periods </span>
periods &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(dates, dates <span class="op">+</span><span class="st"> </span><span class="dv">4</span>)

dates
<span class="co">#&gt; [1] "2019-06-01" "2019-06-05" "2019-06-09" "2019-06-13" "2019-06-17"</span>
periods
<span class="co">#&gt; [1] "2019-06-01 -&gt; 2019-06-05" "2019-06-05 -&gt; 2019-06-09"</span>
<span class="co">#&gt; [3] "2019-06-09 -&gt; 2019-06-13" "2019-06-13 -&gt; 2019-06-17"</span>
<span class="co">#&gt; [5] "2019-06-17 -&gt; 2019-06-21"</span>

<span class="co"># Track fixed episodes from events with a 5 day cut-off </span>
mth1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> dates, <span class="dt">case_length =</span> <span class="dv">4</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

<span class="co"># Track fixed episode from periods that are 5 days long </span>
mth2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> periods, <span class="dt">case_length =</span><span class="dv">0</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>

<span class="co"># Same results</span>
mth1; mth2
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.3 (D)" "E.5 (C)"</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.3 (C)" "E.3 (D)" "E.5 (C)"</span>

<span class="co"># Track rolling episodes from events using a 5 day cut-off </span>
mth3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">date =</span> dates, <span class="dt">case_length =</span> <span class="dv">4</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

<span class="co"># Track rolling episode from periods that are 5 days long </span>
mth4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">date =</span> periods, <span class="dt">case_length =</span><span class="dv">0</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

<span class="co"># Same results</span>
mth3; mth4
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span>
<span class="co">#&gt; [1] "E.1 (C)" "E.1 (D)" "E.1 (R)" "E.1 (R)" "E.1 (R)"</span></code></pre></div>
<p>In interval grouping, when <code>case_length</code> is <code>0</code>, <code>event periods</code> that overlap with the index <code>event period</code> are grouped together as one <code>episode</code>. However, if <code>case_length</code> is <code>&gt; 0</code>, only those within <code>n</code>-days (or any time unit) after the <code><a href="../reference/number_line.html">end_point()</a></code> of the index <code>event period</code> are grouped together. See below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hos_admin &lt;-<span class="st"> </span>diyar<span class="op">::</span>hospital_admissions
hos_admin<span class="op">$</span>admin_period &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(hos_admin<span class="op">$</span>admin_dt, hos_admin<span class="op">$</span>discharge_dt)

<span class="co"># Hospital stay</span>
hos_admin<span class="op">$</span>admin_period
<span class="co">#&gt;  [1] "2019-01-01 == 2019-01-01" "2019-01-01 -&gt; 2019-01-10"</span>
<span class="co">#&gt;  [3] "2019-01-10 -&gt; 2019-01-13" "2019-01-05 -&gt; 2019-01-06"</span>
<span class="co">#&gt;  [5] "2019-01-05 -&gt; 2019-01-15" "2019-01-07 -&gt; 2019-01-15"</span>
<span class="co">#&gt;  [7] "2019-01-04 -&gt; 2019-01-13" "2019-01-20 -&gt; 2019-01-30"</span>
<span class="co">#&gt;  [9] "2019-01-26 -&gt; 2019-01-31" "2019-01-01 -&gt; 2019-01-10"</span>
<span class="co">#&gt; [11] "2019-01-20 -&gt; 2019-01-30"</span></code></pre></div>
<p><strong>Figure 7a: Tracking periods of hospital stay (admission -&gt; discharge)</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hs_epids_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date=</span>hos_admin<span class="op">$</span>admin_period, <span class="dt">case_length =</span> <span class="dv">0</span>, 
                <span class="dt">display=</span>F, <span class="dt">group_stats=</span>T)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-52-1.png" width="816"></p>
<p><strong>Figure 7b: Tracking periods of hospital stay up to 20 days after the first discharge</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hs_epids_b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date=</span>hos_admin<span class="op">$</span>admin_period, <span class="dt">case_length =</span> <span class="dv">20</span>, 
                <span class="dt">display=</span>F, <span class="dt">group_stats=</span>T)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-54-1.png" width="816"></p>
<p><strong>Figure 7c: Tracking periods of continuous hospital stay i.e. re-admission within 15 days</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hs_epids_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">date=</span>hos_admin<span class="op">$</span>admin_period, <span class="dt">case_length =</span> <span class="dv">0</span>, 
                <span class="dt">recurrence_length=</span><span class="dv">15</span>, <span class="dt">display=</span>F, <span class="dt">group_stats=</span>T)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-56-1.png" width="816"></p>
<p>There are 6 ways <code>event periods</code> can overlap (<code>overlap_methods</code>). These are <code>"exact"</code>, <code>"across"</code>, <code>"inbetween"</code>, <code>"chain"</code>, <code>"aligns_start"</code> and <code>"aligns_end"</code>. These are covered in more detail in an accompanying <a href="number_line.html#overlaps">vignette</a>. Only <code>event periods</code> that overlap by a specified <code>overlap_method</code> will be grouped into the same <code>episode</code>. You can use any combination of the 6 methods but the default option is to use all 6. See below for a demonstration of this.</p>
<p><em>The 6 <code>overlap_methods</code> are mutually exclusive.</em></p>
<p><em>There are 2 convenience methods - <code>"none"</code> and <code>"overlap"</code>. These are mutually inclusive with any the other 6.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># wrapper function to use with lapply</span>
epi_grp_func &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  epids &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date=</span>hos_admin<span class="op">$</span>admin_period, 
                 <span class="dt">sn=</span>hos_admin<span class="op">$</span>rd_id, 
                 <span class="dt">case_length =</span> <span class="dv">0</span>, 
                 <span class="dt">overlap_methods =</span> x, 
                 <span class="dt">display =</span> <span class="ot">FALSE</span>, 
                 <span class="dt">to_s4 =</span> <span class="ot">TRUE</span>, 
                 <span class="dt">group_stats =</span> <span class="ot">TRUE</span>)
  
  <span class="co"># for the prurpose of this demonstration, limit to overlapped periods    </span>
  epids[epids<span class="op">@</span>epid_total<span class="op">&gt;</span><span class="dv">1</span>]
}

<span class="co"># Methods </span>
methods &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
  <span class="co"># Identical intervals</span>
  <span class="dt">exact =</span> <span class="st">"exact"</span>,
  <span class="co"># Overlapping intervals</span>
  <span class="dt">across=</span> <span class="st">"across"</span>,
  <span class="co"># Intervals with aligned start points</span>
  <span class="dt">aligns_start =</span> <span class="st">"aligns_start"</span>,
  <span class="co"># Intervals with aligned end points</span>
  <span class="dt">aligns_end =</span> <span class="st">"aligns_end"</span>,
  <span class="co"># Chained intervals</span>
  <span class="dt">chain =</span> <span class="st">"chain"</span>,
  <span class="co"># Intervals occurring completely within others</span>
  <span class="dt">inbetween =</span> <span class="st">"inbetween"</span>,
  <span class="co"># Chained intervals and those occurring completely within others</span>
  <span class="dt">cb1 =</span> <span class="st">"chain|inbetween"</span>,
  <span class="co"># Chained intervals, identical intervals and those occurring completely within others</span>
  <span class="dt">cb2 =</span> <span class="st">"exact|chain|inbetween"</span>,
  <span class="co"># Chained intervals, overlapping intervals and those with aligned end point</span>
  <span class="dt">cb3 =</span> <span class="st">"across|chain|aligns_end"</span>
)

epids &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(methods, epi_grp_func)
<span class="co">#&gt; Episode grouping complete: 7 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 5 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 7 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 7 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 9 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 7 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 8 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 5 record(s) with a unique ID. </span>
<span class="co">#&gt; Episode grouping complete: 4 record(s) with a unique ID.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(epids) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(methods)

<span class="co"># Results</span>
epids[<span class="st">"chain"</span>]
<span class="co">#&gt; $chain</span>
<span class="co">#&gt; [1] "E.2 2019-01-01 -&gt; 2019-01-13 (C)" "E.2 2019-01-01 -&gt; 2019-01-13 (D)"</span>

epids[<span class="st">"cb2"</span>]
<span class="co">#&gt; $cb2</span>
<span class="co">#&gt; [1] "E.2 2019-01-01 -&gt; 2019-01-13 (C)" "E.2 2019-01-01 -&gt; 2019-01-13 (D)"</span>
<span class="co">#&gt; [3] "E.2 2019-01-01 -&gt; 2019-01-13 (D)" "E.8 2019-01-20 -&gt; 2019-01-30 (C)"</span>
<span class="co">#&gt; [5] "E.2 2019-01-01 -&gt; 2019-01-13 (D)" "E.8 2019-01-20 -&gt; 2019-01-30 (D)"</span></code></pre></div>
<p><em>Only showing <code>events</code> grouped into <code>episodes</code></em></p>
<p><strong>Figure 8a: Grouped episodes when considering only “exact” overlap method</strong> <img src="episode_group_files/figure-html/unnamed-chunk-58-1.png" width="816"></p>
<p><strong>Figure 8b: Grouped episodes when considering only “chain” overlap method</strong> <img src="episode_group_files/figure-html/unnamed-chunk-59-1.png" width="816"></p>
<p><strong>Figure 8c: Grouped episodes when considering “chain” or “inbetween” overlap method</strong> <img src="episode_group_files/figure-html/unnamed-chunk-60-1.png" width="816"></p>
<div id="case-and-recurrence-lengths-in-interval-grouping" class="section level4">
<h4 class="hasAnchor">
<a href="#case-and-recurrence-lengths-in-interval-grouping" class="anchor"></a>Case and recurrence lengths in interval grouping</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pa &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"28/03/2019"</span>, <span class="st">"01/04/2019"</span>, <span class="st">"03/04/2019"</span>, <span class="st">"07/04/2019"</span>,<span class="st">"12/04/2019"</span>)
pz &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"31/03/2019"</span>, <span class="st">"10/04/2019"</span>, <span class="st">"05/04/2019"</span>, <span class="st">"09/04/2019"</span>,<span class="st">"13/04/2019"</span>)

pa &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(pa, <span class="st">"%d/%m/%Y"</span>)
pz &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(pz, <span class="st">"%d/%m/%Y"</span>)

periods &lt;-<span class="st"> </span><span class="kw"><a href="../reference/number_line.html">number_line</a></span>(pa, pz)
periods
<span class="co">#&gt; [1] "2019-03-28 -&gt; 2019-03-31" "2019-04-01 -&gt; 2019-04-10"</span>
<span class="co">#&gt; [3] "2019-04-03 -&gt; 2019-04-05" "2019-04-07 -&gt; 2019-04-09"</span>
<span class="co">#&gt; [5] "2019-04-12 -&gt; 2019-04-13"</span></code></pre></div>
<p>As seen earlier, positive “length” means that; <code>event periods</code> overlapping with the index <code>event period</code> and those within <code>n</code>-days AFTER the <code><a href="../reference/number_line.html">end_point()</a></code> of the index <code>event period</code> will be grouped into the same <code>episode</code>. See another example below.</p>
<p><strong>Figure 9a: Fixed episodes with a case_length of 6</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eps_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(periods, <span class="dt">case_length =</span><span class="dv">6</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

eps_a
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-04-10 (C)" "E.1 2019-03-28 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [3] "E.1 2019-03-28 -&gt; 2019-04-10 (D)" "E.4 2019-04-07 -&gt; 2019-04-13 (C)"</span>
<span class="co">#&gt; [5] "E.4 2019-04-07 -&gt; 2019-04-13 (D)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-63-1.png" width="816"></p>
<p>In contrast, a negative “length” means that; only <code>event periods</code> within <code>n</code>-days BEFORE the <code><a href="../reference/number_line.html">end_point()</a></code> of the index <code>event period</code> will be grouped into the same <code>episode</code>.</p>
<p><strong>Figure 9b: Fixed episodes with a case_length of -2</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eps_b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(periods, <span class="dt">case_length =</span><span class="op">-</span><span class="dv">2</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

eps_b
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-03-31 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (C)"</span>
<span class="co">#&gt; [3] "E.3 2019-04-03 -&gt; 2019-04-05 (S)" "E.2 2019-04-01 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [5] "E.5 2019-04-12 -&gt; 2019-04-13 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-65-1.png" width="816"></p>
<p>By default, overlapping periods that are outside the 2-day periods are also groupped together. This can be changed with <code>include_initial_period</code>. See below.</p>
<p><strong>Figure 9c: Fixed episodes with a case_length of -2</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eps_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(periods, <span class="dt">case_length =</span><span class="op">-</span><span class="dv">2</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F,
                        <span class="dt">include_index_period =</span> F)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

eps_c
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-03-31 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (C)"</span>
<span class="co">#&gt; [3] "E.3 2019-04-03 -&gt; 2019-04-05 (S)" "E.2 2019-04-01 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [5] "E.5 2019-04-12 -&gt; 2019-04-13 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-67-1.png" width="816"></p>
<p><strong>Figure 9d: Fixed episodes with a case_length of -6</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eps_d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(periods, <span class="dt">case_length =</span><span class="op">-</span><span class="dv">6</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 2 record(s) with a unique ID.</span>

eps_d
<span class="co">#&gt; [1] "E.1 2019-03-28 -&gt; 2019-03-31 (C)" "E.2 2019-04-01 -&gt; 2019-04-10 (C)"</span>
<span class="co">#&gt; [3] "E.2 2019-04-01 -&gt; 2019-04-10 (D)" "E.2 2019-04-01 -&gt; 2019-04-10 (D)"</span>
<span class="co">#&gt; [5] "E.5 2019-04-12 -&gt; 2019-04-13 (C)"</span></code></pre></div>
<p><img src="episode_group_files/figure-html/unnamed-chunk-69-1.png" width="816"></p>
<p><a id="stratified_grouping"></a></p>
</div>
</div>
<div id="stratified-episode-grouping" class="section level3">
<h3 class="hasAnchor">
<a href="#stratified-episode-grouping" class="anchor"></a>Stratified episode grouping</h3>
<p>In practice, you’ll want to track <code>episodes</code> separately for groups (<code>strata</code>) such as patients, pathogens, sources of infection or any combination of these. This means that <code>episodes</code> from one patient will be different from other patients, or <code>episodes</code> of HIV diagnoses will be different those of HBV diagnoses.</p>
<p><em><code>episodes</code> from different <code>strata</code> can have a different <code>case_lengths</code> and/or <code>recurrence_lengths</code>.</em></p>
<p><em><code><a href="../reference/record_group.html">record_group()</a></code> is useful for creating group identifiers which can then be used as a <code>strata</code>. See the <a href="record_group.html">record group vignette</a> for further details.</em></p>
<p>As an example, using the <code>infections</code> dataset, a case definition may specify the following;</p>
<ul>
<li>UTI and BSI diagnoses are considered different <code>episodes</code> regardless of when they occur</li>
<li>UTI <code>episodes</code> have a cut-off of 8 days and a recurrence period of 31 days</li>
<li>BSI <code>episodes</code> have a cut-off of 15 days and no recurrence period</li>
</ul>
<p>By adding the <code>infection</code> column to the <code>strata</code> argument, <code>"UTI"</code> and <code>"BSI"</code> diagnoses will not be grouped together under the same <code>episode</code>. Furthermore, the <code>case_length</code> and <code>recurrence_length</code> for each will be different as specified in the <code>epi</code> and <code>recur</code> columns respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs &lt;-<span class="st"> </span>diyar<span class="op">::</span>infections[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>,<span class="st">"infection"</span>)]
dbs &lt;-<span class="st"> </span>dbs[dbs<span class="op">$</span>infection<span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"UTI"</span>,<span class="st">"BSI"</span>),]
dbs<span class="op">$</span>epi &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbs<span class="op">$</span>infection<span class="op">==</span><span class="st">"UTI"</span>, <span class="dv">7</span>, <span class="dv">14</span>)
dbs<span class="op">$</span>recur &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbs<span class="op">$</span>infection<span class="op">==</span><span class="st">"UTI"</span>, <span class="dv">30</span>, <span class="dv">0</span>)

dbs<span class="op">$</span>epids &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">date=</span>dbs<span class="op">$</span>date, <span class="dt">case_length =</span>dbs<span class="op">$</span>epi, <span class="dt">to_s4 =</span><span class="ot">TRUE</span>, 
                              <span class="dt">strata =</span> dbs<span class="op">$</span>infection, <span class="dt">recurrence_length =</span> dbs<span class="op">$</span>recur, 
                              <span class="dt">display =</span> <span class="ot">FALSE</span>, <span class="dt">group_stats =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

dbs
<span class="co">#&gt;          date infection epi recur                            epids</span>
<span class="co">#&gt; 1  2018-04-01       BSI  14     0 E.1 2018-04-01 == 2018-04-01 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (C)</span>
<span class="co">#&gt; 3  2018-04-13       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (R)</span>
<span class="co">#&gt; 5  2018-04-25       BSI  14     0 E.5 2018-04-25 -&gt; 2018-05-07 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI   7    30 E.2 2018-04-07 -&gt; 2018-05-01 (D)</span>
<span class="co">#&gt; 7  2018-05-07       BSI  14     0 E.5 2018-04-25 -&gt; 2018-05-07 (D)</span>
<span class="co">#&gt; 8  2018-05-13       BSI  14     0 E.8 2018-05-13 == 2018-05-13 (C)</span>
<span class="co">#&gt; 11 2018-05-31       BSI  14     0 E.9 2018-05-31 == 2018-05-31 (C)</span></code></pre></div>
<p>Stratified grouping is a faster and easier alternative to performing separate analyses for each subset (<code>strata</code>) of the dataset. However, if you must perform these separately, I recommend using a familiar <code>sn</code> and changing <code>to_s4</code> to <code>FALSE</code>. The former is so that you can easily link each <code>episode</code> back to the original dataset, while the latter is because binding <code>S4</code> objects in my personal opinion is a pain, so <code>to_s4 = FALSE</code> changes the <code>epid</code> objects to <code>data.frames</code>.</p>
<p><em>to_s4() and to_df() are convenience functions to change <code>epid</code>, <code>pid</code>, <code>number_line</code> S4 class objects to <code>data.frames</code> and vice versa.</em></p>
<p><a id="sub_strata"></a></p>
<div id="sub-strata" class="section level4">
<h4 class="hasAnchor">
<a href="#sub-strata" class="anchor"></a>Sub-strata</h4>
<p><code>Sub-strata</code> are when <code>events</code> within the same <code>strata</code> have different cut-offs. The case definition below demonstrates how this could be beneficial.</p>
<ul>
<li>UTI and BSI diagnoses are considered different <code>episodes</code> regardless of when they occur</li>
<li>UTI diagnoses have a cut-off of 8 days and a recurrence period of 31 days</li>
<li>BSI diagnoses have a cut-off of 15 days if not treated but 5 days if <code>treated</code>. In both situations there is no recurrence period.</li>
<li>RTI diagnoses have a cut-off of of 29 days and a recurrence period of 6 days</li>
</ul>
<p>In this example, whether or not the infection is <code>treated</code> should be viewed as the <code>sub-strata</code> i.e. in a patient (<code>strata</code>), an <code>episode</code> is expected to last longer if it’s not <code>treated</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs &lt;-<span class="st"> </span>diyar<span class="op">::</span>infections_<span class="dv">4</span>

dbs<span class="op">$</span>epids &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(dbs, <span class="dt">sn=</span>rid, <span class="dt">strata=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(pid, organism, source), <span class="dt">date=</span>date, 
                <span class="dt">case_length =</span>epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur,
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

dbs
<span class="co">#&gt;    rid       date pid organism source treated epi recur    epids</span>
<span class="co">#&gt; 1    1 2019-04-01   1  E. coli    UTI       -   7    30 E.01 (C)</span>
<span class="co">#&gt; 2    2 2019-04-06   1  E. coli    UTI       -   7    30 E.01 (D)</span>
<span class="co">#&gt; 3    3 2019-04-11   1  E. coli    BSI       Y   4     0 E.03 (C)</span>
<span class="co">#&gt; 4    4 2019-04-16   1  E. coli    BSI       N  14     0 E.04 (C)</span>
<span class="co">#&gt; 5    5 2019-04-21   1  E. coli    BSI       Y   4     0 E.04 (D)</span>
<span class="co">#&gt; 6    6 2019-04-26   1  E. coli    RTI       Y  28     5 E.06 (C)</span>
<span class="co">#&gt; 7    7 2019-05-01   1  E. coli    RTI       N  28     5 E.06 (D)</span>
<span class="co">#&gt; 8    8 2019-05-06   1  E. coli    BSI       Y   4     0 E.08 (C)</span>
<span class="co">#&gt; 9    9 2019-05-11   1  E. coli    BSI       N  14     0 E.09 (C)</span>
<span class="co">#&gt; 10  10 2019-05-16   1  E. coli    UTI       N   7    30 E.10 (C)</span>
<span class="co">#&gt; 11  11 2019-05-21   1  E. coli    UTI       N   7    30 E.10 (D)</span></code></pre></div>
<p>There are a few things to note with stratified grouping;</p>
<ul>
<li>Unless required, <code>case_length</code> and <code>recurrence_length</code> should be consistent for each <code>strata</code> otherwise, you’ll inadvertently create a sub-strata</li>
<li>
<code>Episode grouping</code> with and without a sub-strata are different and could lead to different results</li>
<li>Using a <code>sub-strata</code> is not the same as adding that <code>sub-strata</code> to the <code>strata</code> argument. In the example above, adding <code>treated</code> to <code>strata</code> will group <code>treated</code> infections separately from untreated infections. While this could be the desired outcome depending on your case definition, the case definition above did not require this, only that the <code>treated</code> infections last longer.</li>
</ul>
</div>
</div>
</div>
<div id="cut-down-your-processing-time" class="section level2">
<h2 class="hasAnchor">
<a href="#cut-down-your-processing-time" class="anchor"></a>Cut down your processing time</h2>
<p>Some case definitions are so specific that only certain kinds of <code>episodes</code> will be required. In such cases, you can save time by skipping <code>events</code> from <code>episodes</code> that aren’t required. There are 3 mechanisms to skip such <code>events</code>.</p>
<p><em>Skipped <code>events</code> are assigned unique episode IDs and their <code>case_nm</code> slot is flagged as <code>"Skipped"</code>.</em></p>
<div id="skip-subsets-of-the-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#skip-subsets-of-the-dataset" class="anchor"></a>Skip subsets of the dataset</h3>
<p>You can skip an entire <code>strata</code> of the dataset by changing it to <code>NA</code>. In the example below, assuming you were not interest in tracking <code>"GP1"</code> and <code>"GP2"</code> records, you can skip these to save time.</p>
<p><em>Changing <code>display</code> to <code>TRUE</code> shows how many iterations of the grouping process it’s taken to complete the entire process.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(hourly_data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"datetime"</span>,<span class="st">"category"</span>)], <span class="dv">10</span>)
dbs<span class="op">$</span>subset &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbs<span class="op">$</span>category<span class="op">!=</span><span class="st">"GP3"</span>, <span class="ot">NA</span>, <span class="st">"group"</span>)

<span class="co"># To skip OR</span>
dbs<span class="op">$</span>epids_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">strata=</span> dbs<span class="op">$</span>subset, <span class="dt">date =</span> dbs<span class="op">$</span>datetime, <span class="dt">case_length =</span> <span class="dv">5</span>, 
                                <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, <span class="dt">recurrence_length =</span> <span class="dv">9</span>, <span class="dt">display =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Episode or recurrence window 1.</span>
<span class="co">#&gt; 10 record(s); 8 excluded from episode grouping. 2 left to group.</span>
<span class="co">#&gt; 2 record(s); 2 grouped to episodes and 0 left to group.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete: 8 record(s) with a unique ID.</span>

<span class="co">#   OR</span>

<span class="co"># Not to skip</span>
dbs<span class="op">$</span>epids_b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">strata=</span> dbs<span class="op">$</span>category, <span class="dt">date =</span> dbs<span class="op">$</span>datetime, <span class="dt">case_length =</span> <span class="dv">5</span>, 
                                <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, <span class="dt">recurrence_length =</span> <span class="dv">9</span>, <span class="dt">display =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Episode or recurrence window 1.</span>
<span class="co">#&gt; 10 record(s); 3 grouped to episodes and 7 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 2.</span>
<span class="co">#&gt; 7 record(s); 7 grouped to episodes and 0 left to group.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

dbs
<span class="co">#&gt;               datetime category subset epids_a epids_b</span>
<span class="co">#&gt; 1  2019-04-01 00:03:20      GP1   &lt;NA&gt; E.1 (S) E.1 (C)</span>
<span class="co">#&gt; 2  2019-04-01 02:08:20      GP2   &lt;NA&gt; E.2 (S) E.2 (C)</span>
<span class="co">#&gt; 3  2019-04-01 04:01:40      GP1   &lt;NA&gt; E.3 (S) E.1 (D)</span>
<span class="co">#&gt; 4  2019-04-01 06:05:45      GP2   &lt;NA&gt; E.4 (S) E.2 (D)</span>
<span class="co">#&gt; 5  2019-04-01 08:03:52      GP1   &lt;NA&gt; E.5 (S) E.1 (R)</span>
<span class="co">#&gt; 6  2019-04-01 10:08:52      GP2   &lt;NA&gt; E.6 (S) E.2 (R)</span>
<span class="co">#&gt; 7  2019-04-01 12:06:50      GP1   &lt;NA&gt; E.7 (S) E.1 (D)</span>
<span class="co">#&gt; 8  2019-04-01 14:03:35      GP2   &lt;NA&gt; E.8 (S) E.2 (D)</span>
<span class="co">#&gt; 9  2019-04-01 16:03:42      GP3  group E.9 (C) E.9 (C)</span>
<span class="co">#&gt; 10 2019-04-01 18:01:52      GP3  group E.9 (D) E.9 (D)</span></code></pre></div>
</div>
<div id="skip-the-nth-order-skip-order-of-custom-sort" class="section level3">
<h3 class="hasAnchor">
<a href="#skip-the-nth-order-skip-order-of-custom-sort" class="anchor"></a>Skip the nth order (skip order) of custom sort</h3>
<p>In a dataset with multiple levels of <code>custom_sort</code>, you can skip <code>episodes</code> that will begin with the <code>nth</code> level (<code>skip_order</code>). A <code>skip_order</code> of <code>1</code> means that; after every <code>event</code> with the first level of your <code>custom_sort</code> has been grouped into <code>episodes</code>, the tracking process will come to an end.</p>
<p>This is handy when you’re grouping <code>episodes</code> from rare and common <code>events</code>, the rare <code>events</code> are the index <code>events</code> and it’s a hassle to subset the dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbf &lt;-<span class="st"> </span>dbf[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>, <span class="st">"infection"</span>)]
dbf<span class="op">$</span>c_sort &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbf<span class="op">$</span>infection <span class="op">==</span><span class="st"> "UTI"</span>, <span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(dbf<span class="op">$</span>infection <span class="op">==</span><span class="st"> "BSI"</span>, <span class="dv">2</span>, <span class="dv">3</span>))

<span class="co"># Skip episodes that would begin with BSI/UTI records</span>
dbf<span class="op">$</span>ep_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(dbf<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">15</span>, <span class="dt">data_source =</span> dbf<span class="op">$</span>infection, 
                           <span class="dt">custom_sort =</span> dbf<span class="op">$</span>c_sort, <span class="dt">skip_order =</span> <span class="dv">1</span>)
<span class="co">#&gt; Episode or recurrence window 1.</span>
<span class="co">#&gt; 11 record(s); 3 grouped to episodes and 8 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 2.</span>
<span class="co">#&gt; 8 record(s); 3 grouped to episodes and 5 left to group.</span>
<span class="co">#&gt; 5 record(s); 5 skipped</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete: 5 record(s) with a unique ID.</span>
dbf<span class="op">$</span>ep_a_d &lt;-<span class="st"> </span>dbf<span class="op">$</span>ep_a<span class="op">@</span>epid_dataset

<span class="co"># Don't skip any episodes</span>
dbf<span class="op">$</span>ep_b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(dbf<span class="op">$</span>date, <span class="dt">case_length =</span> <span class="dv">15</span>, <span class="dt">data_source =</span> dbf<span class="op">$</span>infection, 
                           <span class="dt">custom_sort =</span> dbf<span class="op">$</span>c_sort)
<span class="co">#&gt; Episode or recurrence window 1.</span>
<span class="co">#&gt; 11 record(s); 3 grouped to episodes and 8 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 2.</span>
<span class="co">#&gt; 8 record(s); 3 grouped to episodes and 5 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 3.</span>
<span class="co">#&gt; 5 record(s); 1 grouped to episodes and 4 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 4.</span>
<span class="co">#&gt; 4 record(s); 1 grouped to episodes and 3 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 5.</span>
<span class="co">#&gt; 3 record(s); 1 grouped to episodes and 2 left to group.</span>
<span class="co">#&gt; Episode or recurrence window 6.</span>
<span class="co">#&gt; 2 record(s); 2 grouped to episodes and 0 left to group.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>
dbf<span class="op">$</span>ep_b_d &lt;-<span class="st"> </span>dbf<span class="op">$</span>ep_b<span class="op">@</span>epid_dataset

dbf
<span class="co">#&gt;          date infection c_sort     ep_a  ep_a_d     ep_b  ep_b_d</span>
<span class="co">#&gt; 1  2018-04-01       BSI      2 E.01 (S)     BSI E.01 (C)     BSI</span>
<span class="co">#&gt; 2  2018-04-07       UTI      1 E.02 (C)     UTI E.02 (C)     UTI</span>
<span class="co">#&gt; 3  2018-04-13       UTI      1 E.02 (D)     UTI E.02 (D)     UTI</span>
<span class="co">#&gt; 4  2018-04-19       UTI      1 E.02 (D)     UTI E.02 (D)     UTI</span>
<span class="co">#&gt; 5  2018-04-25       BSI      2 E.05 (S)     BSI E.05 (C)     BSI</span>
<span class="co">#&gt; 6  2018-05-01       UTI      1 E.06 (C) BSI,UTI E.06 (C) BSI,UTI</span>
<span class="co">#&gt; 7  2018-05-07       BSI      2 E.06 (D) BSI,UTI E.06 (D) BSI,UTI</span>
<span class="co">#&gt; 8  2018-05-13       BSI      2 E.06 (D) BSI,UTI E.06 (D) BSI,UTI</span>
<span class="co">#&gt; 9  2018-05-19       RTI      3 E.09 (S)     RTI E.09 (C)     RTI</span>
<span class="co">#&gt; 10 2018-05-25       RTI      3 E.10 (S)     RTI E.09 (D)     RTI</span>
<span class="co">#&gt; 11 2018-05-31       BSI      2 E.11 (S)     BSI E.11 (C)     BSI</span></code></pre></div>
<p>Notice that in the skipped example <code>ep_a</code>, there are no <code>episodes</code> that has a <code>"BSI"</code> or <code>"RTI"</code> record as the <code>"case"</code>.</p>
</div>
<div id="skip-episodes-without-records-from-certain-data-sources" class="section level3">
<h3 class="hasAnchor">
<a href="#skip-episodes-without-records-from-certain-data-sources" class="anchor"></a>Skip episodes without records from certain data sources</h3>
<p>The third mechanism is partly a misnomer because it does not skip <code>events</code> but rather ungroups <code>episodes</code> after they’ve already been created. After <code>episodes</code> have been created, those that do not contain records from certain <code>data_sources</code> can be ungrouped using <code>data_links</code>. In such instances, the overall execution time will not be shortened but you’ll get an <code>episode</code> identifier that’s relevant to the <code>data_sources</code> you’re interested in. However, if a <code>strata</code> will not produce <code>episodes</code> with the required combination of <code>data_sources</code>, that entire <code>strata</code> will be skipped. If this happens, the overall execution may be shortened.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dttm &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(x, <span class="st">"UTC"</span>,<span class="dt">format=</span><span class="st">"%d/%m/%Y %H:%M:%S"</span>)
dbg &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">date =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.POSIXt">seq.POSIXt</a></span>(<span class="kw">dttm</span>(<span class="st">"01/04/2018 00:00:00"</span>), <span class="kw">dttm</span>(<span class="st">"31/05/2018 00:00:00"</span>),
                                    <span class="dt">by=</span><span class="st">"3 days"</span>))
dbg &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(dbg, <span class="dv">11</span>)
dbg<span class="op">$</span>recurrence &lt;-<span class="st"> </span><span class="dv">2</span>
dbg<span class="op">$</span>case_len &lt;-<span class="st"> </span><span class="dv">6</span>
dbg<span class="op">$</span>dataset &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"DS"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>),<span class="dv">2</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">3</span>,<span class="dv">4</span>)), <span class="dt">sep=</span><span class="st">""</span>)

<span class="co"># Don't skip any</span>
dbg<span class="op">$</span>ep_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(dbg, <span class="dt">date =</span> date, <span class="dt">case_length =</span> case_len, <span class="dt">episode_type =</span><span class="st">"rolling"</span>, 
                          <span class="dt">recurrence_length =</span> recurrence, <span class="dt">data_source =</span> dataset, <span class="dt">to_s4 =</span> T,
                          <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>

<span class="co"># Breakup episodes without events from the `DS3` `data_source` </span>
  <span class="co"># The `DS3` event MUST BE linked to events from other `data_sources`  </span>
dbg<span class="op">$</span>ep_b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(dbg, <span class="dt">date =</span> date, <span class="dt">case_length =</span> case_len, <span class="dt">episode_type =</span><span class="st">"rolling"</span>, 
                          <span class="dt">recurrence_length =</span> recurrence, <span class="dt">data_source =</span> dataset, <span class="dt">to_s4 =</span> T,
                          <span class="dt">data_links =</span> <span class="st">"DS3"</span>, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 5 record(s) with a unique ID.</span>

<span class="co"># Breakup episodes without events from the `DS3` `data_source` </span>
  <span class="co"># The `DS3` event DOESN'T HAVE to be linked to events from other `data_sources`   </span>
dbg<span class="op">$</span>ep_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(dbg, <span class="dt">date =</span> date, <span class="dt">case_length =</span> case_len, <span class="dt">episode_type =</span><span class="st">"rolling"</span>, 
                          <span class="dt">recurrence_length =</span> recurrence, <span class="dt">data_source =</span> dataset, <span class="dt">to_s4 =</span> T,
                          <span class="dt">data_links =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">g=</span><span class="st">"DS3"</span>), <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 3 record(s) with a unique ID.</span>

<span class="co"># Breakup episodes without events from the `DS3` `data_source` </span>
  <span class="co"># The `DS3` event MUST BE linkned to events from the `DS1` `data_source`</span>
dbg<span class="op">$</span>ep_d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(dbg, <span class="dt">date =</span> date, <span class="dt">case_length =</span> case_len, <span class="dt">episode_type =</span><span class="st">"rolling"</span>, 
                          <span class="dt">recurrence_length =</span> recurrence, <span class="dt">data_source =</span> dataset, <span class="dt">to_s4 =</span> T,
                          <span class="dt">data_links =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">l=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"DS3"</span>,<span class="st">"DS1"</span>)), <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 8 record(s) with a unique ID.</span>

dbg[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>, <span class="st">"dataset"</span>, <span class="st">"ep_a"</span>, <span class="st">"ep_b"</span>, <span class="st">"ep_c"</span>, <span class="st">"ep_d"</span>)]
<span class="co">#&gt;          date dataset     ep_a     ep_b     ep_c     ep_d</span>
<span class="co">#&gt; 1  2018-04-01     DS1 E.01 (C) E.01 (C) E.01 (C) E.01 (C)</span>
<span class="co">#&gt; 2  2018-04-04     DS2 E.01 (D) E.01 (D) E.01 (D) E.01 (D)</span>
<span class="co">#&gt; 3  2018-04-07     DS3 E.01 (D) E.01 (D) E.01 (D) E.01 (D)</span>
<span class="co">#&gt; 4  2018-04-10     DS1 E.04 (C) E.04 (S) E.04 (S) E.04 (S)</span>
<span class="co">#&gt; 5  2018-04-13     DS2 E.04 (D) E.05 (S) E.05 (S) E.05 (S)</span>
<span class="co">#&gt; 6  2018-04-16     DS1 E.04 (D) E.06 (S) E.06 (S) E.06 (S)</span>
<span class="co">#&gt; 7  2018-04-19     DS2 E.07 (C) E.07 (C) E.07 (C) E.07 (S)</span>
<span class="co">#&gt; 8  2018-04-22     DS3 E.07 (D) E.07 (D) E.07 (D) E.08 (S)</span>
<span class="co">#&gt; 9  2018-04-25     DS3 E.07 (D) E.07 (D) E.07 (D) E.09 (S)</span>
<span class="co">#&gt; 10 2018-04-28     DS3 E.10 (C) E.10 (S) E.10 (C) E.10 (S)</span>
<span class="co">#&gt; 11 2018-05-01     DS3 E.10 (D) E.11 (S) E.10 (D) E.11 (S)</span></code></pre></div>
<p><a id="tips"></a></p>
</div>
</div>
<div id="useful-ways-of-using-these-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#useful-ways-of-using-these-functions" class="anchor"></a>Useful ways of using these functions</h2>
<div id="episode-grouping-in-other-units-of-time" class="section level3">
<h3 class="hasAnchor">
<a href="#episode-grouping-in-other-units-of-time" class="anchor"></a>Episode grouping in other units of time</h3>
<p><code>episode grouping</code> can be done in other units of time (<code>episode_unit</code>). Acceptable options are <code>"seconds"</code>, <code>"minutes"</code>, <code>"hours"</code>, <code>"days"</code>, <code>"weeks"</code>, <code>"months"</code> or <code>"years"</code>. Below is an example of <code>episode grouping</code> by the hour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs &lt;-<span class="st"> </span>diyar<span class="op">::</span>hourly_data

<span class="co"># Each unit is relative to a set number of seconds. </span>
diyar<span class="op">::</span>episode_unit
<span class="co">#&gt; $seconds</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $minutes</span>
<span class="co">#&gt; [1] 60</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $hours</span>
<span class="co">#&gt; [1] 3600</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $days</span>
<span class="co">#&gt; [1] 86400</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $weeks</span>
<span class="co">#&gt; [1] 604800</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $months</span>
<span class="co">#&gt; [1] 2628000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $years</span>
<span class="co">#&gt; [1] 31536000</span>

<span class="co"># 1-day fixed episodes</span>
<span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> dbs<span class="op">$</span>datetime, <span class="dt">case_length =</span> <span class="dv">1</span>, <span class="dt">episode_unit =</span> <span class="st">"days"</span>, 
               <span class="dt">group_stats =</span> <span class="ot">TRUE</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>
<span class="co">#&gt;  [1] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (C)"</span>
<span class="co">#&gt;  [2] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [3] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [4] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [5] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [6] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [7] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [8] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt;  [9] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [10] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [11] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [12] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [13] "E.13 2019-04-02 00:05:11 == 2019-04-02 00:05:11 (C)"</span>

<span class="co"># 5-hr fixed episodes</span>
<span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">date =</span> dbs<span class="op">$</span>datetime, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, 
               <span class="dt">group_stats =</span> <span class="ot">TRUE</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>
<span class="co">#&gt;  [1] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (C)"</span>
<span class="co">#&gt;  [2] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (D)"</span>
<span class="co">#&gt;  [3] "E.01 2019-04-01 00:03:20 -&gt; 2019-04-01 04:01:40 (D)"</span>
<span class="co">#&gt;  [4] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (C)"</span>
<span class="co">#&gt;  [5] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (D)"</span>
<span class="co">#&gt;  [6] "E.04 2019-04-01 06:05:45 -&gt; 2019-04-01 10:08:52 (D)"</span>
<span class="co">#&gt;  [7] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (C)"</span>
<span class="co">#&gt;  [8] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (D)"</span>
<span class="co">#&gt;  [9] "E.07 2019-04-01 12:06:50 -&gt; 2019-04-01 16:03:42 (D)"</span>
<span class="co">#&gt; [10] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (C)"</span>
<span class="co">#&gt; [11] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [12] "E.10 2019-04-01 18:01:52 -&gt; 2019-04-01 22:05:12 (D)"</span>
<span class="co">#&gt; [13] "E.13 2019-04-02 00:05:11 == 2019-04-02 00:05:11 (C)"</span>

<span class="co"># 5-hr rolling episodes</span>
<span class="kw"><a href="../reference/episode_group.html">rolling_episodes</a></span>(<span class="dt">date =</span> dbs<span class="op">$</span>datetime, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, 
                 <span class="dt">group_stats =</span> <span class="ot">TRUE</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>
<span class="co">#&gt;  [1] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (C)"</span>
<span class="co">#&gt;  [2] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [3] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [4] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt;  [5] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [6] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt;  [7] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt;  [8] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt;  [9] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt; [10] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt; [11] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span>
<span class="co">#&gt; [12] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (R)"</span>
<span class="co">#&gt; [13] "E.1 2019-04-01 00:03:20 -&gt; 2019-04-02 00:05:11 (D)"</span></code></pre></div>
</div>
<div id="use-a-strata-from-record_group" class="section level3">
<h3 class="hasAnchor">
<a href="#use-a-strata-from-record_group" class="anchor"></a>Use a <code>strata</code> from <code><a href="../reference/record_group.html">record_group()</a></code>
</h3>
<p>You can used <code>pid</code> objects from <code><a href="../reference/record_group.html">record_group()</a></code> as a <code>strata</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs &lt;-<span class="st"> </span>diyar<span class="op">::</span>infections[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>,<span class="st">"infection"</span>)]; dbs
<span class="co">#&gt;          date infection</span>
<span class="co">#&gt; 1  2018-04-01       BSI</span>
<span class="co">#&gt; 2  2018-04-07       UTI</span>
<span class="co">#&gt; 3  2018-04-13       UTI</span>
<span class="co">#&gt; 4  2018-04-19       UTI</span>
<span class="co">#&gt; 5  2018-04-25       BSI</span>
<span class="co">#&gt; 6  2018-05-01       UTI</span>
<span class="co">#&gt; 7  2018-05-07       BSI</span>
<span class="co">#&gt; 8  2018-05-13       BSI</span>
<span class="co">#&gt; 9  2018-05-19       RTI</span>
<span class="co">#&gt; 10 2018-05-25       RTI</span>
<span class="co">#&gt; 11 2018-05-31       BSI</span>

<span class="co"># familiar unique record ids for reference - optional</span>
dbs<span class="op">$</span>rd_id &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">640</span>,<span class="dv">17</span>,<span class="dv">58</span>,<span class="dv">21</span>,<span class="dv">130</span>,<span class="dv">79</span>,<span class="dv">45</span>,<span class="dv">300</span>,<span class="dv">40</span>,<span class="dv">13</span>,<span class="dv">31</span>)

<span class="co"># strata based on matching sources of infection</span>
dbs<span class="op">$</span>pids &lt;-<span class="st"> </span><span class="kw"><a href="../reference/record_group.html">record_group</a></span>(dbs, <span class="dt">sn =</span> rd_id,  <span class="dt">criteria =</span> infection, <span class="dt">display =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

<span class="co"># stratified grouping </span>
dbs<span class="op">$</span>epids &lt;-<span class="st"> </span><span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(<span class="dt">sn =</span> dbs<span class="op">$</span>rd_id, <span class="dt">date =</span> dbs<span class="op">$</span>date, <span class="dt">strata =</span> dbs<span class="op">$</span>pids, 
                             <span class="dt">to_s4 =</span> <span class="ot">TRUE</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>, <span class="dt">case_length =</span> <span class="dv">10</span>)
<span class="co">#&gt; Episode grouping complete: 5 record(s) with a unique ID.</span>

dbs
<span class="co">#&gt;          date infection rd_id          pids     epids</span>
<span class="co">#&gt; 1  2018-04-01       BSI   640 P.31 (CRI 01) E.640 (C)</span>
<span class="co">#&gt; 2  2018-04-07       UTI    17 P.17 (CRI 01) E.017 (C)</span>
<span class="co">#&gt; 3  2018-04-13       UTI    58 P.17 (CRI 01) E.017 (D)</span>
<span class="co">#&gt; 4  2018-04-19       UTI    21 P.17 (CRI 01) E.021 (C)</span>
<span class="co">#&gt; 5  2018-04-25       BSI   130 P.31 (CRI 01) E.130 (C)</span>
<span class="co">#&gt; 6  2018-05-01       UTI    79 P.17 (CRI 01) E.079 (C)</span>
<span class="co">#&gt; 7  2018-05-07       BSI    45 P.31 (CRI 01) E.045 (C)</span>
<span class="co">#&gt; 8  2018-05-13       BSI   300 P.31 (CRI 01) E.045 (D)</span>
<span class="co">#&gt; 9  2018-05-19       RTI    40 P.13 (CRI 01) E.040 (C)</span>
<span class="co">#&gt; 10 2018-05-25       RTI    13 P.13 (CRI 01) E.040 (D)</span>
<span class="co">#&gt; 11 2018-05-31       BSI    31 P.31 (CRI 01) E.031 (C)</span></code></pre></div>
</div>
<div id="use-numeric-values-for-the-date-argument" class="section level3">
<h3 class="hasAnchor">
<a href="#use-numeric-values-for-the-date-argument" class="anchor"></a>Use numeric values for the date argument</h3>
<p><code>date</code> and <code>datetime</code> objects are fundamentally numeric values within the context of a reference point (<code><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date(..., origin)</a></code>). The <code>episode grouping</code> process ignores this context and instead uses each value as a reference point for others. Therefore, you use <code>numeric</code> values instead of <code>date</code> or <code>datetime</code> values for the <code>date</code> argument. For example, if you use <code>0-2</code>, it does not matter what they represent i.e. number of days from a particular date or number of seconds from a particular time. It only matters that <code>0</code> is before <code>1</code>, which in turn is before <code>2</code>. When the functions are used this way, the <code>episode_unit</code> argument is ignored.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vals &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">8.1</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="fl">8.5</span>,<span class="dv">12</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">15</span>,<span class="dv">5</span>,<span class="dv">7</span>)

vals
<span class="co">#&gt;  [1]  8.1  6.0 12.0  8.5 12.0  3.0  8.0 15.0  5.0  7.0</span>

<span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(vals, <span class="dt">case_length =</span> .<span class="dv">5</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 5 record(s) with a unique ID.</span>
<span class="co">#&gt;  [1] "E.07 8 -&gt; 8.5 (D)" "E.02 6 == 6 (C)"   "E.03 12 == 12 (C)"</span>
<span class="co">#&gt;  [4] "E.07 8 -&gt; 8.5 (D)" "E.03 12 == 12 (D)" "E.06 3 == 3 (C)"  </span>
<span class="co">#&gt;  [7] "E.07 8 -&gt; 8.5 (C)" "E.08 15 == 15 (C)" "E.09 5 == 5 (C)"  </span>
<span class="co">#&gt; [10] "E.10 7 == 7 (C)"</span>

<span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(vals, <span class="dt">case_length =</span> <span class="dv">5</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 1 record(s) with a unique ID.</span>
<span class="co">#&gt;  [1] "E.1 8.1 -&gt; 12 (C)" "E.6 3 -&gt; 8 (D)"    "E.1 8.1 -&gt; 12 (D)"</span>
<span class="co">#&gt;  [4] "E.1 8.1 -&gt; 12 (D)" "E.1 8.1 -&gt; 12 (D)" "E.6 3 -&gt; 8 (C)"   </span>
<span class="co">#&gt;  [7] "E.6 3 -&gt; 8 (D)"    "E.8 15 == 15 (C)"  "E.6 3 -&gt; 8 (D)"   </span>
<span class="co">#&gt; [10] "E.6 3 -&gt; 8 (D)"</span>

<span class="kw"><a href="../reference/episode_group.html">fixed_episodes</a></span>(vals, <span class="dt">case_length =</span> <span class="dv">100</span>, <span class="dt">group_stats =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Episode grouping complete: 0 record(s) with a unique ID.</span>
<span class="co">#&gt;  [1] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span>
<span class="co">#&gt;  [4] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (C)"</span>
<span class="co">#&gt;  [7] "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)" "E.6 3 -&gt; 15 (D)"</span>
<span class="co">#&gt; [10] "E.6 3 -&gt; 15 (D)"</span></code></pre></div>
</div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>There are a variety of ways to use these function. Before beginning, It’s worth reviewing your case definition and its implication on the dataset. In general, the following steps can serve as a quick guide on how to use them;</p>
<ol style="list-style-type: decimal">
<li>Work out the <code>strata</code> in your dataset</li>
<li>Choose and specify whether you need <code>"fixed"</code> or <code>"rolling"</code> episodes</li>
<li>Choose and specify whether you are grouping individual events or periods of events by supplying a <code>date</code>, <code>datetime</code> or <code>number_line</code> object as required. See <a href="#interval_grouping">interval grouping</a>
</li>
<li>Choose and specify the required <code>case_length</code>, and/or <code>recurrence_length</code>. The values should be unique to each <code>strata</code> unless you require a <a href="#sub_strata">sub-strata</a>
</li>
<li>Change <code>from_last</code> to <code>TRUE</code> if you want the index <code>event</code> to be the earliest or most recent <code>event</code>.</li>
<li>If you need the index <code>event</code> to be the earliest or most recent event of a particular type of event, use <code>custom_sort</code> in combination with <code>from_last</code>. If not, ignore this argument. See <a href="#custom_sort">user defined case assignment</a>
</li>
<li>If you require <code>episodes</code> to include <code>events</code> on either side of the index <code>event</code>, use <code>bi_direction</code> or an applicable <code>case_length</code> or <code>recurrence_length</code>. If not, ignore this point</li>
<li>Determine if you are measuring <code>episodes</code> by the minute, hour or day e.t.c., and set <code>episode_unit</code> accordingly. Be sure to supply a <code>datetime</code> to the <code>date</code> argument if <code>episode_unit</code> is less than <code>"days"</code>.</li>
</ol>
<p>These functions should prove useful in epidemiological analyses however, it’s also applicable to analyses in any field where the aim is to track events into temporal groups.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#uses">Uses</a></li>
      <li><a href="#overview">Overview</a></li>
      <li>
<a href="#implementation">Implementation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#episodes-windows-case-lengths-and-recurrence-periods">Episodes, windows, case lengths and recurrence periods</a></li>
      <li><a href="#how-to-apply-a-case-definition">How to apply a case definition</a></li>
      <li><a href="#cut-down-your-processing-time">Cut down your processing time</a></li>
      <li><a href="#useful-ways-of-using-these-functions">Useful ways of using these functions</a></li>
      </ul>
</li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Olisaeloka Nsonwu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
