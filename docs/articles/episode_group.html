<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with episode_group • diyar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with episode_group">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diyar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/episode_group.html">Getting started with episode_group</a>
    </li>
    <li>
      <a href="../articles/record_group.html">Getting started with record_group</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with episode_group</h1>
            
      
      
      <div class="hidden name"><code>episode_group.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Deduplicating records is an important step for applying case definitions in epidemiological analysis. In such analysis, a reference event is selected and considered the start of an episode, while subequent events within the episode are considered duplicates.</p>
<p><code><a href="../reference/episode_group.html">episode_group()</a></code> aims to provide a simple and flexible way to group records from multiple datasets into episodes, each lasting a specified period of time.</p>
</div>
<div id="uses" class="section level1">
<h1 class="hasAnchor">
<a href="#uses" class="anchor"></a>Uses</h1>
<p>Arguments in <code><a href="../reference/episode_group.html">episode_group()</a></code> can be used and combined in different ways to deduplicate datasets in a varierty of ways. The flexible application of both <a href="record_group.html"><code>record_group</code></a> and <code><a href="../reference/episode_group.html">episode_group()</a></code> can allow you implement a varierty of case definitions to a dataset. Below are some examples;</p>
<ol style="list-style-type: decimal">
<li>Group records into episodes lasting a fixed period (<code>case_length</code>) from a reference record (<code>"Case"</code>). See <a href="#episode_grouping">episode grouping</a>
</li>
<li>Create episodes that continue to re-occur within a fixed period (<code>recurrence_length</code>) of the most recent <code>"Duplicate"</code> or <code>"Recurrent"</code> record</li>
<li>Create episodes as in examples 1 and 2, and specify which record should be considered the <code>"Case"</code>. See <a href="#case_assignment">case assignment</a>
</li>
<li>Create episodes with a different <code>case_length</code> and/or <code>recurrence_length</code> in one or more datasets. See <a href="#stratified_grouping">stratified grouping</a>
</li>
</ol>
</div>
<div id="implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h1>
<p><a id="episode_grouping"></a></p>
<div id="episode-grouping" class="section level2">
<h2 class="hasAnchor">
<a href="#episode-grouping" class="anchor"></a>Episode grouping</h2>
<p>An episode as produced by <code><a href="../reference/episode_group.html">episode_group()</a></code> is a set of records within a particular time period. Each episode begins with a reference record (<code>"Case"</code>), and each subsequent record within the episode is flagged as a <code>"Duplicate"</code> of the <code>"Case"</code>.</p>
<p><code><a href="../reference/episode_group.html">episode_group()</a></code> can produce two type of episodes described below;</p>
<ul>
<li><p>A <code>"fixed"</code> episode - where all records are within a fixed <code>case_length</code> of the <code>"Case"</code>. All <code>"fixed"</code> episodes in the same <a href="#stratified_grouping"><code>strata</code></a> will have the same maximum episode length. See <a href="#stratified_grouping">stratified grouping</a></p></li>
<li><p>A <code>"rolling"</code> episode - where all records within a fixed <code>case_length</code> of the <code>"Case"</code>, and those within the periods of recurrence are grouped into an episode. See <a href="#recurrence">episodes windows and recurrence periods</a>.</p></li>
</ul>
<p>Note that a <code>"fixed"</code> episode will only have duplicates of the <code>"Case"</code> but a <code>"rolling"</code> episode may have duplicates of both the <code>"Case"</code> and <code>"Recurrent"</code> records.</p>
<p><a id="recurrence"></a><a></a></p>
</div>
<div id="episode-length-and-recurrence-periods" class="section level2">
<h2 class="hasAnchor">
<a href="#episode-length-and-recurrence-periods" class="anchor"></a>Episode length and recurrence periods</h2>
<p>Episode length is the period between the <code>"Case"</code> and the last record in an episode. For <code>"fixed"</code> episodes, the maximum episode length is equal to the <code>"case_length"</code>.</p>
<p>A recurrence period is the period between the last <code>"Recurrent"</code> or <code>"Duplicate"</code> record and the last record witin a <code>recurrence_length</code>. Only <code>"rolling"</code> episodes have a recurrence window. In addition, there can be multiple recurrence period within one episode. For a <code>"rolling"</code> episode, the episode lengthis the period covering the initial <code>case_length</code> and all recurrence periods.</p>
<p><strong>Include image</strong></p>
<p>The two examples below demonstrates the different implementations of <code>"fixed"</code> and <code>"rolling"</code> episode grouping.</p>
<div id="example-of-fixed-episode-grouping" class="section level4">
<h4 class="hasAnchor">
<a href="#example-of-fixed-episode-grouping" class="anchor"></a>Example of <code>"fixed"</code> episode grouping</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(diyar)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate)

infections &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rid =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,
  <span class="dt">date =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.Date">seq.Date</a></span>(<span class="kw">dmy</span>(<span class="st">"01/04/2019"</span>), <span class="kw">dmy</span>(<span class="st">"25/04/2019"</span>), <span class="st">"5 day"</span>), <span class="kw">dmy</span>(<span class="st">"04/06/2019"</span>)),
  <span class="dt">pid =</span> <span class="dv">1</span>, <span class="dt">infx =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"E. coli BSI"</span>,<span class="dv">6</span>), <span class="dt">epi =</span> <span class="dv">14</span>, <span class="dt">recur =</span> <span class="dv">7</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)

<span class="co"># Fixed episode</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections, rid, pid, date, epi, <span class="dt">group_stats =</span> <span class="ot">TRUE</span>)
  )
<span class="co">#&gt; Episode or recurrence window 1 .</span>
<span class="co">#&gt; 3 of 6 record(s) grouped into episodes. 3 records not yet grouped.</span>
<span class="co">#&gt; Episode or recurrence window 2 .</span>
<span class="co">#&gt; 2 of 3 record(s) grouped into episodes. 1 records not yet grouped.</span>
<span class="co">#&gt; Episode or recurrence window 3 .</span>
<span class="co">#&gt; 1 of 1 record(s) grouped into episodes. 0 records not yet grouped.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete - 1 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm epid_length</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    1      Case     10 days</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli BSI  14     7  2    1 Duplicate     10 days</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    1 Duplicate     10 days</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    4      Case      5 days</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli BSI  14     7  5    4 Duplicate      5 days</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case      0 days</span>
<span class="co">#&gt;   epid_total                    epid_window</span>
<span class="co">#&gt; 1          3 2019-04-01 UTC--2019-04-11 UTC</span>
<span class="co">#&gt; 2          3 2019-04-01 UTC--2019-04-11 UTC</span>
<span class="co">#&gt; 3          3 2019-04-01 UTC--2019-04-11 UTC</span>
<span class="co">#&gt; 4          2 2019-04-16 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 5          2 2019-04-16 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 6          1 2019-06-04 UTC--2019-06-04 UTC</span></code></pre></div>
<p>Records 1 to 3 are assigned a unique episode ID (<code>"1"</code>). In this instance, record 1 is considered the initial <code>"Case"</code> and records 2 and 3 its duplicates. This is because records 2 and 3 are dated within 14 days of record 1. Record 4 is dated after this 14-day period and hence begins a new <code>"Case"</code> which is assigned episode ID <code>"4"</code>. Record 5 is within 14 days of record 4 (<code>"Case"</code>) and so considered a <code>"Duplicate"</code> of record 4 and assigned the same episode ID as record 4. This process continues chronologically until all records have been assigned an episode ID.</p>
</div>
<div id="example-of-rolling-episode-grouping" class="section level4">
<h4 class="hasAnchor">
<a href="#example-of-rolling-episode-grouping" class="anchor"></a>Example of <code>"rolling"</code> episode grouping</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rolling episode</span>
<span class="co"># Progress messages can be turned off using the display argument</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date, 
                <span class="dt">case_length =</span> epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, 
                <span class="dt">display =</span> <span class="ot">FALSE</span>, <span class="dt">group_stats =</span> <span class="ot">TRUE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 1 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm epid_length</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    1      Case     20 days</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli BSI  14     7  2    1 Duplicate     20 days</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    1 Duplicate     20 days</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    1 Recurrent     20 days</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli BSI  14     7  5    1 Recurrent     20 days</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case      0 days</span>
<span class="co">#&gt;   epid_total                    epid_window</span>
<span class="co">#&gt; 1          5 2019-04-01 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 2          5 2019-04-01 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 3          5 2019-04-01 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 4          5 2019-04-01 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 5          5 2019-04-01 UTC--2019-04-21 UTC</span>
<span class="co">#&gt; 6          1 2019-06-04 UTC--2019-06-04 UTC</span></code></pre></div>
<p>In the <code>"rolling"</code> episode example, records 1 to 3 are also considered the same episode and therefore assigned the same episode ID. However, unlike the <code>"fixed"</code> episode example, record 4 is not considered a new <code>"Case"</code>, instead it’s considered a <code>"Recurrent"</code> record because it’s within 7 days of the last <code>"Duplicate"</code> (record 3). Similarly, record 5 is within 7 days of the last <code>"Recurrent"</code> record (record 4). Record 6 is not within 14 days of the <code>"Case"</code> and not within 7 days of the last <code>"Recurrent"</code> record or its <code>"Duplicate"</code>, and so can now be considered a new <code>"Case"</code>. <code>"Recurrent"</code> records are indicated in <code>case_nm</code> but are considered the same episode as the <code>"Case"</code>. This is why records 1 to 5 have the same episode ID.</p>
<p>Note that if there are <code>"Duplicate"</code> records, the recurrence period will start from the last <code>"Duplicate"</code> not the last <code>"Recurrent"</code> record. The <code>"Recurrent"</code> record is simply the first record (excluding the <code>"Duplicate"</code>) in the recurrence period. For example, in <code>infections_2</code> below, record 6 is considered a <code>"Recurrent"</code> record because it’s within 7 days of the record 5 (<code>"Duplicate"</code>) even though it’s more than 7 days after record 4, the <code>"Recurrent"</code> record.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infections_<span class="dv">2</span> &lt;-<span class="st"> </span>infections
infections_<span class="dv">2</span><span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.Date">seq.Date</a></span>(<span class="kw">dmy</span>(<span class="st">"01/04/2019"</span>), <span class="kw">dmy</span>(<span class="st">"25/04/2019"</span>), <span class="st">"5 day"</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], 
                     <span class="kw">dmy</span>(<span class="st">"12/04/2019"</span>), <span class="kw">dmy</span>(<span class="st">"17/04/2019"</span>), <span class="kw">dmy</span>(<span class="st">"20/04/2019"</span>))
infections_<span class="dv">2</span><span class="op">$</span>epi &lt;-<span class="st"> </span><span class="dv">11</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">2</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">2</span>, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date, 
                <span class="dt">case_length =</span> epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, 
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 0 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  11     7  1    1      Case</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli BSI  11     7  2    1 Duplicate</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  11     7  3    1 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-12   1 E. coli BSI  11     7  4    1 Recurrent</span>
<span class="co">#&gt; 5   5 2019-04-17   1 E. coli BSI  11     7  5    1 Duplicate</span>
<span class="co">#&gt; 6   6 2019-04-20   1 E. coli BSI  11     7  6    1 Recurrent</span></code></pre></div>
<p>By default, <code><a href="../reference/episode_group.html">episode_group()</a></code> will continue checking for <code>"Recurrent"</code> records and expanding the episode until all records have been grouped into episodes. However, you can choose the maximum number of times an episode can re-occur using <code>rolls_max</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infections_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rid =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">11</span>,
  <span class="dt">date =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.Date">seq.Date</a></span>(<span class="kw">dmy</span>(<span class="st">"01/04/2019"</span>), <span class="kw">dmy</span>(<span class="st">"11/04/2019"</span>), <span class="st">"1 day"</span>),
  <span class="dt">pid =</span> <span class="dv">1</span>, <span class="dt">epi =</span> <span class="dv">2</span>, <span class="dt">recur =</span><span class="dv">2</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)

<span class="co"># Infinite recurrence periods per episode (Default)</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">3</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">3</span>, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date, <span class="dt">case_length =</span> epi, 
                <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 0 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1   2     2  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-02   1   2     2  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-03   1   2     2  3    1 Recurrent</span>
<span class="co">#&gt; 4    4 2019-04-04   1   2     2  4    1 Recurrent</span>
<span class="co">#&gt; 5    5 2019-04-05   1   2     2  5    1 Recurrent</span>
<span class="co">#&gt; 6    6 2019-04-06   1   2     2  6    1 Recurrent</span>
<span class="co">#&gt; 7    7 2019-04-07   1   2     2  7    1 Recurrent</span>
<span class="co">#&gt; 8    8 2019-04-08   1   2     2  8    1 Recurrent</span>
<span class="co">#&gt; 9    9 2019-04-09   1   2     2  9    1 Recurrent</span>
<span class="co">#&gt; 10  10 2019-04-10   1   2     2 10    1 Recurrent</span>
<span class="co">#&gt; 11  11 2019-04-11   1   2     2 11    1 Recurrent</span>

<span class="co"># Maximum of 1 recurrence period per episode</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">3</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">3</span>, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date, <span class="dt">case_length =</span> epi, 
                <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, <span class="dt">rolls_max =</span> <span class="dv">1</span>, 
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 0 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1   2     2  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-02   1   2     2  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-03   1   2     2  3    1 Recurrent</span>
<span class="co">#&gt; 4    4 2019-04-04   1   2     2  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-05   1   2     2  5    4 Duplicate</span>
<span class="co">#&gt; 6    6 2019-04-06   1   2     2  6    4 Recurrent</span>
<span class="co">#&gt; 7    7 2019-04-07   1   2     2  7    7      Case</span>
<span class="co">#&gt; 8    8 2019-04-08   1   2     2  8    7 Duplicate</span>
<span class="co">#&gt; 9    9 2019-04-09   1   2     2  9    7 Recurrent</span>
<span class="co">#&gt; 10  10 2019-04-10   1   2     2 10   10      Case</span>
<span class="co">#&gt; 11  11 2019-04-11   1   2     2 11   10 Duplicate</span>

<span class="co"># Maximum of 2 recurrence periods per episode</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">3</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">3</span>, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date, <span class="dt">case_length =</span> epi, 
                <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, <span class="dt">rolls_max =</span> <span class="dv">2</span>, 
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 0 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1   2     2  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-02   1   2     2  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-03   1   2     2  3    1 Recurrent</span>
<span class="co">#&gt; 4    4 2019-04-04   1   2     2  4    1 Recurrent</span>
<span class="co">#&gt; 5    5 2019-04-05   1   2     2  5    5      Case</span>
<span class="co">#&gt; 6    6 2019-04-06   1   2     2  6    5 Duplicate</span>
<span class="co">#&gt; 7    7 2019-04-07   1   2     2  7    5 Recurrent</span>
<span class="co">#&gt; 8    8 2019-04-08   1   2     2  8    5 Recurrent</span>
<span class="co">#&gt; 9    9 2019-04-09   1   2     2  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-04-10   1   2     2 10    9 Duplicate</span>
<span class="co">#&gt; 11  11 2019-04-11   1   2     2 11    9 Recurrent</span></code></pre></div>
<p>Similarly, you can chose the maximum number of times to group records into episodes. This can be done with <code>episode_max</code> as shown below. Once <code>episode_max</code> is reached, any record not yet grouped is assigned a unique episode ID and considered a unique <code>"Case"</code>. <code>episode_max</code> can be used in both <code>"rolling"</code> and <code>"fixed"</code> episode grouping.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Maximum of 1 episode with 1 recurrence period</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">3</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">3</span>, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date,  <span class="dt">case_length =</span> epi, 
                <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, 
                <span class="dt">rolls_max =</span> <span class="dv">1</span>, <span class="dt">episodes_max =</span> <span class="dv">1</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 8 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1   2     2  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-02   1   2     2  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-03   1   2     2  3    1 Recurrent</span>
<span class="co">#&gt; 4    4 2019-04-04   1   2     2  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-05   1   2     2  5    5      Case</span>
<span class="co">#&gt; 6    6 2019-04-06   1   2     2  6    6      Case</span>
<span class="co">#&gt; 7    7 2019-04-07   1   2     2  7    7      Case</span>
<span class="co">#&gt; 8    8 2019-04-08   1   2     2  8    8      Case</span>
<span class="co">#&gt; 9    9 2019-04-09   1   2     2  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-04-10   1   2     2 10   10      Case</span>
<span class="co">#&gt; 11  11 2019-04-11   1   2     2 11   11      Case</span>

<span class="co"># Maximum of 2 episodes with 1 recurrence period</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">3</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">3</span>, <span class="dt">sn =</span> rid, <span class="dt">strata =</span> pid, <span class="dt">date =</span>date,  <span class="dt">case_length =</span> epi, 
                <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur, 
                <span class="dt">rolls_max =</span> <span class="dv">1</span>, <span class="dt">episodes_max =</span> <span class="dv">2</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 5 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1   2     2  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-02   1   2     2  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-03   1   2     2  3    1 Recurrent</span>
<span class="co">#&gt; 4    4 2019-04-04   1   2     2  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-05   1   2     2  5    4 Duplicate</span>
<span class="co">#&gt; 6    6 2019-04-06   1   2     2  6    4 Recurrent</span>
<span class="co">#&gt; 7    7 2019-04-07   1   2     2  7    7      Case</span>
<span class="co">#&gt; 8    8 2019-04-08   1   2     2  8    8      Case</span>
<span class="co">#&gt; 9    9 2019-04-09   1   2     2  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-04-10   1   2     2 10   10      Case</span>
<span class="co">#&gt; 11  11 2019-04-11   1   2     2 11   11      Case</span></code></pre></div>
<p><a id="case_assignment"></a></p>
</div>
</div>
<div id="case-assignment" class="section level2">
<h2 class="hasAnchor">
<a href="#case-assignment" class="anchor"></a>Case assignment</h2>
<p>Unless otherwise specified, episode grouping begins at the earliest record and proceeds to the most recent record. Therefore, the earliest record in an episode will be considered the <code>"Case"</code>. You can opt for the opposite behaviour by changing <code>from_last</code> to <code>TRUE</code>. Doing this will start episode grouping at the most recent record and proceed backwards to the earliest record, thereby making the most recent record the <code>"Case"</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Episode grouping in chronological order</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections, rid, pid, date, epi, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 1 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    1      Case</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli BSI  14     7  2    1 Duplicate</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    1 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    4      Case</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli BSI  14     7  5    4 Duplicate</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case</span>

<span class="co"># Episode grouping in reverse chronological order</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections, rid, pid, date, epi, <span class="dt">from_last =</span> <span class="ot">TRUE</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 1 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    2 Duplicate</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli BSI  14     7  2    2      Case</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    5 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    5 Duplicate</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli BSI  14     7  5    5      Case</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case</span></code></pre></div>
<p><a id="custom_sort"></a></p>
<div id="user-defined-case-assignment" class="section level3">
<h3 class="hasAnchor">
<a href="#user-defined-case-assignment" class="anchor"></a>User defined case assignment</h3>
<p>You can specify a different preference for case assignment using <code>custom_sort</code>. This is done by selecting one or more columns whose values when sorted in ascending order specifies your preference.</p>
<p>As an example, we can use this feature to implement a case definition where <em>E. coli</em> urinary tract infections (UTI) are considered precursors to <em>E. coli</em> bloodstream infections (BSI). Therefore we need to create the episodes in such a way that if there are UTI and BSI records within the same episode window (<code>case_length</code> or <code>recurrence_length</code>), then episode grouping should start from the UTI record.</p>
<p>The column(s) used for <code>custom_sort</code> can either be <code>"character"</code>, <code>"numeric"</code> or <code>"factor"</code> data types. However, note that each would obey standard <code>R</code> sort behaviour. This means a <code>factor</code> will sort on its levels not its descriptive label. See examples of this below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infections_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">mutate</span>(infections, <span class="dt">infx=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(<span class="kw">row_number</span>() <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="st">"E. coli UTI"</span>, infx))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">4</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">4</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span>pid, <span class="dt">date=</span>date, <span class="dt">case_length =</span>epi, 
                <span class="dt">custom_sort =</span> infx, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 1 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    1      Case</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli UTI  14     7  2    1 Duplicate</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    1 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    4      Case</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli UTI  14     7  5    4 Duplicate</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case</span>

infections_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">mutate</span>(infections_<span class="dv">4</span>,<span class="dt">infx =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(infx, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"E. coli UTI"</span>,<span class="st">"E. coli BSI"</span>)))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">4</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">4</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span>pid, <span class="dt">date=</span>date, <span class="dt">case_length =</span>epi, <span class="dt">custom_sort =</span> infx, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 3 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    1      Case</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli UTI  14     7  2    2      Case</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    2 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    2 Duplicate</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli UTI  14     7  5    5      Case</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case</span></code></pre></div>
<p>By default episode grouping occurs in chronological order (forward) or reverse chronological order (backward) depending on whether <code>from_last</code> is <code>FALSE</code> or <code>TRUE</code> respectively. <code>custom_sort</code> alters this behaviour and therefore impacts how episodes are grouped.</p>
<p>In the second example above, after changing the sort preference using factor levels, record 1 (<em>E. coli</em> BSI) and record 2 (<em>E. coli</em> UTI) are no longer grouped in the same episode. This is because record 2, is now the reference record, and since record 1 occurred before record 2, it’s not considered the same episode.</p>
<p>This behaviour may suffice depending on your case definition however, you can change this by changing <code>bi_direction</code> to <code>TRUE</code>. This will ensure that records within the <code>case_length</code> or <code>recurrence_length</code> on either sides of the reference record are grouped together. Compared to the example above, the one below now considers record 1 a duplicate of record 2, eventhough it occured before record 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">4</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">4</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span>pid, <span class="dt">date=</span>date, 
                <span class="dt">case_length =</span>epi, <span class="dt">custom_sort =</span> infx, <span class="dt">bi_direction =</span> <span class="ot">TRUE</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 2 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    2 Duplicate</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli UTI  14     7  2    2      Case</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    2 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    2 Duplicate</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli UTI  14     7  5    5      Case</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case</span></code></pre></div>
<p>A different approach can be to create episodes without <code>custom_sort</code> and then recode <code>case_nm</code> thereby picking a different record as the “case”. While this may be your desired approach, it’s important to note that this is not the same as using <code>custom_sort</code>. This is because case assignment determines which record episode grouping starts from.</p>
<p>As seen below, using the second approach also yields three episodes just as above. However, record 4 belongs to different episodes in both. This is because even though, <code>case_nm</code> has been now been recoded such that record 2 is the <code>"Case"</code>, episode grouping did not start at record 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">4</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">4</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span>pid, <span class="dt">date=</span>date, <span class="dt">case_length =</span>epi, 
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(epid) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(
    <span class="dt">case_nm =</span> <span class="kw">case_when</span>(
      infx<span class="op">==</span><span class="st">"E. coli UTI"</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>case_nm <span class="op">==</span><span class="st"> "Duplicate"</span> <span class="op">~</span><span class="st"> "Case"</span>,
      infx<span class="op">==</span><span class="st">"E. coli BSI"</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>case_nm <span class="op">==</span><span class="st"> "Case"</span> <span class="op">~</span><span class="st"> "Duplicate"</span>,
      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>case_nm
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"dup"</span>))
<span class="co">#&gt; Episode grouping complete - 1 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     7  1    1 Duplicate</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli UTI  14     7  2    1      Case</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     7  3    1 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     7  4    4 Duplicate</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli UTI  14     7  5    4      Case</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     7  6    6      Case</span></code></pre></div>
<p><a id="stratified_grouping"></a></p>
</div>
</div>
<div id="stratified-episode-grouping" class="section level2">
<h2 class="hasAnchor">
<a href="#stratified-episode-grouping" class="anchor"></a>Stratified episode grouping</h2>
<p>Episode grouping can be done separately by different type of records (<code>strata</code>). Examples of a <code>strata</code> could be patient IDs, type of pathogen, source of infection or a combination of these parameters. Episodes will not overlap across different <code>strata</code> but can have different <code>case_length</code> and <code>recurrence_lenght</code>.</p>
<p>To implement stratified episode grouping, supply the column name(s) of the record type identifiers to the <code>strata</code> argument. <code><a href="../reference/record_group.html">record_group()</a></code> is useful in creating a group identifier for the <code>strata</code> argument. It also helps in addressing instances of missing values in group identifiers. See <a href="record_group.html">record group</a> for further details.</p>
<p>As an example, using the <code>infections_4</code> dataset, a different case definition may specify the following;</p>
<ul>
<li>UTI and BSI records are considered different episodes regardless of when they occur.</li>
<li>UTI has a <code>case_length</code> of 7 days and recurrence period of 30 days</li>
<li>BSI has a <code>case_length</code> of 14 days and no recurrence period</li>
</ul>
<p>In the example below, adding <code>infx</code> to the <code>strata</code> argument means that <code>"E. coli UTI"</code> episodes will not overlap with <code>"E. coli BSI"</code> records. Furthermore, the <code>case_length</code> and <code>recurrence_length</code> for each will be different as specified in <code>epi</code> and <code>recur</code> respectively</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infections_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw">mutate</span>(infections_<span class="dv">4</span>, 
                       <span class="dt">epi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(infx<span class="op">==</span><span class="st">"E. coli UTI"</span>, <span class="dv">7</span>, <span class="dv">14</span>),
                       <span class="dt">recur =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(infx<span class="op">==</span><span class="st">"E. coli UTI"</span>, <span class="dv">30</span>, <span class="dv">0</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">5</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">5</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(pid, infx), <span class="dt">date=</span>date, 
                <span class="dt">case_length =</span>epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur,
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 4 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rid       date pid        infx epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1   1 2019-04-01   1 E. coli BSI  14     0  1    1      Case</span>
<span class="co">#&gt; 2   2 2019-04-06   1 E. coli UTI   7    30  2    2      Case</span>
<span class="co">#&gt; 3   3 2019-04-11   1 E. coli BSI  14     0  3    1 Duplicate</span>
<span class="co">#&gt; 4   4 2019-04-16   1 E. coli BSI  14     0  4    4      Case</span>
<span class="co">#&gt; 5   5 2019-04-21   1 E. coli UTI   7    30  5    5      Case</span>
<span class="co">#&gt; 6   6 2019-06-04   1 E. coli BSI  14     0  6    6      Case</span></code></pre></div>
<p><a id="sub_strata"></a></p>
<div id="sub-strata" class="section level3">
<h3 class="hasAnchor">
<a href="#sub-strata" class="anchor"></a>Sub-strata</h3>
<p>If <code>case_length</code> or <code>recurrence_length</code> is unique to a <code>strata</code>, every episode in that <code>strata</code> will have the same maximum episode length. However, a sub-strata is created when records within a <code>strata</code> have different <code>case_length</code> or <code>recurrence_length</code>. For example, a different case definition may specify that;</p>
<ul>
<li>UTI and BSI records are different episodes regardless of when they occur.</li>
<li>UTI have a <code>case_length</code> of 7 days and recurrence period of 30 days</li>
<li>BSI have a <code>case_length</code> of 14 days if not treated, <strong>OR</strong> <code>case_length</code> of 4 days if treated, and no recurence period in both situations</li>
<li>Respiratory tract infections (RTI) have a <code>case_length</code> of 28 days and recurrence period of 5 days</li>
</ul>
<p>In this example, whether or not the infection is treated should be considered the sub-strata, and the source of infection considered the <code>strata</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infections_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rid =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">11</span>,
  <span class="dt">date =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.Date">seq.Date</a></span>(<span class="kw">dmy</span>(<span class="st">"01/04/2019"</span>), <span class="kw">dmy</span>(<span class="st">"21/05/2019"</span>), <span class="st">"5 day"</span>),
  <span class="dt">pid =</span> <span class="dv">1</span>,
  <span class="dt">organism =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"E. coli"</span>,<span class="dv">11</span>), 
  <span class="dt">source =</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"UTI"</span>,<span class="dv">2</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"BSI"</span>,<span class="dv">3</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"RTI"</span>,<span class="dv">2</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"BSI"</span>,<span class="dv">2</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"UTI"</span>,<span class="dv">2</span>)), 
  <span class="dt">treated =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"-"</span>,<span class="st">"-"</span>,<span class="st">"Y"</span>,<span class="st">"N"</span>,<span class="st">"Y"</span>,<span class="st">"Y"</span>,<span class="st">"N"</span>,<span class="st">"Y"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>),
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)

infections_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw">mutate</span>(infections_<span class="dv">5</span>,
                       <span class="dt">epi =</span> <span class="kw">case_when</span>(
                         source <span class="op">==</span><span class="st"> "UTI"</span> <span class="op">~</span><span class="st"> </span><span class="dv">7</span>,
                         source <span class="op">==</span><span class="st"> "BSI"</span> <span class="op">&amp;</span><span class="st"> </span>treated <span class="op">==</span><span class="st"> "Y"</span> <span class="op">~</span><span class="st"> </span><span class="dv">5</span>,
                         source <span class="op">==</span><span class="st"> "BSI"</span> <span class="op">&amp;</span><span class="st"> </span>treated <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"N"</span>,<span class="st">"-"</span>) <span class="op">~</span><span class="st"> </span><span class="dv">14</span>,
                         source <span class="op">==</span><span class="st"> "RTI"</span> <span class="op">~</span><span class="st"> </span><span class="dv">28</span>
                         ),
                       <span class="dt">recur =</span> <span class="kw">case_when</span>(
                         source <span class="op">==</span><span class="st"> "UTI"</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,
                         source <span class="op">==</span><span class="st"> "BSI"</span> <span class="op">&amp;</span><span class="st"> </span>treated <span class="op">==</span><span class="st"> "Y"</span> <span class="op">~</span><span class="st"> </span><span class="dv">5</span>,
                         source <span class="op">==</span><span class="st"> "BSI"</span> <span class="op">&amp;</span><span class="st"> </span>treated <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"N"</span>,<span class="st">"-"</span>) <span class="op">~</span><span class="st"> </span><span class="dv">5</span>,
                         source <span class="op">==</span><span class="st"> "RTI"</span> <span class="op">~</span><span class="st"> </span><span class="dv">5</span>
                         )
                       )

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">5</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">5</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(pid, organism, source), <span class="dt">date=</span>date, 
                <span class="dt">case_length =</span>epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur,
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 3 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid organism source treated epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1  E. coli    UTI       -   7     0  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-06   1  E. coli    UTI       -   7     0  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-11   1  E. coli    BSI       Y   5     5  3    3      Case</span>
<span class="co">#&gt; 4    4 2019-04-16   1  E. coli    BSI       N  14     5  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-21   1  E. coli    BSI       Y   5     5  5    4 Duplicate</span>
<span class="co">#&gt; 6    6 2019-04-26   1  E. coli    RTI       Y  28     5  6    6      Case</span>
<span class="co">#&gt; 7    7 2019-05-01   1  E. coli    RTI       N  28     5  7    6 Duplicate</span>
<span class="co">#&gt; 8    8 2019-05-06   1  E. coli    BSI       Y   5     5  8    8      Case</span>
<span class="co">#&gt; 9    9 2019-05-11   1  E. coli    BSI       N  14     5  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-05-16   1  E. coli    UTI       N   7     0 10   10      Case</span>
<span class="co">#&gt; 11  11 2019-05-21   1  E. coli    UTI       N   7     0 11   10 Duplicate</span></code></pre></div>
<p>There are a few things to note with stratified grouping;</p>
<ul>
<li>Unless required, <code>case_length</code> and <code>recurrence_length</code> should be consistent across each <code>strata</code> otherwise, you’ll inadvertently create a sub-strata</li>
<li>The behaviour of <code>episode_grouping()</code> with and without a sub-strata is different and could lead to different results</li>
<li>Using sub-strata is not the same as adding that sub-strata to the <code>strata</code> argument. In the example above, adding <code>treated</code> to <code>strata</code> will group treated infections separately from untreated infections. While this could be the desired outcome depending on your case definition, the case definition above did not required treated and untreated infections to be grouped separately, only that the treated infections last longer. The example below demonstrates this difference;</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  infections_<span class="dv">5</span>,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(infections_<span class="dv">5</span>, <span class="dt">sn=</span>rid, <span class="dt">strata=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(pid, organism, source, treated), <span class="dt">date=</span>date, 
                <span class="dt">case_length =</span>epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">recurrence_length =</span> recur,
                <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Episode grouping complete - 7 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid       date pid organism source treated epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01   1  E. coli    UTI       -   7     0  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-06   1  E. coli    UTI       -   7     0  2    1 Duplicate</span>
<span class="co">#&gt; 3    3 2019-04-11   1  E. coli    BSI       Y   5     5  3    3      Case</span>
<span class="co">#&gt; 4    4 2019-04-16   1  E. coli    BSI       N  14     5  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-21   1  E. coli    BSI       Y   5     5  5    5      Case</span>
<span class="co">#&gt; 6    6 2019-04-26   1  E. coli    RTI       Y  28     5  6    6      Case</span>
<span class="co">#&gt; 7    7 2019-05-01   1  E. coli    RTI       N  28     5  7    7      Case</span>
<span class="co">#&gt; 8    8 2019-05-06   1  E. coli    BSI       Y   5     5  8    8      Case</span>
<span class="co">#&gt; 9    9 2019-05-11   1  E. coli    BSI       N  14     5  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-05-16   1  E. coli    UTI       N   7     0 10   10      Case</span>
<span class="co">#&gt; 11  11 2019-05-21   1  E. coli    UTI       N   7     0 11   10 Duplicate</span></code></pre></div>
<p>Stratified episode grouping will produce the same results as when you subset the dataset by <code>strata</code> and use <code><a href="../reference/episode_group.html">episode_group()</a></code> on each with same arguments as required. However, stratified episode grouping is the faster option to achieve this.</p>
</div>
</div>
<div id="useful-ways-of-using-episode_group" class="section level2">
<h2 class="hasAnchor">
<a href="#useful-ways-of-using-episode_group" class="anchor"></a>Useful ways of using episode_group</h2>
<div id="episode-grouping-across-other-units-of-time" class="section level3">
<h3 class="hasAnchor">
<a href="#episode-grouping-across-other-units-of-time" class="anchor"></a>Episode grouping across other units of time</h3>
<p>In the examples above, the unit for episode length (<code>episode_unit</code>) was in “days”. However, episode grouping can be done by <code>"hours"</code> and <code>"minutes"</code>. Note that the minimum unit supported is <code>"seconds"</code>. Below is an example of episode grouping by the hour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hourly_dataset &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rid =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">13</span>,
  <span class="dt">datetime =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq.POSIXt">seq.POSIXt</a></span>(<span class="kw">dmy_hms</span>(<span class="st">"01/04/2019 00:00:00"</span>), <span class="kw">dmy_hms</span>(<span class="st">"01/04/2019 24:00:00"</span>), <span class="st">"120 min"</span>),
  <span class="dt">category =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"GP1"</span>,<span class="st">"GP2"</span>), <span class="dv">4</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"GP3"</span>,<span class="dv">5</span>)) , <span class="dt">epi =</span><span class="dv">5</span>, <span class="dt">recur =</span><span class="dv">9</span>, 
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  hourly_dataset,
  <span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(hourly_dataset, rid, category, datetime, epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, <span class="dt">recurrence_length =</span> recur, <span class="dt">group_stats =</span> <span class="ot">TRUE</span>)
  )
<span class="co">#&gt; Episode or recurrence window 1 .</span>
<span class="co">#&gt; 7 of 13 record(s) grouped into episodes. 6 records not yet grouped.</span>
<span class="co">#&gt; Episode or recurrence window 2 .</span>
<span class="co">#&gt; 6 of 6 record(s) grouped into episodes. 0 records not yet grouped.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete - 0 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid            datetime category epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01 00:00:00      GP1   5     9  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-01 02:00:00      GP2   5     9  2    2      Case</span>
<span class="co">#&gt; 3    3 2019-04-01 04:00:00      GP1   5     9  3    1 Duplicate</span>
<span class="co">#&gt; 4    4 2019-04-01 06:00:00      GP2   5     9  4    2 Duplicate</span>
<span class="co">#&gt; 5    5 2019-04-01 08:00:00      GP1   5     9  5    1 Recurrent</span>
<span class="co">#&gt; 6    6 2019-04-01 10:00:00      GP2   5     9  6    2 Recurrent</span>
<span class="co">#&gt; 7    7 2019-04-01 12:00:00      GP1   5     9  7    1 Duplicate</span>
<span class="co">#&gt; 8    8 2019-04-01 14:00:00      GP2   5     9  8    2 Duplicate</span>
<span class="co">#&gt; 9    9 2019-04-01 16:00:00      GP3   5     9  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-04-01 18:00:00      GP3   5     9 10    9 Duplicate</span>
<span class="co">#&gt; 11  11 2019-04-01 20:00:00      GP3   5     9 11    9 Duplicate</span>
<span class="co">#&gt; 12  12 2019-04-01 22:00:00      GP3   5     9 12    9 Recurrent</span>
<span class="co">#&gt; 13  13 2019-04-02 00:00:00      GP3   5     9 13    9 Duplicate</span>
<span class="co">#&gt;    epid_length epid_total                                      epid_window</span>
<span class="co">#&gt; 1     12 hours          4 2019-04-01 00:00:00 UTC--2019-04-01 12:00:00 UTC</span>
<span class="co">#&gt; 2     12 hours          4 2019-04-01 02:00:00 UTC--2019-04-01 14:00:00 UTC</span>
<span class="co">#&gt; 3     12 hours          4 2019-04-01 00:00:00 UTC--2019-04-01 12:00:00 UTC</span>
<span class="co">#&gt; 4     12 hours          4 2019-04-01 02:00:00 UTC--2019-04-01 14:00:00 UTC</span>
<span class="co">#&gt; 5     12 hours          4 2019-04-01 00:00:00 UTC--2019-04-01 12:00:00 UTC</span>
<span class="co">#&gt; 6     12 hours          4 2019-04-01 02:00:00 UTC--2019-04-01 14:00:00 UTC</span>
<span class="co">#&gt; 7     12 hours          4 2019-04-01 00:00:00 UTC--2019-04-01 12:00:00 UTC</span>
<span class="co">#&gt; 8     12 hours          4 2019-04-01 02:00:00 UTC--2019-04-01 14:00:00 UTC</span>
<span class="co">#&gt; 9      8 hours          5 2019-04-01 16:00:00 UTC--2019-04-02 00:00:00 UTC</span>
<span class="co">#&gt; 10     8 hours          5 2019-04-01 16:00:00 UTC--2019-04-02 00:00:00 UTC</span>
<span class="co">#&gt; 11     8 hours          5 2019-04-01 16:00:00 UTC--2019-04-02 00:00:00 UTC</span>
<span class="co">#&gt; 12     8 hours          5 2019-04-01 16:00:00 UTC--2019-04-02 00:00:00 UTC</span>
<span class="co">#&gt; 13     8 hours          5 2019-04-01 16:00:00 UTC--2019-04-02 00:00:00 UTC</span></code></pre></div>
</div>
<div id="limit-episode-grouping-to-a-subset-of-the-dataframe" class="section level3">
<h3 class="hasAnchor">
<a href="#limit-episode-grouping-to-a-subset-of-the-dataframe" class="anchor"></a>Limit episode grouping to a subset of the dataframe</h3>
<p>If there is a subset which you do not wish to group into episodes, you can separate the dataframe and use <code><a href="../reference/episode_group.html">episode_group()</a></code> on only the desired subset. Then join the subsets back to form the original dataframe. However, a faster alternative is to assign a <code>case_length</code> and <code>recurrence_length</code> of <code>0</code> to the subsets you need to exclude from episode grouping. Doing this will ignore those subsets for episode grouping and assign unique IDs to every record in it. The subsets to be excluded must be included in <code>strata</code> for this to work. This is particularly useful when the number of records you want to group are fewer than those you do not want to group.</p>
<p>For example, with the <code>hourly_dataset</code>, you can decide to exclude <code>"GP1"</code> and <code>"GP2"</code> records from episode grouping as shown below;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(hourly_dataset, <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">epi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(category<span class="op">!=</span><span class="st">"GP3"</span>, <span class="dv">0</span>, epi), <span class="dt">recur =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(category<span class="op">!=</span><span class="st">"GP3"</span>,<span class="dv">0</span>,recur)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(.,<span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(., rid, category, datetime, epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, <span class="dt">recurrence_length =</span> recur, <span class="dt">display =</span> <span class="ot">TRUE</span>, <span class="dt">group_stats =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt; Episode or recurrence window 1 .</span>
<span class="co">#&gt; 2 of 2 record(s) grouped into episodes. 0 records not yet grouped.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete - 8 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid            datetime category epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01 00:00:00      GP1   0     0  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-01 02:00:00      GP2   0     0  2    2      Case</span>
<span class="co">#&gt; 3    3 2019-04-01 04:00:00      GP1   0     0  3    3      Case</span>
<span class="co">#&gt; 4    4 2019-04-01 06:00:00      GP2   0     0  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-01 08:00:00      GP1   0     0  5    5      Case</span>
<span class="co">#&gt; 6    6 2019-04-01 10:00:00      GP2   0     0  6    6      Case</span>
<span class="co">#&gt; 7    7 2019-04-01 12:00:00      GP1   0     0  7    7      Case</span>
<span class="co">#&gt; 8    8 2019-04-01 14:00:00      GP2   0     0  8    8      Case</span>
<span class="co">#&gt; 9    9 2019-04-01 16:00:00      GP3   5     9  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-04-01 18:00:00      GP3   5     9 10    9 Duplicate</span>
<span class="co">#&gt;    epid_length epid_total                                      epid_window</span>
<span class="co">#&gt; 1      0 hours          1 2019-04-01 00:00:00 UTC--2019-04-01 00:00:00 UTC</span>
<span class="co">#&gt; 2      0 hours          1 2019-04-01 02:00:00 UTC--2019-04-01 02:00:00 UTC</span>
<span class="co">#&gt; 3      0 hours          1 2019-04-01 04:00:00 UTC--2019-04-01 04:00:00 UTC</span>
<span class="co">#&gt; 4      0 hours          1 2019-04-01 06:00:00 UTC--2019-04-01 06:00:00 UTC</span>
<span class="co">#&gt; 5      0 hours          1 2019-04-01 08:00:00 UTC--2019-04-01 08:00:00 UTC</span>
<span class="co">#&gt; 6      0 hours          1 2019-04-01 10:00:00 UTC--2019-04-01 10:00:00 UTC</span>
<span class="co">#&gt; 7      0 hours          1 2019-04-01 12:00:00 UTC--2019-04-01 12:00:00 UTC</span>
<span class="co">#&gt; 8      0 hours          1 2019-04-01 14:00:00 UTC--2019-04-01 14:00:00 UTC</span>
<span class="co">#&gt; 9      2 hours          2 2019-04-01 16:00:00 UTC--2019-04-01 18:00:00 UTC</span>
<span class="co">#&gt; 10     2 hours          2 2019-04-01 16:00:00 UTC--2019-04-01 18:00:00 UTC</span></code></pre></div>
<p>Note that using a <code>case_length</code> and <code>recurrence_length</code> of <code>"1"</code> will yield the same results but will take more time, because it is essentially checking each record as a new <code>"Case"</code>. See the difference below;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(hourly_dataset, <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">epi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(category<span class="op">!=</span><span class="st">"GP3"</span>, <span class="dv">1</span>, epi), <span class="dt">recur =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(category<span class="op">!=</span><span class="st">"GP3"</span>,<span class="dv">1</span>,recur)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(.,<span class="kw"><a href="../reference/episode_group.html">episode_group</a></span>(., rid, category, datetime, epi, <span class="dt">episode_type =</span> <span class="st">"rolling"</span>, <span class="dt">episode_unit =</span> <span class="st">"hours"</span>, <span class="dt">recurrence_length =</span> recur, <span class="dt">display =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt; Episode or recurrence window 1 .</span>
<span class="co">#&gt; 4 of 10 record(s) grouped into episodes. 6 records not yet grouped.</span>
<span class="co">#&gt; Episode or recurrence window 2 .</span>
<span class="co">#&gt; 2 of 6 record(s) grouped into episodes. 4 records not yet grouped.</span>
<span class="co">#&gt; Episode or recurrence window 3 .</span>
<span class="co">#&gt; 2 of 4 record(s) grouped into episodes. 2 records not yet grouped.</span>
<span class="co">#&gt; Episode or recurrence window 4 .</span>
<span class="co">#&gt; 2 of 2 record(s) grouped into episodes. 0 records not yet grouped.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Episode grouping complete - 8 record(s) assinged a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rid            datetime category epi recur sn epid   case_nm</span>
<span class="co">#&gt; 1    1 2019-04-01 00:00:00      GP1   1     1  1    1      Case</span>
<span class="co">#&gt; 2    2 2019-04-01 02:00:00      GP2   1     1  2    2      Case</span>
<span class="co">#&gt; 3    3 2019-04-01 04:00:00      GP1   1     1  3    3      Case</span>
<span class="co">#&gt; 4    4 2019-04-01 06:00:00      GP2   1     1  4    4      Case</span>
<span class="co">#&gt; 5    5 2019-04-01 08:00:00      GP1   1     1  5    5      Case</span>
<span class="co">#&gt; 6    6 2019-04-01 10:00:00      GP2   1     1  6    6      Case</span>
<span class="co">#&gt; 7    7 2019-04-01 12:00:00      GP1   1     1  7    7      Case</span>
<span class="co">#&gt; 8    8 2019-04-01 14:00:00      GP2   1     1  8    8      Case</span>
<span class="co">#&gt; 9    9 2019-04-01 16:00:00      GP3   5     9  9    9      Case</span>
<span class="co">#&gt; 10  10 2019-04-01 18:00:00      GP3   5     9 10    9 Duplicate</span></code></pre></div>
</div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>There are a varierty of ways to use this function. It’s worth reviewing your case definition and its implication on the dataset before using this function. In general the following steps will help you choose how to use this function;</p>
<ol style="list-style-type: decimal">
<li>work out which columns should be the <code>strata</code>
</li>
<li>choose whether you need <code>"fixed"</code> or <code>"rolling"</code> episodes<br>
</li>
<li>create a colum for <code>case_length</code>, and/or <code>recurrence_length</code>. The values should be unique to each <code>strata</code> unless you require a <a href="#sub_strata">sub-strata</a>
</li>
<li>change <code>from_last</code> to <code>TRUE</code>if you want to start episode grouping at the most recent record thereby making it the <code>"Case"</code>. Note that this is not the same as starting episode grouping at the earliest record (<code>from_last</code> is <code>FALSE</code>) and then picking the most recent record in that episode as the <code>"Case"</code>. See <a href="#case_assignment">case assignment</a>
</li>
<li>if you require the <code>"Case"</code> to be the earliest or most recent record from a particular type of record use <code>custom_sort</code> in combination with <code>from_last</code>. If not, ignore this argument. See <a href="#custom_sort">user defined case assignment</a>
</li>
<li>if you require episodes to include records on either side of the <code>"Case"</code> use <code>bi_direction</code>. If not, ignore this argument</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#uses">Uses</a></li>
      <li>
<a href="#implementation">Implementation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#episode-grouping">Episode grouping</a></li>
      <li><a href="#episode-length-and-recurrence-periods">Episode length and recurrence periods</a></li>
      <li><a href="#case-assignment">Case assignment</a></li>
      <li><a href="#stratified-episode-grouping">Stratified episode grouping</a></li>
      <li><a href="#useful-ways-of-using-episode_group">Useful ways of using episode_group</a></li>
      </ul>
</li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Olisa Nsonwu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
