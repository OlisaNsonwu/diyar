<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with record_group • diyar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with record_group">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diyar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/episode_group.html">Getting started with episode_group</a>
    </li>
    <li>
      <a href="../articles/record_group.html">Getting started with record_group</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with record_group</h1>
            
      
      
      <div class="hidden name"><code>record_group.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Linking multiple datasets is a common task in research, particularly those involving the use of “big data”. Deterministic record linkage is the simplest and most common method for record linkage however, its accuracy relies heavly on data quality. Too many incorrect or missing values will often provide an unacceptable number of false matches or mismatches.</p>
<p>This function aims to provide a simple, multi-staged and flexible implementation of deterministic record linkage which tries to maximise succesful linkages in datasets with missing or incorrect group identifiers eg. customer, patient or event ID. In such instances, alternative identifiers like dates, names, height or other attributes are used in a specified order of preference.</p>
</div>
<div id="uses" class="section level1">
<h1 class="hasAnchor">
<a href="#uses" class="anchor"></a>Uses</h1>
<p>Arguments in <code><a href="../reference/record_group.html">record_group()</a></code> control separate aspects of the linkage process. Different combinations of each argument can be used to link datasets in a variety of ways. Examples of these include;</p>
<ul>
<li>Linking datasets on one (or more) matching <code>criteria</code>
</li>
<li>Linking datasets on one (or more) matching <code>criteria</code> and one (or more) matching <code>sub_criteria</code>. See <a href="#record_matching">record matching</a>
</li>
<li>Linking datasets in stages. Each stage is considered more certain than the subsequent one. See <a href="#record_expansion">record group expansion</a>
</li>
<li>Linking datastes with missing group identifiers. See <a href="#missing_values">handling missing values</a>
</li>
</ul>
</div>
<div id="implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h1>
<p>Record linkage is done in stages. Each stage is considered more certain than the subsequent one i.e. a match at stage 1 is considered more certain than one at stage 2.</p>
<p>Records are assigned a unique group ID if they match on a <code>criteria</code>. This is provided as a <code>vector</code> of column names for the attributes to be compared. This argument takes advanatge of <code>dplyr</code> quasiquotation.</p>
<p>One or more <code>sub_criteria</code> can be used at each stage to include additional conditions for a match. This is provided as a <code>list</code> of named <code>vectors</code> of column names. If used, records will only be assigned a group ID when they match on the <code>criteria</code>, and at least one named column in each <code>sub_criteria</code>.</p>
<p>Each <code>sub_criteria</code> should be paired with a corresponding <code>criteria</code>. To do this, the vector name for each <code>sub_criteria</code> should be prefixed with <code>"s"</code> and the corresponding <code>criteria</code> number eg. <code>"s1"</code> or <code>"s4"</code>. When a <code>criteria</code> has more than one <code>sub_criteria</code>, include a suffix after the <code>criteria</code> number eg. <code>"s1a"</code>, <code>"s1b"</code>, <code>"s1c"</code> or <code>"s2a"</code>. <a href="#sub_cri_example">See examples</a>. Any <code>sub_criteria</code> not paired to <code>criteria</code> will be ignored. <code>sub_criteria</code> argument does not support quasiquotation.</p>
<p>At each stage, the function prints the number of records that have been assigned a group ID and how many groups have only one record.</p>
<p>Below are two implementation of a single stage record linkage. One is based on matching forename, and the other is based on forename and surname.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(diyar)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)

patient_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rd_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,
  <span class="dt">forename =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"James"</span>,<span class="st">"ESTHER"</span>,<span class="st">""</span>, <span class="st">"Jamey"</span>, <span class="st">"Daniel"</span>, <span class="st">"Henry"</span>), 
  <span class="dt">surname =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Green"</span>,<span class="st">"Kulmar"</span>,<span class="st">"OBI"</span>, <span class="st">"Green"</span>, <span class="st">"Kulmar"</span>,<span class="st">"OBI"</span>), 
  <span class="dt">sex =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"M"</span>,<span class="st">"F"</span>,<span class="st">"F"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>), 
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>  
  )

<span class="co"># Matching forename only</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list, rd_id, forename)
  )
<span class="co">#&gt; Warning: `lang()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; Please use `call2()` instead.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; Warning: `new_overscope()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; Please use `new_data_mask()` instead.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; Warning: `overscope_eval_next()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; Please use `eval_tidy()` with a data mask instead.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; Warning: `is_lang()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; Please use `is_call()` instead.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; Warning: `mut_node_car()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; Warning: The `printer` argument is deprecated as of rlang 0.3.0.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; Warning: `lang_modify()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; Please use `call_modify()` instead.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `forename`</span>
<span class="co">#&gt; Warning: `chr_along()` is deprecated as of rlang 0.2.0.</span>
<span class="co">#&gt; This warning is displayed once per session.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 5 of 6 record(s) have been assigned a group ID. 1 records not yet grouped.</span>
<span class="co">#&gt; 5 record(s) with unique IDs untagged for possible matching in the next stage. The number of records not yet grouped is now 6.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Record grouping complete - 6 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex sn pid pid_cri</span>
<span class="co">#&gt; 1     1    James   Green   M  1   1    None</span>
<span class="co">#&gt; 2     2   ESTHER  Kulmar   F  2   2    None</span>
<span class="co">#&gt; 3     3              OBI   F  3   3    None</span>
<span class="co">#&gt; 4     4    Jamey   Green   M  4   4    None</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M  5   5    None</span>
<span class="co">#&gt; 6     6    Henry     OBI   M  6   6    None</span>

<span class="co"># Matching forename and surname</span>
patient_list &lt;-<span class="st"> </span><span class="kw">mutate</span>(patient_list, <span class="dt">cri_1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(forename, surname,<span class="dt">sep=</span><span class="st">"-"</span>) )

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list, rd_id, cri_<span class="dv">1</span>, <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Record grouping complete - 6 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex         cri_1 sn pid pid_cri</span>
<span class="co">#&gt; 1     1    James   Green   M   James-Green  1   1    None</span>
<span class="co">#&gt; 2     2   ESTHER  Kulmar   F ESTHER-Kulmar  2   2    None</span>
<span class="co">#&gt; 3     3              OBI   F          -OBI  3   3    None</span>
<span class="co">#&gt; 4     4    Jamey   Green   M   Jamey-Green  4   4    None</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M Daniel-Kulmar  5   5    None</span>
<span class="co">#&gt; 6     6    Henry     OBI   M     Henry-OBI  6   6    None</span>

<span class="co"># Note that matching is case sensitive</span></code></pre></div>
<p><a id="record_matching"></a></p>
<div id="record-matching" class="section level2">
<h2 class="hasAnchor">
<a href="#record-matching" class="anchor"></a>Record matching</h2>
<p>The choice and ordering of <code>criteria</code> and <code>sub_criteria</code> directly impacts the linkage. Before using this function, review the dataset and decide which combinations of <code>criteria</code> and <code>sub_criteria</code> would be appropriate. <code><a href="../reference/record_group.html">record_group()</a></code> can use any combination availabe from the dataset however, you should consider a practical combination which would yield more true positive matches than false positive matches.</p>
<p>For example, in <code>patient_list</code> above, linking on forenames only, or forenames and surnames does not yield any match. However, linking in two stages - forname followed by surname (see <a href="#record_expansion">Record group expansion</a>), will pair records 1 and 4, 2 and 5, 3 and 6.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, surname), <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Record grouping complete - 0 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex         cri_1 sn pid    pid_cri</span>
<span class="co">#&gt; 1     1    James   Green   M   James-Green  1   1 Criteria 2</span>
<span class="co">#&gt; 2     2   ESTHER  Kulmar   F ESTHER-Kulmar  2   2 Criteria 2</span>
<span class="co">#&gt; 3     3              OBI   F          -OBI  3   3 Criteria 2</span>
<span class="co">#&gt; 4     4    Jamey   Green   M   Jamey-Green  4   1 Criteria 2</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M Daniel-Kulmar  5   2 Criteria 2</span>
<span class="co">#&gt; 6     6    Henry     OBI   M     Henry-OBI  6   3 Criteria 2</span></code></pre></div>
<p>Although this result of this linkage is logically correct, a two stage linkage on forenames followed by surnames is not the most practical option given the dataset. For instance, records 3 and 6 could be cousins and not the same individual. Therefore, a better combination could be forename at stage 1, followed by surname and sex at stage 2. See below;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_list &lt;-<span class="st"> </span><span class="kw">mutate</span>(patient_list, <span class="dt">cri_2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(surname, sex,<span class="dt">sep=</span><span class="st">"-"</span>) )

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, cri_<span class="dv">2</span>), <span class="dt">display =</span> <span class="ot">FALSE</span>)
  )
<span class="co">#&gt; Record grouping complete - 4 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex         cri_1    cri_2 sn pid    pid_cri</span>
<span class="co">#&gt; 1     1    James   Green   M   James-Green  Green-M  1   1 Criteria 2</span>
<span class="co">#&gt; 2     2   ESTHER  Kulmar   F ESTHER-Kulmar Kulmar-F  2   2       None</span>
<span class="co">#&gt; 3     3              OBI   F          -OBI    OBI-F  3   3       None</span>
<span class="co">#&gt; 4     4    Jamey   Green   M   Jamey-Green  Green-M  4   1 Criteria 2</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M Daniel-Kulmar Kulmar-M  5   5       None</span>
<span class="co">#&gt; 6     6    Henry     OBI   M     Henry-OBI    OBI-M  6   6       None</span></code></pre></div>
<p>As mentioned earlier, at each stage of record linkage, a <code>sub_criteria</code> can be used to include additional conditions for a match. Just like <code>criteria</code>, any column in the dataset can be used as a <code>sub_criteria</code>. However, you should consider using a practical combination for the given dataset.</p>
<p><a id="sub_cri_example"></a></p>
<p>Below are examples of record linkage using different combinations of the same <code>criteria</code> and <code>sub_criteria</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)

staff_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rd_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,
  <span class="dt">name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"John Smith"</span>,<span class="dv">8</span>), 
  <span class="dt">department =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Procurement"</span>,<span class="st">"Security"</span>,<span class="st">"Security"</span>,<span class="st">"Publishing"</span>,
                 <span class="st">"Publishing"</span>,<span class="st">"Publishing"</span>,<span class="st">"Publishing"</span>,<span class="st">"Procurement"</span>), 
  <span class="dt">hair_colour =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Brown"</span>,<span class="st">"Brown"</span>,<span class="st">"Brown"</span>, <span class="st">"Green"</span>, 
                  <span class="st">"Teal"</span>,<span class="st">"Grey"</span>,<span class="st">"White"</span>,<span class="st">"Black"</span>),
  <span class="dt">date_of_birth =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"23/03/1986"</span>, <span class="st">"23/03/1986"</span>, <span class="st">"23/03/1968"</span>, <span class="st">"01/02/1985"</span>,
                    <span class="st">"02/01/1985"</span>, <span class="st">"11/03/1964"</span>,<span class="st">"11/03/1964"</span>, <span class="st">"11/10/1985"</span>),
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>  
)

staff_list &lt;-<span class="st"> </span><span class="kw">separate</span>(staff_list, date_of_birth, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"d"</span>, <span class="st">"m"</span>, <span class="st">"y"</span>),  <span class="dt">sep=</span><span class="st">"/"</span>, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">db_pt1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(d,m,<span class="dt">sep=</span><span class="st">"/"</span>),
    <span class="dt">db_pt2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(d,y,<span class="dt">sep=</span><span class="st">"/"</span>),
    <span class="dt">db_pt3 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(m,y,<span class="dt">sep=</span><span class="st">"/"</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(d,m,y))

<span class="co"># 1 stage linkage</span>
  <span class="co"># stage 1 - name, and either department, hair colour or date of birth</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  staff_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(staff_list, rd_id, name, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"s1a"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"department"</span>,<span class="st">"hair_colour"</span>,<span class="st">"date_of_birth"</span>)),  <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"db_"</span>))
<span class="co">#&gt; Record grouping complete - 0 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id       name  department hair_colour date_of_birth sn pid    pid_cri</span>
<span class="co">#&gt; 1     1 John Smith Procurement       Brown    23/03/1986  1   1 Criteria 1</span>
<span class="co">#&gt; 2     2 John Smith    Security       Brown    23/03/1986  2   1 Criteria 1</span>
<span class="co">#&gt; 3     3 John Smith    Security       Brown    23/03/1968  3   1 Criteria 1</span>
<span class="co">#&gt; 4     4 John Smith  Publishing       Green    01/02/1985  4   4 Criteria 1</span>
<span class="co">#&gt; 5     5 John Smith  Publishing        Teal    02/01/1985  5   4 Criteria 1</span>
<span class="co">#&gt; 6     6 John Smith  Publishing        Grey    11/03/1964  6   4 Criteria 1</span>
<span class="co">#&gt; 7     7 John Smith  Publishing       White    11/03/1964  7   4 Criteria 1</span>
<span class="co">#&gt; 8     8 John Smith Procurement       Black    11/10/1985  8   1 Criteria 1</span>
  

<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name, and either department or hair color, and date of birth </span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  staff_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(staff_list, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(name), 
               <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"s1a"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"department"</span>,<span class="st">"hair_colour"</span>), 
                    <span class="st">"s1b"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date_of_birth"</span>)),  <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"db_"</span>))
<span class="co">#&gt; Record grouping complete - 4 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id       name  department hair_colour date_of_birth sn pid    pid_cri</span>
<span class="co">#&gt; 1     1 John Smith Procurement       Brown    23/03/1986  1   1 Criteria 1</span>
<span class="co">#&gt; 2     2 John Smith    Security       Brown    23/03/1986  2   1 Criteria 1</span>
<span class="co">#&gt; 3     3 John Smith    Security       Brown    23/03/1968  3   3       None</span>
<span class="co">#&gt; 4     4 John Smith  Publishing       Green    01/02/1985  4   4       None</span>
<span class="co">#&gt; 5     5 John Smith  Publishing        Teal    02/01/1985  5   5       None</span>
<span class="co">#&gt; 6     6 John Smith  Publishing        Grey    11/03/1964  6   6 Criteria 1</span>
<span class="co">#&gt; 7     7 John Smith  Publishing       White    11/03/1964  7   6 Criteria 1</span>
<span class="co">#&gt; 8     8 John Smith Procurement       Black    11/10/1985  8   8       None</span>

<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name, and either department or hair color, and either day and month of birth, day and year of birth or month and year of birth date of birth</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  staff_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(staff_list, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(name), 
               <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"s1a"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"department"</span>,<span class="st">"hair_colour"</span>), 
                    <span class="st">"s1b"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"db_pt1"</span>,<span class="st">"db_pt2"</span>,<span class="st">"db_pt3"</span>)),  <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"db_"</span>))
<span class="co">#&gt; Record grouping complete - 3 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id       name  department hair_colour date_of_birth sn pid    pid_cri</span>
<span class="co">#&gt; 1     1 John Smith Procurement       Brown    23/03/1986  1   1 Criteria 1</span>
<span class="co">#&gt; 2     2 John Smith    Security       Brown    23/03/1986  2   1 Criteria 1</span>
<span class="co">#&gt; 3     3 John Smith    Security       Brown    23/03/1968  3   1 Criteria 1</span>
<span class="co">#&gt; 4     4 John Smith  Publishing       Green    01/02/1985  4   4       None</span>
<span class="co">#&gt; 5     5 John Smith  Publishing        Teal    02/01/1985  5   5       None</span>
<span class="co">#&gt; 6     6 John Smith  Publishing        Grey    11/03/1964  6   6 Criteria 1</span>
<span class="co">#&gt; 7     7 John Smith  Publishing       White    11/03/1964  7   6 Criteria 1</span>
<span class="co">#&gt; 8     8 John Smith Procurement       Black    11/10/1985  8   8       None</span>


<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name, and either department, and hair color, and either day and month of birth, day and year of birth or month and year of birth date of birth </span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  staff_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(staff_list, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(name), 
               <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"s1a"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"department"</span>),
                    <span class="st">"s1c"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hair_colour"</span>),
                    <span class="st">"s1b"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"db_pt1"</span>,<span class="st">"db_pt2"</span>,<span class="st">"db_pt3"</span>)),  <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"db_"</span>))
<span class="co">#&gt; Record grouping complete - 6 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id       name  department hair_colour date_of_birth sn pid    pid_cri</span>
<span class="co">#&gt; 1     1 John Smith Procurement       Brown    23/03/1986  1   1       None</span>
<span class="co">#&gt; 2     2 John Smith    Security       Brown    23/03/1986  2   2 Criteria 1</span>
<span class="co">#&gt; 3     3 John Smith    Security       Brown    23/03/1968  3   2 Criteria 1</span>
<span class="co">#&gt; 4     4 John Smith  Publishing       Green    01/02/1985  4   4       None</span>
<span class="co">#&gt; 5     5 John Smith  Publishing        Teal    02/01/1985  5   5       None</span>
<span class="co">#&gt; 6     6 John Smith  Publishing        Grey    11/03/1964  6   6       None</span>
<span class="co">#&gt; 7     7 John Smith  Publishing       White    11/03/1964  7   7       None</span>
<span class="co">#&gt; 8     8 John Smith Procurement       Black    11/10/1985  8   8       None</span></code></pre></div>
<p>Note that using <code>sub_criteria</code> costs additional processing time, so it should be avoided when unnecessary. For example, the two implementations of linkage below will yield the same result but the second method will take less time. This time difference becomes more noticeable with very large datasets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name, and date of birth, and department and hair color </span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  staff_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(staff_list, rd_id, name, 
               <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"s1a"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"department"</span>),
                    <span class="st">"s1b"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hair_colour"</span>),
                    <span class="st">"s1c"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date_of_birth"</span>)),  <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"db_"</span>))
<span class="co">#&gt; Record grouping complete - 8 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id       name  department hair_colour date_of_birth sn pid pid_cri</span>
<span class="co">#&gt; 1     1 John Smith Procurement       Brown    23/03/1986  1   1    None</span>
<span class="co">#&gt; 2     2 John Smith    Security       Brown    23/03/1986  2   2    None</span>
<span class="co">#&gt; 3     3 John Smith    Security       Brown    23/03/1968  3   3    None</span>
<span class="co">#&gt; 4     4 John Smith  Publishing       Green    01/02/1985  4   4    None</span>
<span class="co">#&gt; 5     5 John Smith  Publishing        Teal    02/01/1985  5   5    None</span>
<span class="co">#&gt; 6     6 John Smith  Publishing        Grey    11/03/1964  6   6    None</span>
<span class="co">#&gt; 7     7 John Smith  Publishing       White    11/03/1964  7   7    None</span>
<span class="co">#&gt; 8     8 John Smith Procurement       Black    11/10/1985  8   8    None</span>


<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name, and date of birth, and department and hair color</span>
staff_list_b &lt;-<span class="st"> </span><span class="kw">unite</span>(staff_list, cri, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(name, date_of_birth, department, hair_colour))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  staff_list_b,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(staff_list_b, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(cri),  <span class="dt">display =</span> <span class="ot">FALSE</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"db_"</span>))
<span class="co">#&gt; Record grouping complete - 8 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id                                     cri sn pid pid_cri</span>
<span class="co">#&gt; 1     1 John Smith_23/03/1986_Procurement_Brown  1   1    None</span>
<span class="co">#&gt; 2     2    John Smith_23/03/1986_Security_Brown  2   2    None</span>
<span class="co">#&gt; 3     3    John Smith_23/03/1968_Security_Brown  3   3    None</span>
<span class="co">#&gt; 4     4  John Smith_01/02/1985_Publishing_Green  4   4    None</span>
<span class="co">#&gt; 5     5   John Smith_02/01/1985_Publishing_Teal  5   5    None</span>
<span class="co">#&gt; 6     6   John Smith_11/03/1964_Publishing_Grey  6   6    None</span>
<span class="co">#&gt; 7     7  John Smith_11/03/1964_Publishing_White  7   7    None</span>
<span class="co">#&gt; 8     8 John Smith_11/10/1985_Procurement_Black  8   8    None</span></code></pre></div>
<p><a id="record_expansion"></a></p>
</div>
<div id="record-group-expansion" class="section level2">
<h2 class="hasAnchor">
<a href="#record-group-expansion" class="anchor"></a>Record group expansion</h2>
<p>At each stage of record linkage, records are either assigned a new group ID or inherit an existing one. The following scenerio explains how these happen;</p>
<ul>
<li>If a record only matches others that have not yet been assigned a group ID, it and the others will then be assigned a new group ID</li>
<li>If a record matches others which already have a group ID, the record will inherit the existing group ID. Note that if it matches records multiple existing group IDs, the ID assigned at the earliest stage is the one inherited</li>
<li>If a record does not match any record, it will not be assigned a group ID. If by the last stage, it still has not matched any other record, it is assigned a new group ID</li>
</ul>
<p>It’s worth reiterating that <code><a href="../reference/record_group.html">record_group()</a></code> expects the <code>criteria</code> to be listed in order of decreasing certainty. Therefore, existing group IDs can be inherited but will not be overwritten. This is because groups formed at earlier stages are considered more “certain” than those formed at subsequent stages.</p>
<p>The example below with <code>patient_list</code> demonstrates this behaviour.</p>
<ul>
<li>Stage 1 - Only records 3 and 4 are grouped together and therefore assigned a new group ID (<code>3</code>). Records 1 and 2 are excluded from grouping at this stage because of <a href="#missing_values">missing values</a>. Record 5 is not assigned a group ID because it doesn’t match any other record.</li>
<li>Stage 2 - Records 1 and 2 are grouped together based on matching surnames and assigned a unique ID (<code>1</code>). Records 3 and 4 do not match on surnames but remain grouped together since they match on forenames which is more “certain” as listed in <code>criteria</code>. Record 5 is still not assigned a group ID because it doesn’t match any other record on surnames.</li>
<li>Stage 3 - Record 5 matches record 1 and 3 which belong to different group IDs. However, it will inherit record 3’s group ID (<code>3</code>) because that was assigned at stage 1 (<code>"Criteria 1"</code>) as opposed to record 2’s group ID which was assigned at stage 2 (<code>"Criteria 2"</code>).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rd_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,
  <span class="dt">forename =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">""</span>,<span class="st">""</span>,<span class="st">"Tomi"</span>,<span class="st">"Tomi"</span>,<span class="st">"Obi"</span>),
  <span class="dt">surname =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Jefferson"</span>,<span class="st">"Jefferson"</span>,<span class="st">"Abdul"</span>,<span class="st">"Abdulkareem"</span>,<span class="st">"Nelson"</span>),
  <span class="dt">sex =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Male"</span>,<span class="st">"Female"</span>,<span class="st">"Male"</span>,<span class="st">"Female"</span>,<span class="st">"Male"</span>),
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, surname, sex))
)
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `forename`</span>
<span class="co">#&gt; 3 of 5 record(s) have been assigned a group ID. 2 records not yet grouped.</span>
<span class="co">#&gt; 1 record(s) with unique IDs untagged for possible matching in the next stage. The number of records not yet grouped is now 3.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 2 - `surname`</span>
<span class="co">#&gt; 3 of 3 record(s) have been assigned a group ID. 0 records not yet grouped.</span>
<span class="co">#&gt; 1 record(s) with unique IDs untagged for possible matching in the next stage. The number of records not yet grouped is now 1.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 3 - `sex`</span>
<span class="co">#&gt; 1 of 1 record(s) have been assigned a group ID. 0 records not yet grouped.</span>
<span class="co">#&gt; 0 record(s) with unique IDs untagged for possible matching in the next stage. The number of records not yet grouped is now 0.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Record grouping complete - 0 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename     surname    sex sn pid    pid_cri</span>
<span class="co">#&gt; 1     1            Jefferson   Male  1   1 Criteria 2</span>
<span class="co">#&gt; 2     2            Jefferson Female  2   1 Criteria 2</span>
<span class="co">#&gt; 3     3     Tomi       Abdul   Male  3   3 Criteria 1</span>
<span class="co">#&gt; 4     4     Tomi Abdulkareem Female  4   3 Criteria 1</span>
<span class="co">#&gt; 5     5      Obi      Nelson   Male  5   3 Criteria 3</span></code></pre></div>
<p><a id="missing_values"></a></p>
</div>
<div id="handling-missing-values" class="section level2">
<h2 class="hasAnchor">
<a href="#handling-missing-values" class="anchor"></a>Handling missing values</h2>
<p>Records with missing values for a particular <code>criteria</code> are excluded from that stage of record linkage. If a record has missing values for every listed <code>criteria</code>, it’s assigned a unique group ID at the end of record linkage.</p>
<p>It’s common for databases to use specific characters or numbers to represent missing or unknown data e.g. <code>N/A</code>, <code>Nil</code>, <code>01/01/1100</code>, <code>111111</code> etc. These pseudo-missing values will need to be recoded to one of the two recognised by <code><a href="../reference/record_group.html">record_group()</a></code> - <code>NA</code> or an empty string (<code>""</code>). If this is not done, the function will assume the pseudo-misssing values are valid values and therefore group them together. This can cause a continuous cascade of false matches as seen below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_list_b &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(
  <span class="dt">rd_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,
  <span class="dt">forename =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Nil"</span>,<span class="st">"Nil"</span>,<span class="st">"Nil"</span>, <span class="st">"Jamey"</span>, <span class="st">"Daniel"</span>, <span class="st">"Henry"</span>), 
  <span class="dt">surname =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Green"</span>,<span class="st">"Kulmar"</span>,<span class="st">"OBI"</span>, <span class="st">"Green"</span>, <span class="st">"Kulmar"</span>,<span class="st">"OBI"</span>), 
  <span class="dt">sex =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"M"</span>,<span class="st">"F"</span>,<span class="st">"F"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>), 
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>  
)

<span class="co"># 2 stage linkage</span>
    <span class="co"># Stage 1 - Forname</span>
    <span class="co"># Stage 2 - Surname</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list_b,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list_b, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, surname), <span class="dt">display =</span> <span class="ot">FALSE</span>)
)
<span class="co">#&gt; Record grouping complete - 0 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex sn pid    pid_cri</span>
<span class="co">#&gt; 1     1      Nil   Green   M  1   1 Criteria 1</span>
<span class="co">#&gt; 2     2      Nil  Kulmar   F  2   1 Criteria 1</span>
<span class="co">#&gt; 3     3      Nil     OBI   F  3   1 Criteria 1</span>
<span class="co">#&gt; 4     4    Jamey   Green   M  4   1 Criteria 2</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M  5   1 Criteria 2</span>
<span class="co">#&gt; 6     6    Henry     OBI   M  6   1 Criteria 2</span>

<span class="co"># 2 stage linkage</span>
    <span class="co"># Stage 1 - Forname</span>
    <span class="co"># Stage 2 - Surname and sex</span>
patient_list_b &lt;-<span class="st"> </span><span class="kw">mutate</span>(patient_list_b, <span class="dt">cri_2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(surname,sex,<span class="dt">sep=</span><span class="st">""</span>))

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list_b,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list_b, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, cri_<span class="dv">2</span>), <span class="dt">display =</span> <span class="ot">FALSE</span>)
)
<span class="co">#&gt; Record grouping complete - 2 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex   cri_2 sn pid    pid_cri</span>
<span class="co">#&gt; 1     1      Nil   Green   M  GreenM  1   1 Criteria 1</span>
<span class="co">#&gt; 2     2      Nil  Kulmar   F KulmarF  2   1 Criteria 1</span>
<span class="co">#&gt; 3     3      Nil     OBI   F    OBIF  3   1 Criteria 1</span>
<span class="co">#&gt; 4     4    Jamey   Green   M  GreenM  4   1 Criteria 2</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M KulmarM  5   5       None</span>
<span class="co">#&gt; 6     6    Henry     OBI   M    OBIM  6   6       None</span></code></pre></div>
<p>In the example above, records 1-3 are assigned a single group ID based on matching fornames (<code>"Nil"</code>). Then records 4-6 are assigned the same group ID because they having matching surnames with either records 1-3. Even when stage 2 is changed to matching surnames and sex, records 2 and 3 are still “incorrectly” grouped together. Although, this is likley not the desired outcome, it’s the expected result given the parameters supplied to the function. This isssue can be addressed by recoding <code>"Nil"</code> to <code>NA</code> or <code>""</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using NA as the proxy for missing value</span>
patient_list_b &lt;-<span class="st"> </span><span class="kw">mutate</span>(patient_list_b,<span class="dt">forename =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(forename<span class="op">==</span><span class="st">"Nil"</span>,<span class="ot">NA</span>,forename))

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list_b,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list_b, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, surname), <span class="dt">display =</span> <span class="ot">FALSE</span>)
)
<span class="co">#&gt; Record grouping complete - 0 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex   cri_2 sn pid    pid_cri</span>
<span class="co">#&gt; 1     1     &lt;NA&gt;   Green   M  GreenM  1   1 Criteria 2</span>
<span class="co">#&gt; 2     2     &lt;NA&gt;  Kulmar   F KulmarF  2   2 Criteria 2</span>
<span class="co">#&gt; 3     3     &lt;NA&gt;     OBI   F    OBIF  3   3 Criteria 2</span>
<span class="co">#&gt; 4     4    Jamey   Green   M  GreenM  4   1 Criteria 2</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M KulmarM  5   2 Criteria 2</span>
<span class="co">#&gt; 6     6    Henry     OBI   M    OBIM  6   3 Criteria 2</span>

<span class="co"># Using "" as the proxy for missing value</span>
patient_list_b &lt;-<span class="st"> </span><span class="kw">mutate</span>(patient_list_b,<span class="dt">forename =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(forename),<span class="st">""</span>,forename))  

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(
  patient_list_b,
  <span class="kw"><a href="../reference/record_group.html">record_group</a></span>(patient_list_b, rd_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(forename, surname), <span class="dt">display =</span> <span class="ot">FALSE</span>)
)
<span class="co">#&gt; Record grouping complete - 0 record(s) assigned a unique ID.</span>
<span class="co">#&gt;  ---------------------------------------------------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   rd_id forename surname sex   cri_2 sn pid    pid_cri</span>
<span class="co">#&gt; 1     1            Green   M  GreenM  1   1 Criteria 2</span>
<span class="co">#&gt; 2     2           Kulmar   F KulmarF  2   2 Criteria 2</span>
<span class="co">#&gt; 3     3              OBI   F    OBIF  3   3 Criteria 2</span>
<span class="co">#&gt; 4     4    Jamey   Green   M  GreenM  4   1 Criteria 2</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M KulmarM  5   2 Criteria 2</span>
<span class="co">#&gt; 6     6    Henry     OBI   M    OBIM  6   3 Criteria 2</span></code></pre></div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>As a rule of thumb, the more unique a criteria, the earlier it shouldbe listed in <code>criteria</code>. Also, the set and ordering of <code>criteria</code> is a personal choice but should also be practical given the dataset. For example, when linking a vehicular database with no existing identifier, vehicle color alone is less practical than color and brand name, which in turn is less practical than color, brand name, make and model. However colour, brand name, make and model and 10 other parameters might be too strict and would need to be relaxed. On the other hand, the dataset could be so small that vehicle color alone is sufficient as a <code>criteria</code>. <code><a href="../reference/record_group.html">record_group()</a></code> aims to minimize false mismatches due to random data error or missing values however, the choice and ordering of <code>criteria</code> and <code>sub_criteria</code> should balance the availability of alternative identifiers with their practicality as group identifiers.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#uses">Uses</a></li>
      <li>
<a href="#implementation">Implementation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#record-matching">Record matching</a></li>
      <li><a href="#record-group-expansion">Record group expansion</a></li>
      <li><a href="#handling-missing-values">Handling missing values</a></li>
      </ul>
</li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Olisa Nsonwu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
