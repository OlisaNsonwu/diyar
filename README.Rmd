---
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# diyar
[![CRAN version](http://www.r-pkg.org/badges/version/diyar)](https://cran.r-project.org/package=diyar)
[![CRAN RStudio mirror downloads](http://cranlogs.r-pkg.org/badges/diyar)](http://www.r-pkg.org/pkg/diyar)
[![Coverage status](https://codecov.io/gh/OlisaNsonwu/diyar/branch/master/graph/badge.svg)](https://codecov.io/github/OlisaNsonwu/diyar?branch=master)
<!-- [![Travis build status](https://travis-ci.org/OlisaNsonwu/diyar.svg?branch=master)](https://travis-ci.org/OlisaNsonwu/diyar) -->

## Overview
Record linkage and deduplication of individual-level data, such as repeated spells in hospital, or recurrent cases of infection is a common task in epidemiological analysis and other fields of research. 

The `diyar` package aims to provide a simple and flexible implementation of multistage deterministic record linkage and episode grouping.

## Installation
```{r eval=FALSE}
# Install the latest CRAN release 
install.packages("diyar")

# Or, install the development version from GitHub
install.packages("devtools")
devtools::install_github("OlisaNsonwu/diyar")
```

## Cheat sheet
<a href="https://github.com/OlisaNsonwu/diyar/blob/master/cheatsheet/diyar.pdf"><img src="https://github.com/OlisaNsonwu/diyar/blob/master/cheatsheet/thumbnail.png?raw=true"/></a>

## Usage
There are two main aspects of the `diyar` package; multistage data linkage grouping (`links()`) and episode tracking (`episodes()`). `number_line` objects are used in both.

+ `number_line()` - creates a range of real numbers on a number line. 
    + They can be manipulated - `reverse_number_line`, `shift_number_line`, `expand_number_line`, `number_line_sequence`, `invert_number_line`, `compress_number_line`, `union_number_lines`, `subtract_number_lines`, `intersect_number_lines`.
    +  Logical tests for overlap - `overlaps`, `overlap`, `exact`, `reverse`, `chain`, `across`, `aligns_start`, `aligns_end`, `inbetween`.
    
```{r number_line, message=FALSE, warning=FALSE}
library(diyar)

l <- as.Date("01/04/2019", "%d/%m/%Y"); r <- as.Date("30/04/2019", "%d/%m/%Y")
nl <- number_line(l, r)
nl
reverse_number_line(nl)
expand_number_line(nl, -2)
```

+ `episodes()` - tracks temporal episodes.

```{r}
data(infections);
db <- infections[c("date")]
# Dates
db$date

# Fixed episodes
episodes(date = db$date, 
         case_length = 15, 
         display = "none", 
         group_stats = TRUE)

# Rolling episodes
episodes(date = db$date, 
         case_length = 15, 
         recurrence_length = 40, 
         display = "none",
         episode_type = "rolling", 
         group_stats = TRUE)
```

+ `links()` - multistage deterministic linkage with missing data.

```{r}
# Two-stage exact matches
data(staff_records);

staff_records$pids_a <- links(criteria = list(staff_records$forename, 
                                              staff_records$surname),
                              data_source = staff_records$sex, 
                              display = "none")
staff_records

# Single-stage user-defined logical tests
# Matching `sex` and + 20-year age gaps
age <- c(30, 28, 40, 25, 25, 29, 27)
sex <- c("M", "M", "M", "F", "M", "M", "F")
f1 <- function(x, y) (y - x) %in% 0:20
links(criteria = sex,
      sub_criteria = list(cr1 = sub_criteria(age, funcs = f1)),
      display = "none")

# + 20-year age gaps only
links(criteria = "place_holder",
      sub_criteria = list(cr1 = sub_criteria(age, funcs = f1)),
      display = "none")
```

Find out more [here!](https://olisansonwu.github.io/diyar/index.html)

## Bugs and issues
Please report any bug or issues with using this package [here](https://github.com/OlisaNsonwu/diyar/issues).
