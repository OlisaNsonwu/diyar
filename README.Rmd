---
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# diyar
[![CRAN version](http://www.r-pkg.org/badges/version/diyar)](https://cran.r-project.org/package=diyar)
[![CRAN RStudio mirror downloads](https://cranlogs.r-pkg.org/badges/diyar)](https://www.r-pkg.org/pkg/diyar)
[![Coverage status](https://codecov.io/gh/OlisaNsonwu/diyar/branch/master/graph/badge.svg)](https://codecov.io/github/OlisaNsonwu/diyar?branch=master)
<!-- [![Travis build status](https://travis-ci.org/OlisaNsonwu/diyar.svg?branch=master)](https://travis-ci.org/OlisaNsonwu/diyar) -->

## Overview
Record linkage and distinguishing between index, duplicate and recurrent events are common tasks in epidemiological analyses and other fields of research, particularly as part of a case definition. Implementing these in `R` can be complex and challenging. The `diyar` package provides a convenient and flexible way of doing these in `R`.

## Installation
```{r eval = FALSE}
# Install the latest CRAN release 
install.packages("diyar")

# Or, install the development version from GitHub
install.packages("devtools")
devtools::install_github("OlisaNsonwu/diyar")
```

<!-- ## Usage -->

<!-- <img src = "fig_r1_light.png" width = "1000" height="580"> -->

### Number line
Use `number_line()` to create `number_line` objects - a range of numeric values. These can be split or manipulated in several ways. 

```{r message = FALSE, warning = FALSE}
library(diyar)
nl <- number_line(1, 10); nl
invert_number_line(nl)
seq(nl, length.out = 3)
```

`overlap()` and related functions test how `number_line` objects overlap.
```{r message = FALSE, warning = FALSE}
overlap_method(nl, nl); exact(nl, nl)
nl2 <- number_line(10, 15); nl2
overlap_method(nl, nl2); exact(nl, nl2)
```  
Set operations such as `union_number_lines()` are also possible for pairs of `number_line` objects. 
```{r message = FALSE, warning = FALSE}
nl3 <- number_line(1, 20)
nl4 <- number_line(3, 6)
nl3; nl4
overlap_method(nl3, nl4)
intersect_number_lines(nl3, nl4)
subtract_number_lines(nl3, nl4)
```  
### Record linkage
Use `links()` to create a unique identifier for matching records based on a multistage deterministic approach to record linkage.
```{r message = FALSE, warning = FALSE}
attr_1 <- c(1, 1, 1, NA, NA, NA, NA, NA)
attr_2 <- c(NA, NA, 2, 2, 2, NA, NA, NA)
links(list(attr_1, attr_2))
```  
Use `link_records()` to implement both deterministic and probabilistic record linkage by comparing every possible record-pair. 
```{r message = FALSE, warning = FALSE}
data(missing_staff_id)
dfr <- missing_staff_id[c("staff_id",  "initials", "hair_colour", "branch_office")]
p1 <- link_records(as.list(dfr), score_threshold = -4.2)
p1$pid
subset(p1$pid_weights, record.match)
```
`links_wf_probabilistic()` is a wrapper function of `links()` and an alternative to `link_records()`. It's less memory intensive but can be slower in comparison.
```{r message = FALSE, warning = FALSE}
p2 <- links_wf_probabilistic(as.list(dfr), score_threshold = -4.2, recursive = TRUE)
p2$pid
subset(p2$pid_weights, record.match)
``` 

### Case definitions
Use `episodes()` to create a unique identifier for related events based on a case definition.
```{r message = FALSE, warning = FALSE}
dates <- seq(as.Date("2020-01-01"), as.Date("2020-01-07"), by = 1)
episodes(dates, case_length = 2, group_stats = TRUE)
episodes(dates, case_length = 2, episode_type = "rolling", group_stats = TRUE)
``` 

Use `partitions()` to create a unique identifier for events within the same period or numerical interval.
```{r message = FALSE, warning = FALSE}
partitions(dates, by = 2, separate = TRUE, group_stats = TRUE)
partitions(dates, length.out = 3, separate = TRUE, group_stats = TRUE)
``` 

Find out more [here!](https://olisansonwu.github.io/diyar/articles/overview.html)

## Bugs and issues
Please report any bug or issues with using this package [here](https://github.com/OlisaNsonwu/diyar/issues).
