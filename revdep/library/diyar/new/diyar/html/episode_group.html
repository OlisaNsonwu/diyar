<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Episode grouping for record deduplication and case assignment</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for episode_group {diyar}"><tr><td>episode_group {diyar}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Episode grouping for record deduplication and case assignment</h2>

<h3>Description</h3>

<p>Group records into chronological episodes
</p>


<h3>Usage</h3>

<pre>
episode_group(df, sn = NULL, strata = NULL, date, case_length,
  episode_type = "fixed", episode_unit = "days", episodes_max = Inf,
  recurrence_length = NULL, rolls_max = Inf, data_source = NULL,
  custom_sort = NULL, from_last = FALSE, overlap_method = c("across",
  "inbetween", "aligns_start", "aligns_end", "chain"),
  bi_direction = FALSE, group_stats = FALSE, display = TRUE,
  deduplicate = FALSE, to_s4 = FALSE)

fixed_episodes(date, sn = NULL, strata = NULL, case_length,
  episode_unit = "days", episodes_max = Inf, data_source = NULL,
  custom_sort = NULL, from_last = FALSE, overlap_method = c("across",
  "inbetween", "aligns_start", "aligns_end", "chain"),
  bi_direction = FALSE, group_stats = FALSE, display = TRUE,
  deduplicate = FALSE, x, to_s4 = FALSE)

rolling_episodes(date, sn = NULL, strata = NULL, case_length,
  recurrence_length = NULL, episode_unit = "days",
  episodes_max = Inf, rolls_max = Inf, data_source = NULL,
  custom_sort = NULL, from_last = FALSE, overlap_method = c("across",
  "inbetween", "aligns_start", "aligns_end", "chain"),
  bi_direction = FALSE, group_stats = FALSE, display = TRUE,
  deduplicate = FALSE, x, to_s4 = FALSE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>df</code></td>
<td>
<p><code>data.frame</code>. One or more datasets appended together.</p>
</td></tr>
<tr valign="top"><td><code>sn</code></td>
<td>
<p>Unique numerical record identifier. Optional.</p>
</td></tr>
<tr valign="top"><td><code>strata</code></td>
<td>
<p>Subsets of the dataset within which episode grouping will be done separately. <code><a href="episode_group.html">episode_group</a></code> supports the use of multiple columns supplied as column names. <code><a href="record_group.html">record_group</a></code> can be used to create the <code>strata</code>.</p>
</td></tr>
<tr valign="top"><td><code>date</code></td>
<td>
<p>Date (<code>date</code>, <code>datetime</code> or <code>numeric</code>) or period (<code><a href="number_line.html">number_line</a></code>) of events.</p>
</td></tr>
<tr valign="top"><td><code>case_length</code></td>
<td>
<p>Period after a <code>"Case (C)"</code> within which another record from the same <code>strata</code> is considered a <code>"Duplicate (D)"</code> record.</p>
</td></tr>
<tr valign="top"><td><code>episode_type</code></td>
<td>
<p><code>"fixed"</code> or <code>"rolling"</code>.</p>
</td></tr>
<tr valign="top"><td><code>episode_unit</code></td>
<td>
<p>Time units as supported by lubridate's <code><a href="../../lubridate/html/duration.html">duration</a></code> function.</p>
</td></tr>
<tr valign="top"><td><code>episodes_max</code></td>
<td>
<p>Maximum number of times to group episodes within each <code>strata</code>.</p>
</td></tr>
<tr valign="top"><td><code>recurrence_length</code></td>
<td>
<p>Period after the last record (<code>"Case (C)"</code> , <code>"Duplicate (D)"</code> or <code>"Recurrent (R)"</code>) of an episode within which another record from the same <code>strata</code> is considered a <code>"Recurrent (R)"</code> record. If <code>recurrence_length</code> is not supplied, <code>case_length</code> is used as the <code>recurrence_length</code>.</p>
</td></tr>
<tr valign="top"><td><code>rolls_max</code></td>
<td>
<p>Maximum number of times an event can reoccur within an episode. Only used if <code>episode_type</code> is <code>"rolling"</code>.</p>
</td></tr>
<tr valign="top"><td><code>data_source</code></td>
<td>
<p>Unique dataset identifier. Useful when the dataset contains data from multiple sources. <code><a href="episode_group.html">episode_group</a></code> support the use of multiple columns supplied as column names.</p>
</td></tr>
<tr valign="top"><td><code>custom_sort</code></td>
<td>
<p>If <code>TRUE</code>, <code>"Case (C)"</code> assignment will be done with preference to this sort order. Useful in specifying that episode grouping begins at particular records regardless of chronological order. <code><a href="episode_group.html">episode_group</a></code> supports the use of multiple columns supplied as column names.</p>
</td></tr>
<tr valign="top"><td><code>from_last</code></td>
<td>
<p>If <code>TRUE</code>, episode grouping will be backwards in time - starting at the most recent record and proceeding to the earliest. If <code>FALSE</code>, it'll be forward in time - starting at the earliest record and proceeding to the most recent one.</p>
</td></tr>
<tr valign="top"><td><code>overlap_method</code></td>
<td>
<p>A set of ways for grouped intervals to overlap. Options are; <code>"across"</code>, <code>"aligns_start"</code>, <code>"aligns_end"</code>, <code>"inbetween"</code>, <code>"chain"</code>. See <code><a href="overlap.html">overlap</a></code> functions.</p>
</td></tr>
<tr valign="top"><td><code>bi_direction</code></td>
<td>
<p>If <code>FALSE</code>, <code>"Duplicate (D)"</code> records will be those within the <code>case_length</code> period, before or after the <code>"Case (C)"</code> as determined by <code>from_last</code>. If <code>TRUE</code>, <code>"Duplicate (D)"</code> records will be those within the same period before and after the <code>"Case (C)"</code>.</p>
</td></tr>
<tr valign="top"><td><code>group_stats</code></td>
<td>
<p>If <code>TRUE</code>, the output will include additional columns with useful stats for each episode group.</p>
</td></tr>
<tr valign="top"><td><code>display</code></td>
<td>
<p>If <code>TRUE</code>, status messages are printed on screen.</p>
</td></tr>
<tr valign="top"><td><code>deduplicate</code></td>
<td>
<p>if <code>TRUE</code>, <code>"Dupilcate (D)"</code> records are excluded from the output.</p>
</td></tr>
<tr valign="top"><td><code>to_s4</code></td>
<td>
<p>if <code>TRUE</code>, changes the returned output to an <code><a href="epid-class.html">epid</a></code> object.</p>
</td></tr>
<tr valign="top"><td><code>x</code></td>
<td>
<p>Record date or interval. Deprecated. Please use <code>date</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>Episode grouping begins at a reference record (<code>"Case (C)"</code>) and proceeds forward or backward in time depending on <code>from_last</code>.
If <code>custom_sort</code> is used, episode grouping can be forced to begin at certain records before proceeding forward or backwards in time.
The maximum duration of a <code>"fixed"</code> episode is the <code>case_length</code> while, the maximum duration of a <code>"rolling"</code> episode is the
<code>case_length</code> plus all recurrence periods. A recurrence period is a fixed period (<code>recurrence_length</code>) after the last record of an episode. Records within this period are taken an a <code>"Recurrent (R)"</code> record of the initial <code>"Case"</code>
</p>
<p>#' When a <code>data_source</code> identifier is included,
<code>epid_dataset</code> is included in the output. This lists the source of every record in each record group.
</p>
<p><code>fixed_episodes()</code> and <code>rolling_episodes()</code> are wrapper functions of <code>episode_group()</code>.
They are convenient alternatives with the same functionalities.
</p>


<h3>Value</h3>

<p><code>data.frame</code> (<code><a href="epid-class.html">epid</a></code> objects if <code>to_s4</code> is <code>TRUE</code>)
</p>

<ul>
<li> <p><code>sn</code> - unique record identifier as provided
</p>
</li>
<li> <p><code>epid | .Data</code> - unique episode identifier
</p>
</li>
<li> <p><code>case_nm</code> - record type in regards to case assignment
</p>
</li>
<li> <p><code>epid_dataset</code> - data sources in each episode
</p>
</li>
<li> <p><code>epid_interval</code> - episode start and end dates. A <code><a href="number_line.html">number_line</a></code> object.
</p>
</li>
<li> <p><code>epid_length</code> - difference between episode start and end dates (<code>difftime</code>). If possible, it's the same unit as <code>episode_unit</code> otherwise, a difference in days is returned
</p>
</li>
<li> <p><code>epid_total</code> - number of records in each episode
</p>
</li></ul>

<p><code>epid</code> objects will be the default output in the next release.
</p>


<h3>See Also</h3>

<p><code><a href="record_group.html">record_group</a></code>, <code><a href="overlap.html">overlap</a></code> and <code><a href="number_line.html">number_line</a></code>
</p>


<h3>Examples</h3>

<pre>
library(dplyr)
library(lubridate)

#1. Fixed episodes
data(infections); infections
db_1 &lt;- infections
# 16-day (difference of 15 days) episodes beginning from the earliest record
db_1$fd &lt;- fixed_episodes(db_1$date, case_length = 15, to_s4 = TRUE, display = FALSE)
# 16-hour (difference of 15 hours) episodes beginning from the earliest record
db_1$fh &lt;- fixed_episodes(db_1$date, case_length = 15,
episode_unit = "hours", to_s4 = TRUE, display = FALSE)
db_1

#2. Rolling episodes
# Case length and recurrence periods of 16 days
db_1$rd_a &lt;- rolling_episodes(db_1$date, case_length = 15, to_s4 = TRUE, display = FALSE)
# Case length of 16 days and recurrence periods of 11 days
db_1$rd_b &lt;- rolling_episodes(db_1$date, case_length = 15,
recurrence_length = 10, to_s4 = TRUE, display = FALSE)
# Case length of 16 days and 2 recurrence periods of 11 days
db_1$rd_c &lt;- rolling_episodes(db_1$date, case_length = 15,
recurrence_length = 10, rolls_max = 2, to_s4 = TRUE, display = FALSE)
db_1

# 3. Stratified episode grouping
db_3 &lt;- infections

db_3$patient_id &lt;- c(rep("PID 1",8), rep("PID 2",3))
# One 16-day episode per patient
db_3$epids_p &lt;- fixed_episodes(date=db_3$date, strata = db_3$patient_id,
case_length = 15, episodes_max = 1, to_s4 = TRUE, display = FALSE)
db_3

# 4. Case assignment
db_4 &lt;- infections

## 4.1 Chronological order
db_4$forward_time &lt;- fixed_episodes(db_4$date, case_length = 1,
episode_unit = "month", to_s4 = TRUE, display = FALSE)
db_4$backward_time &lt;- fixed_episodes(db_4$date, case_length = 1,
episode_unit = "month", from_last = TRUE, to_s4 = TRUE, display = FALSE)
db_4

## 4.2 User defined order
db_4b &lt;- infections
db_4b
# RTI &gt; UTI, or RTI &gt; BSI
db_4b$ord1 &lt;- ifelse(db_4b$infection =="RTI",0,1)
# UTI &gt; BSI &gt; RTI
db_4b$ord2 &lt;- factor(db_4b$infection, levels = c("UTI","BSI","RTI"))

db_4b$epids_1 &lt;- fixed_episodes(db_4b$date, case_length = 15,
custom_sort = db_4b$ord1, to_s4 = TRUE, display = FALSE)
db_4b$epids_2 &lt;- fixed_episodes(db_4b$date, case_length = 15,
custom_sort = db_4b$ord2, to_s4 = TRUE, display = FALSE)
db_4b$epids_2b &lt;- fixed_episodes(db_4b$date, case_length = 15,
custom_sort = db_4b$ord2, bi_direction = TRUE, to_s4 = TRUE, display = FALSE)
db_4b

#5. Interval grouping
data(hospital_admissions)

hospital_admissions$admin_period &lt;- number_line(hospital_admissions$admin_dt,
hospital_admissions$discharge_dt)
admissions &lt;- hospital_admissions[c("admin_period","epi_len")]
admissions

# Episodes of overlaping periods of admission
admissions$epi_0 &lt;- fixed_episodes(date=admissions$admin_period, case_length = 0,
group_stats = TRUE, to_s4=TRUE)
admissions

# Overlaping periods of admission seperated by 1 month
admissions$epi_1 &lt;- fixed_episodes(date=admissions$admin_period, case_length = 1,
episode_unit = "months", group_stats = TRUE, to_s4 = TRUE, display = FALSE)
admissions

# Episodes of chained admission periods, and those with aligned end periods
admissions$epi_0b &lt;- fixed_episodes(date=admissions$admin_period, case_length = 0,
overlap_method = c("chain","aligns_end"), group_stats = TRUE, to_s4 = TRUE, display = FALSE)
admissions["epi_0b"]


# Note - episode_group() takes column names not actual values
db_5 &lt;- infections

db_5$recur &lt;- 20
db_5$epids_f &lt;- episode_group(db_5, date=date, episode_type = "fixed",
case_length = epi_len, to_s4 = TRUE, display = FALSE)
db_5$epids_r &lt;- episode_group(db_5, date=date, episode_type = "rolling",
case_length = epi_len, recurrence_length = recur, to_s4 = TRUE, display = FALSE)
db_5

</pre>

<hr /><div style="text-align: center;">[Package <em>diyar</em> version 0.0.3 <a href="00Index.html">Index</a>]</div>
</body></html>
