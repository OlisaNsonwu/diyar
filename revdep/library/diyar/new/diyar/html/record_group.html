<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Multistage deterministic record linkage</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for record_group {diyar}"><tr><td>record_group {diyar}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Multistage deterministic record linkage</h2>

<h3>Description</h3>

<p>Group matching records from one or more datasets.
</p>


<h3>Usage</h3>

<pre>
record_group(df, sn = NULL, criteria, sub_criteria = NULL,
  data_source = NULL, group_stats = FALSE, display = TRUE,
  to_s4 = FALSE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>df</code></td>
<td>
<p><code>data.frame</code>. One or more datasets appended together.</p>
</td></tr>
<tr valign="top"><td><code>sn</code></td>
<td>
<p>Unique numerical record identifier. Optional.</p>
</td></tr>
<tr valign="top"><td><code>criteria</code></td>
<td>
<p>Column names of attributes to match. Records with matching values in these columns are grouped together.</p>
</td></tr>
<tr valign="top"><td><code>sub_criteria</code></td>
<td>
<p>Matching sub-criteria. Additional matching conditions for each stage (<code>criteria</code>).</p>
</td></tr>
<tr valign="top"><td><code>data_source</code></td>
<td>
<p>Unique dataset identifier. Useful when <code>df</code> contains data from multiple sources.</p>
</td></tr>
<tr valign="top"><td><code>group_stats</code></td>
<td>
<p>If <code>TRUE</code>, output will include additional columns with useful stats for each record group.</p>
</td></tr>
<tr valign="top"><td><code>display</code></td>
<td>
<p>If <code>TRUE</code>, status messages are printed on screen.</p>
</td></tr>
<tr valign="top"><td><code>to_s4</code></td>
<td>
<p>if <code>TRUE</code>, changes the returned output to a <code><a href="pid-class.html">pid</a></code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>Record grouping occurs in stages of matching <code>criteria</code>.
</p>
<p>Records are matched in two ways; an exact match - the equivalent of <code>(==)</code>, or matching a range of numeric values.
An example of range matching is matching a date give or take 5 days, or matching an age give or take 2 years.
To do this, create a <code><a href="number_line.html">number_line</a></code> object based on the range of values, and assign the actual value assigned to <code>gid</code>.
Then use the <code><a href="number_line.html">number_line</a></code> as a <code>sub_criteria</code>.
</p>
<p>A match at each stage is considered more relevant than those at subsequent stages.
Therefore, <code>criteria</code> should be listed in order of decreasing relevance or certainty.
</p>
<p><code>sub_criteria</code> can be used to force additional matching conditions at each stage.
If <code>sub_criteria</code> is not <code>NULL</code>, only records with matching <code>criteria</code> and <code>sub_criteria</code> values are grouped together.
If a record has missing values for any <code>criteria</code>, it's skipped at that stage, and another attempt is made at the next stage.
If all <code>criteria</code> values are missing, that record is assigned a unique group ID.
</p>
<p>When a <code>data_source</code> identifier is included,
<code>pid_dataset</code> is included in the output. This lists the source of every record in each record group.
</p>


<h3>Value</h3>

<p><code>data.frame</code> (<code><a href="pid-class.html">pid</a></code> objects if <code>to_s4</code> is <code>TRUE</code>)
</p>

<ul>
<li> <p><code>sn</code> - unique record identifier as provided
</p>
</li>
<li> <p><code>pid | .Data</code> - unique group identifier
</p>
</li>
<li> <p><code>pid_cri</code> - matched criteria for each record in the group
</p>
</li>
<li> <p><code>pid_dataset</code> - data sources in each group
</p>
</li>
<li> <p><code>pid_total</code> - number of records in each group
</p>
</li></ul>

<p><code>pid</code> objects will be the default output from the next release.
</p>


<h3>See Also</h3>

<p><code><a href="episode_group.html">episode_group</a></code> and <code><a href="number_line.html">number_line</a></code>
</p>


<h3>Examples</h3>

<pre>
library(dplyr)
library(tidyr)

three_people &lt;- data.frame(forename=c("Obinna","James","Ojay","James","Obinna"),
                           stringsAsFactors = FALSE)

three_people$pids_a &lt;- record_group(three_people, criteria= forename, to_s4 = TRUE)
three_people

# To handle missing or unknown data, recode missing or unknown values to NA or "".
three_people$forename[c(1,4)] &lt;- NA
three_people$pids_b &lt;- record_group(three_people, criteria= forename, to_s4 =TRUE)
three_people

data(staff_records); staff_records

# Range matching
dob &lt;- staff_records["sex"]
dob$age &lt;- c(30,28,40,25,25,29,27)

# age range: age + 20 years
dob$range_a &lt;- number_line(dob$age, dob$age+20, gid=dob$age)
dob$pids_a &lt;- record_group(dob, criteria = sex, sub_criteria = list(s1a="range_a"), to_s4 = TRUE)
dob[c("sex","age","range_a","pids_a")]

# age range: age +- 20 years
dob$range_b &lt;- number_line(dob$age-20, dob$age+20, gid=dob$age)
dob$pids_b &lt;- record_group(dob, criteria = sex, sub_criteria = list(s1a="range_b"), to_s4 = TRUE)
dob[c("sex","age","range_b","pids_b")]

dob$pids_c &lt;- record_group(dob, criteria = range_b, to_s4 = TRUE)
dob[c("age","range_b","pids_c")]


# Multistage record grouping
staff_records$pids_a &lt;- record_group(staff_records, sn = r_id, criteria = c(forename, surname),
                                     data_source = sex, display = FALSE, to_s4 = TRUE)
staff_records

# Add `sex` to the second stage (`cri`) to be more certain
staff_records &lt;- unite(staff_records, cri_2, c(surname, sex), sep ="-")
staff_records$pids_b &lt;- record_group(staff_records, r_id, c(forename, cri_2),
                                     data_source = dataset, display = FALSE, to_s4 = TRUE)
staff_records

# Using sub-criteria
data(missing_staff_id); missing_staff_id

missing_staff_id$pids &lt;- record_group(missing_staff_id, r_id, c(staff_id, age),
list(s2a=c("initials","hair_colour","branch_office")), data_source = source_1, to_s4 = TRUE)

missing_staff_id

</pre>

<hr /><div style="text-align: center;">[Package <em>diyar</em> version 0.0.3 <a href="00Index.html">Index</a>]</div>
</body></html>
